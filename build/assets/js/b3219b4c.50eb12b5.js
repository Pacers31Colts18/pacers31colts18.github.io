"use strict";(globalThis.webpackChunkpacers_31_colts_18_github_io=globalThis.webpackChunkpacers_31_colts_18_github_io||[]).push([[3099],{3890(e){e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"expanding-my-homelab-with-cloudflare-tailscale-and-more","metadata":{"permalink":"/blog/expanding-my-homelab-with-cloudflare-tailscale-and-more","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-12-27-expanding-my-homelab-with-new-services/index.md","source":"@site/blog/2025-12-27-expanding-my-homelab-with-new-services/index.md","title":"Expanding my Home Lab with Cloudflare, Tailscale, and more","description":"How I use Cloudflare, Technitium, Caddy, and Tailscale to expand my home lab.","date":"2025-12-26T00:00:00.000Z","tags":[{"inline":false,"label":"Home Lab","permalink":"/blog/tags/home-lab","description":"Home Lab related posts."},{"inline":false,"label":"Networking","permalink":"/blog/tags/networking","description":"Networking related posts."}],"readingTime":17.41,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Expanding my Home Lab with Cloudflare, Tailscale, and more","description":"How I use Cloudflare, Technitium, Caddy, and Tailscale to expand my home lab.","slug":"expanding-my-homelab-with-cloudflare-tailscale-and-more","date":"2025-12-26T00:00:00.000Z","thumbnail":"/img/blog/cover1.png","tags":["home-lab","networking"]},"unlisted":false,"nextItem":{"title":"Tracking Chores with Home Assistant","permalink":"/blog/tracking-chores-with-home-assistant"}},"content":"\x3c!-- truncate --\x3e\\n\\n2025 is almost to a close. We recently went back to Indiana to visit our family and had a good time. The weather was unseasonably warm, especially compared to Minnesota standards. We visited the Indianapolis Zoo, as the kids have been wanting to see the chimps since we last lived there and they did a summer camp at the zoo. We saw some super active orangutans, and other animals that are normally not active. I love visiting zoos on winter days. No crowds, some animals being more active than they normally are. Christmas was nice, my cousin came up to visit who I don\'t see all that often and I was able to catch up a bit with my dad and brother. Family gatherings are usually a little awkward for me, I\'m more laid back and reserved while my family when all together are pretty loud and talk over each other (even if there is only 11 of us).\\n\\nMy goal for this blog going into the new year is to obviously try to write more consistently. I started out good in 2025, but tapered off at the end (as I do with most things.) This year I am hoping to write at least once a month, with posts having more content to them. I\'m not exactly sure what I will write about, probably more things with endpoint management, but honestly I like to just write about whatever I feel like. Which sums up this post perfectly.\\n\\nBefore Christmas, I had been working on my home setup more and wanted to write a post before the end of the year. Recently I bought a new UGreen 4-bay NAS (my first NAS) and have been learning about Docker a lot. Before I had the NAS, I was running Proxmox off of a Intel NUC, using LXC Containers or VMs. I also had a Dell Optiplex in use, but that was more for Active Directory/ConfigMgr/Intune testing. With my new NAS, and expanded storage/memory and ideas, I decided to split up how I was doing things.\\n\\nYou can find more of my home lab setup [here](https://github.com/Pacers31Colts18/HomeLab) but I\'ve migrated a few containers off of Proxmox and into Docker (using Portainer as my management tool for Docker). In this post, I plan to go into :\\n\\n- How I\'ve used an unused domain name on Cloudflare to get proper certificates.\\n- Technitium to manage my DNS and ad blocking.\\n- Caddy to reverse proxy my sites and retrieve the proper certificates.\\n- Tailscale to access my network remotely\\n- And probably some other things I\'m forgetting\\n\\n## The Before Times\\n\\nOkay, I\'ve had my NAS since the fall. I\'ve migrated the following from Proxmox to Docker, rebuilding services and trying to standardize. These were previously on a singular Proxmox container, running with an 8TB external hard drive plugged into the NUC and passing through to the container. Running off crappy internet, there was always some sort of issue or slow loading time. It got by good enough, but needed to be fixed.\\n\\n- Plex\\n- Prowlarr\\n- Radarr\\n- Sonarr\\n- Lidarr\\n- Bazarr\\n\\nI initially configured these all to run in host mode, with 192.x.x.x IP addresses. This was done mainly out of laziness, but once I discovered Portainer, I then went back and reconfigured these to all be in bridged networking (on separate networks). I was able to get them to communicate with each other by adding the following line in each compose file:\\n\\n```yml\\n    extra_hosts:\\n      - ultron.local:192.168.4.125\\n```\\n\\nSo now that I have everything migrated over, I finally decided it was time to get certificates and domain names working correctly on this. Obviously, I\'m the owner of joeloveless.com. I\'m also the owner of some other variations of joeloveless and other random domain names my ADHD brain decides to randomly purchase. For this, I decided not to use joeloveless.com and instead use joeloveless.net for the setup. Why? I don\'t really have a great reason...separation of services, sure?\\n\\n## Let\'s play with Cloudflare!\\nHave I used Cloudflare before, nope. Is it a lot, you betcha. Compared to Square Space, there are about a million more options. In my initial design/messing around, I was looking at DDNS providers (DuckDNS, NoIP, etc). I registered joeloveless.net with NoIP, but couldn\'t get that working properly, I then discovered certificate challenging with Let\'s Encrypt. I used these sites as my starting points:\\n\\n- https://techdecode.online/decode/build-your-homelab-nginx/\\n- https://blog.jamesbrooks.net/posts/technitium-dns-server-with-tailscale/\\n\\nOnce you have an account, the first thing you need to do is configure the NS records properly. Easier when you buy the domain through Cloudflare, as that work is already done for you. If bringing in from another registrar, there is the transfer process. I followed [Cloudflare\'s docs](https://developers.cloudflare.com/registrar/get-started/transfer-domain-to-cloudflare/) and was then ready for the next step.\\n\\n### API Key\\n\\nThe next step is to generate an API key. Simple enough, make sure to copy it somewhere safe (not online) and actually do that. I can\'t tell you how many times I thought this was going to be a straightforward process, only to get stuck somewhere, not copy the API key somewhere I could reference it, starting over with a new try, and not having the API key. I think I generated about ten of them in total.\\n\\n1. From the Cloudflare portal > Profile\\n2. Click API Tokens\\n3. Click Create Token\\n4. Choose Edit Zone DNS\\n\\n![Token Creation](cloudflare.png)\\n- When using the template, it will pre-fill Edit zone for you. I went ahead and added **Read** also. Probably not needed, as you have to have Read to be able to Edit, but whatever.\\n\\n![Token Creation Zones](cloudflare2.png)\\n- If you only have one domain, you could probably just choose All Zones, but I\'m not sure what the future looks like, so I wanted to configure this only for joeloveless.net\\n\\n**Again, copy the API key somewhere safe as you\'ll need it later**\\n\\nFor now, we are done in the Cloudflare portal, but will come back to this later.\\n\\n\\n## Setting up a Reverse Proxy - Caddy for the Win\\nThree things I\'m not the greatest at.\\n\\n1. Networking\\n2. Certificates\\n3. Linux\\n\\nFor a starting off point, I referenced this blog post to get started, but ended up modifying some of the steps:\\n\\n- https://samedwardes.com/blog/2023-11-19-homelab-tls-with-caddy-and-cloudflare/\\n- https://akashrajpurohit.com/blog/setup-caddy-with-automatic-ssl-certificates-with-cloudflare/\\n\\nWell, this is a home lab, here I am trying to learn. This is also a good place to document so the next dumb dumb (or me) can maybe stumble there way through it.\\n\\nMy goal initially was to run this all through Docker. I had issues getting anything to work properly, using NGINX ProxyManager, Caddy, or any other solution. What I landed on was:\\n\\n- [Proxmox LXC for Caddy](https://community-scripts.github.io/ProxmoxVE/scripts?id=caddy)\\n  - Reason for Caddy:\\n    - I was able to get it working while I struggled with the others.\\n  - Reason for Proxmox:\\n    - Proxmox Helper Scripts are dumb dumb proof. I also know my way around Proxmox just a little bit better than Docker at this point. And by a little bit, it means I\'ve had it setup for longer. I\'m no expert by any means.\\n\\nOnce the base setup is complete, ensure you have the [Cloudflare DNS module](https://caddyserver.com/docs/modules/dns.providers.cloudflare) installed also.\\n\\n```bash\\nxcaddy build --with github.com/caddy-dns/cloudflare\\n```\\n\\n### Port Forwarding/IP Reservation\\n\\nOnce your Caddy LXC is up and running, we\'ll want to go into it through the Web UI.\\n\\n#### Getting your IP Address\\nLXC containers are pretty bare bones. Turns out, ifconfig is not even an option.\\n\\n```bash\\nroot@caddy01:/# ifconfig\\n-bash: ifconfig: command not found\\n```\\n\\n```bash\\nip addr\\n```\\n\\n![IP Address](caddy.png)\\n\\n**An important step to do is to reserve the IP address for your Caddy container. You will also want to port forward 80/443. All of this is router dependent. I was able to do this through the Eero Android App, but your mileage may vary.**\\n\\n### Cloudflare A Record\\n\\nBack to the Cloudflare portal, we will want to add an A record for our **internal** IP address.\\n\\n![Cloudflare A Record](cloudflare3.png)\\n\\nMore information on what this is doing exactly can be found on [Cloudflare\'s documentation](https://developers.cloudflare.com/dns/proxy-status/#proxied-records)\\n\\n### Back to Caddy\\n\\n#### Running Caddy as a Service\\n\\nI followed this blog post to configure Caddy to run automatically or as a service.\\n\\n- https://akashrajpurohit.com/blog/setup-caddy-with-automatic-ssl-certificates-with-cloudflare/\\n\\n#### .env File\\n\\nNow that we have all that configured, we can hop back into the Caddy LXC and start configuring it.\\n\\n```bash\\ncd /etc/caddy\\n```\\n\\n**/etc/caddy** is where the config files for Caddy lives.\\n\\nLet\'s start by making the .env file:\\n\\n```bash\\nsudo nano .env\\n```\\n\\nThis is where the Cloudflare API token comes into play:\\n\\n```bash\\nCF_API_TOKEN=REPLACE WITH YOUR API TOKEN\\n```\\n\\n**CTRL+X and CTRL+S will then save the file.**\\n\\n#### Caddyfile\\n\\nNow we will need to make the Caddyfile. Case sensitivity matters in Linux.\\n\\n```bash\\ncd /etc/caddy\\n```\\n\\nThe [Caddyfile](https://caddyserver.com/docs/caddyfile) is where all the configuration for our sites lives.\\n\\n```bash\\nsudo nano Caddyfile\\n```\\n\\nI struggled with this on the Docker side of things, mainly because Docker created a folder and was conflicting with my actual file.\\n\\nExample configuration:\\n\\n```bash\\n\\n        email joe@joeloveless.net\\n}\\n\\n# Public HTTPS subdomains\\nradarr.joeloveless.net {\\n        reverse_proxy 192.168.4.208:7878\\n        tls {\\n                dns cloudflare {env.CF_API_TOKEN}\\n        }\\n}\\n\\nsonarr.joeloveless.net {\\n        reverse_proxy 192.168.4.125:8989\\n        tls {\\n                dns cloudflare {env.CF_API_TOKEN}\\n        }\\n}\\n\\nlidarr.joeloveless.net {\\n        reverse_proxy 192.168.4.219:8686\\n        tls {\\n                dns cloudflare {env.CF_API_TOKEN}\\n        }\\n}\\n```\\n\\nOnce configured, we will want to reload the service:\\n\\n```bash\\nsystemctl reload caddy.service\\n```\\n\\nGoing to **lidarr.joeloveless.net** takes me to a black screen through Firefox.\\n\\n```bash\\n curl -v lidarr.joeloveless.net\\n* Could not resolve host: lidarr.joeloveless.net\\n* shutting down connection #0\\ncurl: (6) Could not resolve host: lidarr.joeloveless.net\\n```\\n\\nWe\'re almost there, we just need to configure Technitium properly.\\n\\n## Next up, Technitium\\n\\nTo start, I live in the middle of nowhere Minnesota. My best and only internet provider is Starlink (booooo). I also have an Eero 6 router. Last year, I tried to configure Pi-hole again to block ads. What I found was my Pi-hole configuration (basically the default config) was balooning in size daily and recreating the hosts over and over again. In a limiited space Proxmox VM, this was no bueno, so I had to find alternatives.\\n\\nThis is where I found [Technitium](https://technitium.com/dns/), and honestly, found it much better than Pi-hole. While the UI isn\'t as clean, the options provided are so much better than Pi-Hole. It\'s an Adblocker, DNS server, DHCP server, and I\'m sure some other servers all rolled into one.\\n\\nIn a recent update, Technitium introduced a clustering option, and that is where the ideas started spinning. I already had Technitium on an LXC container using [Proxmox Helper Scripts](https://tteck.github.io/Proxmox/#technitium-dns-lxc), but with clustering, I decided to go down the rabbit hole.\\n\\n### Docker Configuration\\n\\n[Docker Compose](https://github.com/Pacers31Colts18/HomeLab/blob/main/Docker/Compose/technitium-docker_compose.yml)\\n\\nI\'ll be honest, I probably found the docker compose file somewhere, I\'m just not sure where at this moment. I try to use the base Docker compose files when I can, and think this is what I used here. This is pretty straight forward, I try to use bridge mode for the networking whenever possible, but this is one that calls for the networking to be in host mode. Makes total sense to me and my Docker noobness.\\n\\n### Router Configuration\\n\\nYou should now have two DNS servers. We\'ll want to copy the IP address from each, setup an IP reservation on your router, and set both of these as your primary and secondary DNS servers.\\n\\n### Optional: Cluster Configuration\\n\\nI now have two Technitium servers:\\n- dns01 - Proxmox LXC\\n- dns02 - Docker Container\\n\\n*Note: This part might be a tad out of order, as I already had a running Technitium server*\\n\\nI then logged into dns01 and followed [Technitium\'s guide to setting up clustering](https://blog.technitium.com/2025/11/understanding-clustering-and-how-to.html)\\n\\n![Clustering setup](technitium_cluster.png)\\n\\n### Setting up Zones\\n\\nBack to the issue at hand, we\'re now trying to hit the sites that we have in our Caddyfile by going to https://lidarr.joeloveless.net, https://sonarr.joeloveless.net, etc.\\n\\nIn Technitium:\\n\\n1. Go to Zones > Add Zone\\n2. Create a new zone as a **Forwarder zone**\\n\\n![Zones](technitium_zones.png)\\n\\n#### Adding Records\\nNow we need to add a few records to our newly created zone:\\n\\nFirst, create an @ record and a * record for Caddy:\\n\\n![Technitium - Caddy Record](technitium_caddy.png)\\n\\nThen, for each service, add an A record. The IP address should be that of the Caddy server, not of the service itself. This tripped me up initially.\\n\\n![Technitium - Lidarr Record](technitium_lidarr.png)\\n\\nWe should now be able to go to a site and view the page correctly:\\n\\n![Lidarr](cert_lidarr.png)\\n\\n```bash\\ncurl -v lidarr.joeloveless.net\\n* Host lidarr.joeloveless.net:80 was resolved.\\n* IPv6: (none)\\n* IPv4: 192.168.4.229\\n*   Trying 192.168.4.229:80...\\n* Connected to lidarr.joeloveless.net (192.168.4.229) port 80\\n* using HTTP/1.x\\n> GET / HTTP/1.1\\n> Host: lidarr.joeloveless.net\\n> User-Agent: curl/8.15.0\\n> Accept: */*\\n> \\n* Request completely sent off\\n< HTTP/1.1 308 Permanent Redirect\\n< Connection: close\\n< Location: https://lidarr.joeloveless.net/\\n< Server: Caddy\\n< Date: Fri, 26 Dec 2025 15:16:59 GMT\\n< Content-Length: 0\\n< \\n* shutting down connection #0\\n```\\n\\nWe can also view the log files for Caddy by typing the following:\\n```bash\\njournalctl -u caddy.service --no-pager | less +G\\n```\\n## Where are we at?\\n\\nA brief recap of what\'s been done so far.\\n\\n- 1 domain name on Cloudflare\\n  - joeloveless.net\\n    - API token for DNS zones configured\\n    - A record for internal IP address\\n- 2 DNS Servers:\\n  - dns01 - Proxmox\\n  - dns02 - Docker\\n  - Servers are clustered together\\n  - 1 Forwarder zone (joeloveless.net)\\n    - @ and * records for 192.168.4.229 (caddy01)\\n    - A records for each service pointing to 192.168.4.229\\n- 1 Proxy Server:\\n  - caddy01 - Proxmox\\n    - Configured to run as a service\\n    - .env file storing the Cloudflare API token\\n    - Caddyfile containing the sites to be redirected\\n- Services\\n  - Lidarr, Sonarr, Radarr, whatever other service to configure.\\n  - Currently resolving **internally** to https://service.joeloveless.net with a HTTPS certificate.\\n  - Not resolving externally\\n\\n![Lidarr - External](lidarr_offnetwork.png)\\n\\n## Solving the remote issue - Enter Tailscale\\n\\nI\'d like to be able to access my services remotely, without directly exposing ports to the Internet, setting up a full on VPN, or some other solution that I don\'t have too much time for. Enter [Tailscale](https://tailscale.com).\\n\\nTailscale allows you to install a client on devices/vms/whatever, and access those services from another Tailscale client. There are a multitude of options to configure, but I believe I landed on what works best for my use case.\\n\\n### More issues, installing Tailscale on Docker/UGreen NAS/Proxmox\\n\\nI ran into different issues trying to get all my clients talking correctly and accessible.\\n\\n- Docker\\n  - All containers are being ran in bridged networking, getting them to communicate properly with the Tailscale docker container proved to be annoying.\\n- UGreen NAS\\n  - UGreen runs it\'s own Linux distro, I was running into errors trying to get it to install on the NAS. And that would only solve the problem for services running on the NAS directly had it worked.\\n- Proxmox\\n  - While I could have installed TailScale on all my Proxmox containers and VMs, I ran into different issues with different containers, and again, that would only solve the Proxmox side of things.\\n\\n### Adding a new Container to control it all\\n\\nAfter thinking about it for a bit, I landed on what I hope is a good decision. I decided rather than trying to get the Tailscale client installed on everything individually, I would instead spin up a 3rd Technitium DNS server (Proxmox LXC) and then install Tailscale on that host.\\n\\nMy thought process behind this:\\n- Gives me a third server, should one of my other DNS servers have issues. I could just update the DNS servers on my Eero router.\\n- Simple enough to setup. I don\'t need to worry about Docker configuration. I could just run the Proxmox Helper Script, then install the Tailscale client.\\n- I can cluster with the dns01 and dns02, so all the configuration will be there should I need to take any of the other two down. It\'s aware of all the zones, etc, so I can use this as a DNS server on the Tailscale side.\\n\\n### Configuring the new server - dns03\\n\\nThis process was really straight forward.\\n\\n[Proxmox Helper Script - Technitium](https://community-scripts.github.io/ProxmoxVE/scripts?id=technitiumdns)\\n\\nOnce this is finished, you then will run the Tailscale setup.\\n\\n[Proxmox Helper Script - Tailscale](https://community-scripts.github.io/ProxmoxVE/scripts?id=add-tailscale-lxc&category=Proxmox+%26+Virtualization)\\n\\nFrom here, we are going to configure Tailscale to act as a [subnet router](https://tailscale.com/kb/1019/subnets), which requires some extra configuration.\\n\\n```bash\\necho \'net.ipv4.ip_forward = 1\' | sudo tee -a /etc/sysctl.d/99-tailscale.conf\\necho \'net.ipv6.conf.all.forwarding = 1\' | sudo tee -a /etc/sysctl.d/99-tailscale.conf\\nsudo sysctl -p /etc/sysctl.d/99-tailscale.conf\\n```\\nNow we can start Tailscale and advertise the routes:\\n\\n```bash\\ntailscale up --advertise-routes=192.168.4.0/24 --advertise-exit-node\\n```\\nYou should then get a message on your console with a URL to authenticate to, go ahead and do that portion (and setup the Tailscale account if you have not already done so)\\n\\nBack in the LXC container:\\n\\n```bash\\ntailscale set --accept-dns=false\\n```\\nTLDR: We\'re telling the host not to use Tailscale\'s DNS servers.\\n\\nNow we are ready to configure some settings in the Tailscale portal, but first, do the following:\\n\\n1. Capture the IP address and write it down\\n\\n```bash\\nip addr\\n```\\n\\n2. Setup an IP reservation on your router for your new host so this will not change.\\n\\n### Tailscale Portal Configuration\\n\\nIn the Tailscale portal, you should now see your host.\\n\\n- Click on the three dots\\n\\n![3 dots](tailscale.png)\\n\\n- Ensure everything is checked correctly:\\n\\n![Client settings](tailscale2.png)\\n\\n- Click Save, and then click on DNS in the top menu bar.\\n- Scroll down to **Nameservers**\\n- Enter your **Public IP Address**\\n  - To find your public IP on Linux:\\n```bash\\ncurl -4 https://ipinfo.io/ip\\n```\\n\\n![Tailscale Name Servers](tailscale_nameservers.png)\\n- Click the three dots and toggle **Use with exit node**\\n- Remove any already configured Name Servers.\\n- Under search domains, add your domain name (see above screenshot)\\n- Disable MagicDNS.\\n\\n## Testing out the configuration\\n\\nSo with this configuration, we should be able to do the following:\\n[x] Resolve https://**service**.joeloveless.net internally.\\n[x] Resolve https://**service**.joeloveless.net if connected via Tailscale.\\n[x] Not be able to connect if on any other setup.\\n\\n### Internal\\nMy home wifi is cleverly named \\"LovelessWIFI\\"\\n\\n```bash\\nip addr\\n```\\n![Internal IP](internal2.png)\\n\\n```bash\\nresolvectl\\n```\\n![Internal DNS](internal.png)\\n\\n192.168.4.216 IP address, connected to dns01 (192.168.4.208) as the primary DNS server.\\n\\n```bash\\ncurl -v lidarr.joeloveless.net\\n```\\n\\nCurl results are successful!\\n\\n```bash\\nHost lidarr.joeloveless.net:80 was resolved.\\nIPv6: (none)\\nIPv4: 192.168.4.229\\nTrying 192.168.4.229:80...\\nConnected to lidarr.joeloveless.net (192.168.4.229) port 80\\nusing HTTP/1.x\\nGET / HTTP/1.1\\nHost: lidarr.joeloveless.net\\nUser-Agent: curl/8.15.0\\nAccept: */*\\n\\nRequest completely sent off\\nHTTP/1.1 308 Permanent Redirect\\nConnection: close\\nLocation: https://lidarr.joeloveless.net/\\nServer: Caddy\\nDate: Fri, 26 Dec 2025 19:06:19 GMT\\nContent-Length: 0\\n \\nshutting down connection #0\\n```\\nI\'m able to successfully connect to the service with valid certificates:\\n\\n![Lidarr connection](internal3.png)\\n\\n### External\\n\\nI\'ve now disconnected from my home wifi, configured and connected to my mobile hotspot.\\n\\n![External IP Address](external.png)\\n![External DNS](external2.png)\\n\\n10.142.141.137 IP address connected to 10.142.141.105 DNS server\\n\\nJust to make sure there isn\'t anything lingering, let\'s flush DNS:\\n\\n```bash\\nsudo resolvectl flush-caches\\n```\\n![External Try](external3.png)\\n\\n```bash\\ncurl -v lidarr.joeloveless.net\\n* Could not resolve host: lidarr.joeloveless.net\\n* shutting down connection #0\\ncurl: (6) Could not resolve host: lidarr.joeloveless.net\\n```\\n\\nFailure = Success!\\n\\n\\n### Tailscale\\n\\nSo we\'ve been able to connect internally, but not externally. Now let\'s see if Tailscale does it\'s job.\\n\\nFrom a client that has Tailscale installed, make sure you configure the client to connect to the exit node:\\n\\n```bash\\nsudo tailscale set --exit-node=dns03\\n```\\n\\nOnce configured, connect.\\n\\n```bash\\ntailscale up\\n```\\nLet\'s make sure we\'re connected correctly:\\n```bash\\ntailscale status\\n```\\n![Tailscale Status](tailscale_status.png)\\n\\n\\n```bash\\ncurl -v lidarr.joeloveless.net\\n* Host lidarr.joeloveless.net:80 was resolved.\\n* IPv6: (none)\\n* IPv4: 192.168.4.229\\n*   Trying 192.168.4.229:80...\\n* Connected to lidarr.joeloveless.net (192.168.4.229) port 80\\n* using HTTP/1.x\\n> GET / HTTP/1.1\\n> Host: lidarr.joeloveless.net\\n> User-Agent: curl/8.15.0\\n> Accept: */*\\n> \\n* Request completely sent off\\n< HTTP/1.1 308 Permanent Redirect\\n< Connection: close\\n< Location: https://lidarr.joeloveless.net/\\n< Server: Caddy\\n< Date: Fri, 26 Dec 2025 19:23:04 GMT\\n< Content-Length: 0\\n< \\n* shutting down connection #0\\n```\\n\\nCurl is successful!\\n\\n![Tailscale - Lidarr](lidarr_tailscale.png)\\n\\nSuccess! I can now see all my previously bought CDs and tapes from my younger days.\\n\\n## Wrapping Up\\n\\nThis was a pretty fun process to figure out. It seems to work surprisingly well so far, I was able to connect back to my home Starlink network via Tailscale and listen to my music on the way to Indiana in a lovely 9 hour car ride through Iowa and Illinois with hardly any issues. I hope everyone has a wonderful New Year\'s and a great 2026. Until next time, take care."},{"id":"tracking-chores-with-home-assistant","metadata":{"permalink":"/blog/tracking-chores-with-home-assistant","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-11-11-tracking-chores-with-home-assistant/index.md","source":"@site/blog/2025-11-11-tracking-chores-with-home-assistant/index.md","title":"Tracking Chores with Home Assistant","description":"How I use Home Assistant to keep track of chores.","date":"2025-11-11T00:00:00.000Z","tags":[{"inline":false,"label":"Home Assistant","permalink":"/blog/tags/home-assistant","description":"Home Assistant related posts."}],"readingTime":4.69,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Tracking Chores with Home Assistant","description":"How I use Home Assistant to keep track of chores.","slug":"tracking-chores-with-home-assistant","date":"2025-11-11T00:00:00.000Z","tags":["home-assistant"]},"unlisted":false,"prevItem":{"title":"Expanding my Home Lab with Cloudflare, Tailscale, and more","permalink":"/blog/expanding-my-homelab-with-cloudflare-tailscale-and-more"},"nextItem":{"title":"What Group Policy Settings aren\'t in Microsoft Intune?","permalink":"/blog/what-settings-are-in-intune"}},"content":"\x3c!-- truncate --\x3e\\n\\nI\'ve been slammed. I keep trying to set a schedule and stay organized, but with everything at work and home life, I\'ve just not had the time or motivation to really write all that much. The kids are back in school, and that has been eating up most of my time. Work has been really busy the past few months, and hopefully with the holiday season upon us, things will start to slow down a little bit.\\n\\nSince the last post, I\'ve purchased a new UGreen NAS, which I am deeply enjoying. I\'m going down the Docker route currently, and setting up my Plex server on that. I\'ve transferred everything over, and am just working out the kinks. I think I\'ll do a post on the setup here shortly. Windows 10 End of Life happened, and my trusty Lenovo laptop (2018ish?) isn\'t spec\'d for Windows 11. I decided to try something new, and put Fedora on it. Typically when I go the Linux route, I go for a Ubuntu flavor (Mint or Ubuntu), but I decided to try Fedora this time. I\'ve never really had any issues with Linux, but I\'m not a heavy user either. This laptop is basically a dedicated web browser for Discord, PocketCasts, and Spotify. For labbing and other tasks, I have my Dell Optiplex I got off eBay earlier in the year, and do most of my browsing of blogs and such on my Samsung tablet.\\n\\nI didn\'t want to go too long without posting though, this post is about how I am trying to get some organization going in my life. One of my constant struggles is staying organized. I\'m usually a little all over the place, and have tried different methods. Currently, I use the following:\\n\\n- Field Notes\\n  - Personal notebook to write down things to do each day.\\n- Microsoft ToDo\\n  - I use this for work to try to flag e-mails, setup daily reminders of what I should actually be working on.\\n- Azure DevOps\\n  - Our team uses this as a sprint planner to try to stay organized. It\'s a little overkill for our team, but I enjoy it and it does help keep me on track.\\n\\nIt has come to my attention that I need to do more around the house. Fair enough, I\'d agree with that 100%. The problem is, I\'m a very checklist oriented person. Rather than ask for a list, which adds one more thing to my wife\'s plate, I\'ve decided to try to tackle this with [Home Assistant](https://home-assistant.io)\\n\\n## Goals\\n\\nWith this configuration, I\'m looking to achieve the following:\\n\\n- I want a dashboard that contains both weekly and monthly tasks that I can toggle on (finished) and off (todo)\\n- On Sunday, the weekly tasks should revert back to \\"off\\".\\n- On the first of the month, the monthly tasks should revert back to \\"off\\".\\n\\n## Creating Helpers\\n\\n- In Home Assistant, go to Settings > Devices & Services > Automations\\n\\n![Helpers](helpers.png)\\n- Click on **Create Helper**\\n- Create a **Toggle** helper\\n  - I put a prefix of **Chores** on each one of mine.\\n  - Do this for each chore you want to add.\\n- Once finished naming, I then went in and edited each entityid to look like this:\\n\\n![Entity](entity.png)\\n\\nI added _monthly_ or _weekly_ to each chore that I added, I\'ll be using this later to help with organization. I also added tags to each one, to help me try to keep this in check.\\n\\n![Chores](chores_list.png)\\n\\n## Creating a Dashboard\\n\\nThe next step is to create a dashboard, or if you want, add cards to your already created dashboard.\\n\\nI\'ve added my .yaml file on my [GitHub](https://github.com/Pacers31Colts18/HomeAssistant/blob/main/Dashboards/chores_dashboard.yaml)\\n\\nTo get started, the dashboard is the following:\\n\\n- Single pane dashboard\\n- Horizontal stack card\\n- Auto Entities HACS integration must be installed.\\n  - [Repository](https://github.com/thomasloven/lovelace-auto-entities)\\n\\nBecause of how we named the entities with **chores_weekly** and **chores_monthly** we can now configure this in the yaml file:\\n\\n![Chores YAML](chores_yaml.png)\\n\\nWe should now have a fully configured dashboard. When toggled to \\"on\\" (done), the toggle will go from ToDo to Finished.\\n\\n![Chores Dashboard](chores_dashboard.png)\\n\\n## Resetting the Dashboard with Automations\\n\\nThe final thing I wanted to accomplish was to reset the chores either weekly or monthly. Why would I want to untoggle it myself? Craziness. Both of my automations are on my Github:\\n\\n[Chores - Reset Weekly Toggle](https://github.com/Pacers31Colts18/HomeAssistant/blob/main/Automations/Chores%20-%20Reset%20Weekly%20Toggle.yaml)\\n[Chores - Reset Monthly Toggle](https://github.com/Pacers31Colts18/HomeAssistant/blob/main/Automations/Chores%20-%20Reset%20Monthly%20Toggle.yaml)\\n\\n- Go back into Settings > Automations & Scenes\\n- Click **Create Automation**\\n- Choose **Create New Automation**\\n- Click on the three dots in the top right corner and choose **Edit in YAML**\\n- Paste the code from my GitHub.\\n\\n### Automation Notes:\\n- You\'ll want to change the entity_id list to match the chores you have added.\\n- The weekly dashboard is easier, as you can choose the day you want the toggles to reset weekly.\\n- The monthly dashboard, I chose to use a template. You could also create a calendar event if you have an integration for that to trigger off of.\\n  - If using the template route, I have mine resetting on the first of each month. Adjust to how you see fit.\\n  \\n## Wrapping Up\\n\\nSo that\'s it, now I have a dashboard where I can keep track of either my chores, or start tracking the chores for the kids also. We could also setup actionable reminders, but for now, I think this will do. The next step in the process is to actually stick with it and do the chores consistently. We\'ll see if that happens or not."},{"id":"what-settings-are-in-intune","metadata":{"permalink":"/blog/what-settings-are-in-intune","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-10-11-what-settings-are-in-intune/index.md","source":"@site/blog/2025-10-11-what-settings-are-in-intune/index.md","title":"What Group Policy Settings aren\'t in Microsoft Intune?","description":"Finding settings that are in Group Policy, but aren\'t in Intune.","date":"2025-10-11T00:00:00.000Z","tags":[{"inline":false,"label":"Group Policy","permalink":"/blog/tags/group-policy","description":"Group Policy related posts."},{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."},{"inline":false,"label":"Graph API","permalink":"/blog/tags/graph-api","description":"Microsoft Graph API related posts."}],"readingTime":7.71,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"What Group Policy Settings aren\'t in Microsoft Intune?","description":"Finding settings that are in Group Policy, but aren\'t in Intune.","slug":"what-settings-are-in-intune","date":"2025-10-11 00:00:00+0000","tags":["group-policy","intune","powershell","graph-api"]},"unlisted":false,"prevItem":{"title":"Tracking Chores with Home Assistant","permalink":"/blog/tracking-chores-with-home-assistant"},"nextItem":{"title":"Exploring Microsoft Intune Filters","permalink":"/blog/exploring-microsoft-intune-filters"}},"content":"Finding settings that are in Group Policy, but aren\'t in Intune.\\n\x3c!-- truncate --\x3e\\n\\nOne of the challenges that we\'ve found using Intune, is that there are policies that are in Group Policy (new settings even!), that then are not natively supported through the Settings Catalog in Microsoft Intune. Some of this seems to be random, and no clear reason to why this is the case. What is even more frustrating, is either the lack of clear documentation on what settings are actually available, and when they become available, or categories that have gone away from the ADMX backed method all together and write settings to different locations. In this post, I\'ve written a couple of scripts to help admins with finding the settings that either exist or don\'t exist by exporting ADMX file data from a folder path, and then parsing that data through the Graph API.\\n\\n## The Issues\\n\\n### Issue #1: Settings in Intune do not write to the same locations as Group Policy\\n\\nThis is not consistent of course. A lot of settings do write to the same location as the group policy settings, but not all. Nothing is more frustrating that inconsistency. I\'m sure there are more that fall under this category. But from what I\'ve seen, the following write to different spots in the registry:\\n\\n- Bitlocker\\n- Windows Firewall\\n- Windows LAPS\\n- Windows Hello for Business\\n\\n### Issue #2: GPP Preferences\\n\\nI won\'t get into that too much here, that\'s already been asked for several times with no movement.\\n\\n- Printers\\n- Drive Mappings\\n- Registry Settings\\n- ODBC Settings\\n- Files\\n- Folders\\n\\nDoesn\'t seem like that\'s going to happen anytime soon.\\n\\n### Issue #3: Random settings in Intune aren\'t available\\n\\nWhy this happens, I have no idea. I see settings from [Microsoft\'s Security Compliance Toolkit](https://www.microsoft.com/en-us/download/details.aspx?id=55319&msockid=11ab0ae17f91669f2c121f517e176760) not available. I know there are settings from CIS\' Windows 11 Enterprise Benchmark that aren\'t available. VSCode even recently introduced Group Policy ADMX templates, but did not introduce Intune Settings Catalog policies? It\'s a very frustrating scenario, and one that does not seem to have any rhyme or reason to it.\\n\\n## Helping find what\'s available and what\'s missing\\n\\nI\'ve written two functions recently that I wanted to share with the community, and hope that someone will find it valuable. Both scripts are available on my [GitHub](https://github.com/pacers31colts18) or you can find them directly below:\\n\\n[Export-GPOADMXSettings](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings.ps1)\\n[Export-IntuneGPOSettings](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings.ps1)\\n\\n## Export-GPOADMXSettings\\n\\nWhile the Group Policy Analytics tool is available in Microsoft Intune, that is more for converting policies from Group Policy to Intune, or at least gathering the data on what is supported in already created group policies. What I am looking to do though, is export the settings from ADMX files themselves, and then find the corresponding Intune settings. Export-GPOADMXSettings helps do just that.\\n\\nWhen running the script, you are presented with two paths to take.\\n\\n- Option 1:\\n  - Enter a folder path that contains the ADMX files you want to analyze. This will then loop through all the ADMX files in the folder. Good for analyzing a few files, or a single file.\\n- Option 2:\\n  - Enter a domain name, this will then connect to the Sysvol and output the data.\\n\\nIf no parameter is specified, the function will default to loading a CSV file for a list of domains (our org has many). This will allow you to choose multiple domain names, with a **Title** header being the FQDN of the domain. From there, it\'s going to loop through each file and output the following data:\\n\\n- Domain\\n    - Domain you connected to (if any)\\n- SettingName\\n  - Name of the group policy setting (not the displayName)\\n- Class\\n  - HKCU\\n  - HKLM\\n  - Both\\n- Key\\n  - Registry key path of the policy\\n- ValueName\\n  - Registry value name of the policy\\n- ValueType\\n  - I tried to categorize this how they are in Group Policy when selecting the options:\\n    - List\\n    - Enabled/Disabled List\\n    - Enabled List\\n    - Disabled List\\n    - Enabled/Disabled Value\\n    - Enabled Value\\n    - Disabled Value\\n    - TextBox\\n    - MultiText\\n    - Number\\n    - Dropdown\\n    - Checkbox\\n    - String\\n- ChildKey\\n  - If exists, the child registry key path.\\n- ChildValue\\n  - If exists, teh child registry value.\\n- Category\\n  - The associated category of the policy\\n- SupportedOn\\n  - What OS, AppVersion, etc that the setting has support for.\\n- ADMXFile\\n  - The name of the ADMX file processed.\\n\\nNot all of this data is necessary for the next portion, but good to have if you are still working in a hybrid environment on a day to day basis. \\n\\n### Analyzing Common ADMX files\\nI\'ve put example outputs also on my GitHub page, but the direct links are here:\\n\\n[Microsoft OneDrive](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings/OneDrive_Export-GPOADMXSettings-20251010-1306.csv)\\n[FSLogix](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings/FSLogix_Export-GPOADMXSettings-20251010-1337.csv)\\n[Microsoft Edge](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings/Edge_Export-GPOADMXSettings-20251010-1144.csv)\\n[Google Chrome](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings/Chrome_Export-GPOADMXSettings-20251010-0807.csv)\\n[Azure Virtual Desktop](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Export-GPOADMXSettings/AVD_Export-GPOADMXSettings-20251011-1643.csv)\\n\\n## Export-IntuneGPOSettings\\n\\n*Note: Proper Graph API permissions are required for this. Feel free to checkout my [Getting Started with Microsoft Graph](https://joeloveless.com/2025/07/getting-started-with-microsoft-graph/) post if unfamiliar with Graph.*\\n\\nNow that we have the Group Policy data, we are going to run the Eport-IntuneGPOSettings function. The main API endpoint that we will be working with on this is this path: **https://graph.microsoft.com/beta/deviceManagement/configurationSettings**\\n\\nWhat we are doing with this is loading the previous csv file, and looping through the SettingName, and looking for matches.\\n\\n```powershell\\n#Load CSV\\n    Try { \\n        $csv = Import-Csv -path $inputfilepath\\n    }\\n    Catch {\\n        Write-Error \\"An error occurred importing CSV file: $_\\"\\n    }\\n\\n    #region Gather the settings\\nforeach ($gp in $csv){\\n    Try {\\n        $uri = \\"https://graph.microsoft.com/beta/deviceManagement/configurationSettings?`$filter=Name eq \'$($gp.settingName)\'\\"\\n        $Settings = (Invoke-MGGraphRequest -Method Get -Uri $uri).value | Where-Object { $_.applicability.platform -match \'windows\' }\\n\\n    }\\n    Catch {\\n        Write-Error \\"Error gathering settings\\"\\n    }\\n```\\nI found that there were matching setting names in iOS, Android, and MacOS when initially running this, so I needed to narrow down the results a little bit more. The unforunate outcome that I found is that a setting name in Edge, can have the same setting name in Google Chrome. Rather than try to filter it down anymore, and have possible bad results, I\'ve decided to leave this as is. Matching the Group Policy Category to the Intune Category was not an easy task.\\n\\nOnce finished, the following results will be returned:\\n\\n- GroupPolicyName\\n  - SettingName from the last CSV file\\n- GroupPolicyKey\\n  - Registry key path from the last CSV file\\n- GroupPolicyValueName\\n  - Registry key value name from the last CSV file\\n- IntuneName\\n  - Name of the policy in Microsoft Intune\\n- IntuneKeywords\\n  - Any of the keywords from the configurationsettings api\\n- IntuneRootDefinitionID\\n- IntuneDisplayName\\n- IntuneHelpText\\n- IntuneOffsetURI\\n- IntuneMinimumSupportedVersion\\n- IntuneWindowsSkus\\n  - Supported Windows Skus for the policy.\\n\\n## So what is missing?\\n\\nFrom the CSV files I gave above, let\'s take a look at what settings are available in Group Policy, available in Microsoft Intune, and what are missing in Microsoft Intune.\\n\\n### Azure Virtual Desktop\\n[AVD Results](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings/AVD_Export-IntuneGPOSettings-20251011-1722.csv)\\n- 7 Group Policy settings\\n- 8 Microsoft Intune settings\\n  - AVD_SERVER_WATERMARKING is listed twice in Microsoft Intune\\n    - [Deprecated] Enable watermarking\\n    - Enable watermarking\\nSo this is good, we have 100% support for AVD settings in the admx template file.\\n[Google Chrome](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings/Chrome_Export-IntuneGPOSettings-20251010-0808.csv)\\n- 691 Group Policy Settings\\n\\nI ran into a lot of duplicates here with Microsoft Edge being in the mix, along with settings marked Deprecated. Instead, I\'ll filter by Blanks on the CSV file.\\n\\n- 110 missing settings!\\n\\nNot good! Within these missing settings, the ones that stick out to me the most are:\\n- AIModeSettings\\n- DevToolsGenAiSettings\\n- GeminiSettings\\n- PasswordDismissCompromisedAlertEnabled\\n- PasswordManagerPasskeysEnabled\\n- PasswordSharingEnabled\\n- PrivacySandboxAdMeasurementEnabled\\n- PrivacySandboxAdTopicsEnabled\\n- PrivacySandboxFingerprintingProtectionEnabled\\n- PrivacySandboxIpProtectionEnabled\\n- PrivacySandboxPromptEnabled\\n- PrivacySandboxSiteEnabledAdsEnabled\\n\\nI would think/hope that there are orgs that would want a little bit more control over AI settings, password policies, and sandboxes in Intune that are purely cloud native?\\n[Microsoft Edge](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings/Edge_Export-IntuneGPOSettings-20251010-1144.csv)\\n- 835 Group Policy Settings\\n\\nSimilar to Google Chrome, we\'re going to see a lot of duplicates with the naming convention being the same.\\n\\n- 20 missing settings. I do not understand how a Microsoft product doesn\'t have support in a Microsoft product. Below are the missing settings:\\n  \\n- FileOrDirectoryPickerWithoutGestureAllowedForOrigins\\n- LiveVideoTranslationEnabled\\n- EdgeWalletCheckoutEnabled\\n- EdgeWalletCheckoutEnabled_recommended\\n- ShowTabPreviewEnabled\\n- ShowTabPreviewEnabled_recommended\\n- Pol_EdgePreviewEnrollmentTypeMicrosoftEdge\\n- BlockTruncatedCookies\\n- ChannelSearchKind\\n- ReleaseChannels\\n- AccessControlAllowMethodsInCORSPreflightSpecConformant\\n- OriginKeyedProcessesEnabled_recommended\\n- RelaunchFastIfOutdated\\n- AccessControlAllowMethodsInCORSPreflightSpecConformant\\n- BlockTruncatedCookies\\n- WAMAuthBelowWin10RS3Enabled\\n- WebRtcPostQuantumKeyAgreement\\n- AllowBackForwardCacheForCacheControlNoStorePageEnabled\\n- ExtensionsPerformanceDetectorEnabled_recommended\\n- PrivateNetworkAccessRestrictionsEnabled\\n[FSLogix](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings/FSLogix_Export-IntuneGPOSettings-20251010-1338.csv)\\n- 116 Group Policy settings\\n- Only 1 missing setting, this one might make sense:\\n  - ProfilesRoamGroupPolicyState\\n[Microsoft OneDrive](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneGPOSettings/OneDrive_Export-IntuneGPOSettings-20251010-1306.csv)\\n- 65 Group Policy Settings\\n- 6 missing Intune settings\\n  - AddedFolderHardDeleteOnUnmount\\n  - DisableOfflineModeForExternalLibraries\\n  - DisableOfflineMode\\n  - AddedFolderUnmountOnPermissionsLoss\\n  - SharePointOnPremApplicationIdUri\\n  - SharePointOnPremOIDC\\n\\n## Wrapping It Up\\n\\nThese are just some of the examples I ran into, with more being on the Windows setting side. Last time we refreshed our security baseline (pre-24H2), there were a lot more settings missing. I believe our count was around 180 settings not in the Settings Catalog. I\'d be curious to know what the reasoning is behind settings not being available, especially settings that resolve CVE\'s."},{"id":"exploring-microsoft-intune-filters","metadata":{"permalink":"/blog/exploring-microsoft-intune-filters","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-10-04-exploring-microsoft-intune-filters/index.md","source":"@site/blog/2025-10-04-exploring-microsoft-intune-filters/index.md","title":"Exploring Microsoft Intune Filters","description":"Details on filtering with Microsoft Intune.","date":"2025-10-04T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."}],"readingTime":5.27,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Exploring Microsoft Intune Filters","description":"Details on filtering with Microsoft Intune.","slug":"exploring-microsoft-intune-filters","date":"2025-10-04 00:00:00+0000","tags":["intune"]},"unlisted":false,"prevItem":{"title":"What Group Policy Settings aren\'t in Microsoft Intune?","permalink":"/blog/what-settings-are-in-intune"},"nextItem":{"title":"Making Dexcom better with Home Assistant Voice","permalink":"/blog/making-dexcom-better-wtih-homeassistant"}},"content":"A walk through on the options and setup of filters in Microsoft Intune.\\n\\n\x3c!-- truncate --\x3e\\n\\n## Intro\\n\\nIt\'s been a couple weeks since I\'ve made a post. A lot has been happening at our house. I went camping a few weekends ago with my daughter at Mille Lacs State Park. It was our first time checking out the Brainerd, MN area. We did a lot of hiking, and passed our 50 mile mark for the MN State Park Hiking Club. We visited Mille Lacs State Park, Crow Wing State Park, Father Hennepin State Park, and Lake Maria State Park before heading back home. It was a great weekend camping with her and checking out the area.\\n\\n![MN Hiking Club](hikingclub.jpg)\\n\\nI\'m a sucker for stopping for a good road-side attraction. When the whole family is in the car, I don\'t get the chance to stop. But when by myself or the kids, yeah I\'ll stop at every place I can. I probably get that from my dad. He stopped at the Corn Palace in Mitchell, South Dakota once.\\n![Paul Bunyan Land](babe.jpg)\\n\\nI bought this hammock for myself on camping trips. I don\'t think I\'ve used it for more than 5 minutes, the kids love to chill and read books in it though. It also protects from falling acorns.\\n![Hammock](hammock.jpg)\\n\\n\\n\\n\\nSince then, the kids have been back in school. She is starting 9th grade, while my son is starting 7th grade. They\'ve homeschooled the last few years, and now are doing online schooling through Minnetonka. Most likely, they\'ll transition back to in-person school after this year, depending on if we move or not. Where we live now is pretty damn rural, and not a lot to offer for them. With the RTO fun, we might be on the move (again). We\'ll see what the future holds, any move probably wouldn\'t be until the spring.\\n\\n\\n\\nI wanted to write a bit about using filters with Microsoft Intune, and provide the filters we use.\\n\\n## What are filters?\\n\\n[Scott Duffey](https://techcommunity.microsoft.com/blog/intunecustomersuccess/intune-grouping-targeting-and-filtering-recommendations-for-best-performance/2983058/replies/3571242) explains filters the best. My explanation is below.\\n\\n- Entra has groups.\\n   - Dynamic or Static groups\\n      - Dynamic groups take a bit of time to process.\\n        - This can cause slowness on the processing of policy assignments on a device.\\n- Intune has \\"virtual groups\\". The recommendation is to use these whenever possible.\\n  - All Devices\\n  - All Users\\n- With filters, you can then narrow down the scope of your assignments.\\n  - This is done at the device check-in, and is faster than the processing of groups.\\n\\nRecommendation: Use the built-in virtual groups + filters to be granular rather than relying on Dynamic or Static Groups.\\n\\nNotes: There are limitations to filters, just like there are limitations to the groups. We have not been able to 100% use filters, nor 100% use groups. For the most part, our assignments look like this:\\n\\n- Base policies will get assigned either All Devices or All Users (depending on the scope of the policy) with a filter assigned for the OS.\\n- If a group needs to be excluded, we then exclude the group, and assign to an exception profile that will include the same filter.\\n  - Note: I\'ll be writing a post on our policy design at a later date. We\'ve gone through many iterations of this and I believe we\'ve landed on something that works best.\\n\\n\\n## Creating Filters\\n\\nAn admin can create filters by going to [Microsoft Intune](https://intune.microsoft.com), choosing Devices, and then going to Assignment Filters. Once there, you should see a create button with two options:\\n1. Managed Devices\\n2. Managed Apps\\n\\nThere are a variety of different rules that you can create, for the full list, see [Microsoft Learn](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/filters-device-properties).\\n\\n## Common Windows Filters\\n\\nNow that you know what filters are, I want to provide you with the common Windows-based filters we use at our organization. Mostly, we use them for operating system criteria, AutoPilot group tags, and enrollment profiles. Obviously, there are other use cases.\\n\\n### Join Type Filters\\n\\n| Filter Name | Filter Rule | Description |\\n|-------------|-------------|-------------|\\n|ALL_EntraJoin_PROD| `(device.deviceTrustType -eq \\"Azure AD joined\\")` | All Entra joined endpoints. |\\n|ALL_HybridJoin_PROD| `(device.deviceTrustType -eq \\"Hybrid Azure AD joined\\")` | All hybrid joined endpoints. |\\n\\n### Windows 11 Filters\\n\\n| Filter Name | Filter Rule | Description |\\n|-------------|-------------|-------------|\\n| ALL_W11_PROD| `((device.osVersion -startsWith \\"10.0.22\\") or (device.osVersion -startsWith \\"10.0.26\\"))` | All Windows 11 endpoints. |\\n| ALL_W11_ENT_PROD | `(device.osVersion -startsWith \\"10.0.22\\") or (device.osVersion -startsWith \\"10.0.26\\")) and (device.operatingSystemSKU -eq \\"Enterprise\\")` | All Windows 11 Enterprise endpoints. |\\n| ALL_W11_PRO_PROD| `((device.osVersion -startsWith \\"10.0.22\\") or (device.osVersion -startsWith \\"10.0.26\\")) and (device.operatingSystemSKU -eq \\"Professional\\")` | All Windows 11 Professional endpoints. |\\n| ALL_W11_RDSH_PROD | `((device.osVersion -startsWith \\"10.0.22\\") or (device.osVersion -startsWith \\"10.0.26\\")) and (device.operatingSystemSKU -eq \\"ServerRdsh\\")` | All Windows 11 multi-session endpoints. |\\n| ALL_W11_LTSC_PROD | `((device.osVersion -startsWith \\"10.0.22\\") or (device.osVersion -startsWith \\"10.0.26\\")) and (device.operatingSystemSKU -eq \\"EnterpriseS\\")` | All Windows 11 LTSC endpoints. |\\n\\n### Virtual Machine Filters\\n\\n| Filter Name | Filter Rule | Description |\\n|-------------|-------------|-------------|\\n|ALL_WIN_VirtualMachines_PROD| `(device.model -eq \\"Virtual Machine\\") or (device.model -eq \\"VMWare\\")` | All virtual machines| \\n|ALL_WIN_VMWare_PROD | `(device.manufacturer -eq \\"VMWare, Inc.\\")` | All VMWare Virtual Machines|\\n|ALL_WIN_Hyper-V_PROD | `(device.manufacturer -eq \\"Microsoft Corporation\\") and (device.model -eq \\"Virtual Machine\\")` | All Hyper-V Virtual machines |\\n\\n### Azure Virtual Desktop Filters\\n\\n| Filter Name | Filter Rule | Description |\\n|-------------|-------------|-------------|\\n|ALL_AVD_PROD| `((device.operatingSystemSKU -eq \\"ServerRdsh\\") or (device.operatingSystemSKU -eq \\"Enterprise\\")) and (device.manufacturer -eq \\"Microsoft Corporation\\") and (device.model -eq \\"Virtual Machine\\")` | All AVD hosts. |\\n|ALL_AVD_Personal_PROD| `(device.operatingSystemSKU -eq \\"Enterprise\\") and (device.manufacturer -eq \\"Microsoft Corporation\\") and (device.model -eq \\"Virtual Machine\\")` | All Personal AVD hosts. |\\n|ALL_AVD_Pooled_PROD| `(device.operatingSystemSKU -eq \\"ServerRdsh\\") and (device.manufacturer -eq \\"Microsoft Corporation\\") and (device.model -eq \\"Virtual Machine\\")` | All pooled and remote app hosts. |\\n\\n*Note: If you have Hyper-V based virtual machines that are not AVD hosts, these filters will need to be tweaked. Intune does not have a great way of detecting these with filters other than OS. Naming conventions is probably the easiest way to detect, but that is not fool proof either.*\\n\\n### AutoPilot Filters\\n| Filter Name | Filter Rule | Description |\\n|-------------|-------------|-------------|\\n|ALL_AutoPilotEnrollment_PROD | `(device.enrollmentProfileName -eq \\"ProfileName\\")` | Autopilot example filter\\n\\n## Conclusion\\n\\nI\'m curious if anyone has a better design for the AVD limitations that we\'ve ran into for filters. We\'ve also noticed that Microsoft really hasn\'t expanded much on filters past the initial set they released. Hopefully this is something that can be expanded on in the future. I\'d love to see this tie into the Properties Catalog more, or to have more WMI based filtering similar to what Group Policy had."},{"id":"making-dexcom-better-wtih-homeassistant","metadata":{"permalink":"/blog/making-dexcom-better-wtih-homeassistant","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-09-03-making-dexcom-better-homeassistant/index.md","source":"@site/blog/2025-09-03-making-dexcom-better-homeassistant/index.md","title":"Making Dexcom better with Home Assistant Voice","description":"Integrating Dexcom with Home Assistant Voice.","date":"2025-09-03T00:00:00.000Z","tags":[{"inline":false,"label":"Home Assistant","permalink":"/blog/tags/home-assistant","description":"Home Assistant related posts."}],"readingTime":6.99,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Making Dexcom better with Home Assistant Voice","description":"Integrating Dexcom with Home Assistant Voice.","slug":"making-dexcom-better-wtih-homeassistant","date":"2025-09-03 00:00:00+0000","tags":["home-assistant"]},"unlisted":false,"prevItem":{"title":"Exploring Microsoft Intune Filters","permalink":"/blog/exploring-microsoft-intune-filters"},"nextItem":{"title":"Finding users that are enrolled in Windows Hello For Business","permalink":"/blog/finding-enrollment-count-windows-hello"}},"content":"import React from \'react\'\\nimport ReactPlayer from \'react-player\'\\n\\n\\nIntegrating Dexcom data with Home Assistant Voice.\\n\\n\x3c!-- truncate --\x3e\\n\\nHi everyone. I recently ordered a couple of the somewhat recently released [Home Assistant Voice Preview Edition\'s](https://www.home-assistant.io/voice-pe/), for a very specific need for my Type 1 Diabetic wife. She currently uses Dexcom G6, and while helpful, does have a laundry list of complaints with the product.\\n\\n- Sensors disconnecting randomly. She does not know of the disconnect until she pulls her phone out to look at the app to check her glucose level. This can be quite problematic for a diabetic, and pretty dangerous.\\n- Having to constantly pull her phone out to check. While quite an improvement over the technology of yesteryear, can be a distraction for people, especially if they have ADHD.\\n\\nLike any technologist, I got thinking of how I could help solve this. Selfishly, like any technologist, when you get the chance to play with new devices, you have to take advantage of that opportunity. \\n\\nI\'m a big fan of Home Assistant. Unfortunately, getting the Wife Approval Factor in place has been a challenge. Mainly because she doesn\'t care for technology all that much, and finds my tinkering to be a waste of money. I\'ll show her I said!\\n\\n## Researching Options\\n\\n### Digging for the Solution\\n\\nBefore I started ordering these, I had to brainstorm a little bit, and think how I could accomplish what I **think** she wanted. I had possible ideas in mind.\\n\\nAt MMS 2025, [Matt Zaske](https://mattzaske.com/blog/2025-07/configuringusing-awtrix-3-ulanzi-tc001-through-home-assistant) had a demo on the Awtrix 3. This was the inital rabbit hole I started to go down, an always on display showing what was needed.\\n\\n- Diabetic Specific Solutions\\n  - [Sugar Pixels](https://customtypeone.com/products/sugarpixel)\\n  - [Glowcose](https://glowcose.com/)\\n- DIY Solutions\\n  - Awtrix 3\\n    - Not a fan of the pixelated interface in my living room.\\n  - ESP32 Displays\\n    - Doable, but do I want to and will I do the tinkering? My fear is this would be a Raspberry Pi that I order and then never look at.\\n  - Tablets\\n    - Not sure I want to buy a tablet just for this purpose.\\n\\nI liked the idea of the Glowcose, but I didn\'t like that it was limited to a single use case. I could have gone the more DIY route, but factoring in time and cost, I\'m not sure how much I\'d be on board. There is also the wife acceptance factor, I didn\'t want a frankenstein of wires throughout the house.\\n\\nWhile in the [WinAdmins](https://winadmins.io) discord, someone was talking about the Home Assistant Voice that they recently ordered. From there, my curiosity (or ADHD) sparked my interest and I got going down the rabbit hole.\\n\\n### Why I chose Home Assistant Voice\\n\\nHome Assistant Voice gave me multiple options. I didn\'t want to have a device that only solved one use case, I wanted to solve (or tinker) multiple solutions.\\n\\n- \u2705\ufe0fMultiple use cases\\n  - This can be used for other automations, not just Dexcom. Win for me!\\n- \u2705\ufe0fAbility to ask questions\\n  - \\"Hey Jarvis, what\'s my wife\'s glucose level?\\n- \u2705\ufe0fAbility to glance over and get a sense of the status\\n  - Home Assistant Voice has a ring LED light you can program.\\n- \u2705\ufe0fLocal and not cloud based.\\n  - I\'ve had enough issues with Google Home getting worse and worse over the years, I didn\'t want to invest in a cloud based product.\\n- \u2705\ufe0f BONUS: A programmable button that you can automate\\n  - 4 button combos are available:\\n    - Long Press\\n    - Double Press\\n    - Triple Press\\n    - Easter Egg Press\\n\\n## Unboxing and Setup\\n\\n### Unboxing the Device\\n\\nMy only complaint so far, the device did not come with something to power the device. I\'m not a fan of manufacturers doing this. For some reason\\n\\n- I found 8 extra USB-C cables in 8 different locations in either my office, garage, or bedroom. Why are they in the garage? Not sure. Surprisingly, none were in my junk drawer in the kitchen.\\n  - For those curious:\\n    - 5 USB-C to USB-C.\\n    - 3 USB-A to USB-C.\\n    - A gazillion Micro USB cables.\\n\\n For some reason, I do not have 8 extra USB-C power bricks. For the time being, I took a brick off my Pixel dock to use.\\n\\n ![Unboxing](unboxing.png)\\n\\n ### Setting up the Device\\n\\n There are some requirements before setting up the device for this use case.\\n\\n - Must already be running Home Assistant\\n - Must have the Dexcom Integration added\\n\\nOnce those parts are done, device setup was pretty straight forward. I followed the instructions given in the box, and in less than 5 minutes, I had my device setup. I found the process to be much smoother and straight forward than Google Home or Amazon Alexa. I didn\'t have a ton of screens to opt in and out of \\"features\\" that I don\'t want.\\n\\nOne last step to note, you then will need to expose the Dexcom entities to your Voice Assistants.\\n\\n![Expose](expose.png)\\n\\n## Automations\\n\\n### Where do I begin?\\n\\nBack to the original use cases, I wanted to do the following:\\n\\n- Give her the ability to glance over, get a sense of what her glucose level is.\\n  - LED Ring\\n- Be able to know if her glucose level is rapidly rising or falling.\\n  - LED Ring\\n- Be able to check her glucose level without pulling her phone out.\\n  - Button press\\n  - Talking to the device and getting a response\\n\\n*Before going further, you can find my automations on my [GitHub](https://github.com/Pacers31Colts18/HomeAssistant/tree/main/Automations). I\'ve omitted the username, replace the USERNAME with your username. You will also need to tweak to match the entity ID of your voice assistant.*\\n\\n### LED Ring Automation\\n\\nThinking further through the use cases, I came up with the following:\\n\\n- LED Light: Red\\n  - glucose level is below 80\\n  - glucose level is above 150\\n- LED Light: Blue\\n  - Status is Unavailable or Unknown. Dexcom, for whatever reason in the past 6 months or so has been awful about the sensor not communicating properly with the transmitter. There are plenty of Reddit threads on the issue, but Dexcom doesn\'t seem to be addressing the issue. I wanted to provide a light that would make her aware when the sensor was not communicating.\\n- LED Light: Green\\n  - I had trouble getting the light automation to go from the off state back to the on state. I didn\'t necessarily want a bright green light all the time. Instead what I did for this one was to set it to Green, but turn the brightness down to 0 percent. That way, if she does decide that she would like the light on, we can just increase the percentage.\\n- LED Light: Yellow\\n  - Dexcom provides trend statuses to tell the user how quickly their glucose level is either increasing or decreasing. With the light being yellow, means the trend is either:\\n    - Rising Quickly\\n    - Falling Quickly\\n\\nThis gives me 7 total branches in my automation.\\n\\n- Option 1: glucose level is either above 150 AND below 80\\n- Option 2: glucose level is below 80\\n- Option 3: glucose level is above 150\\n- Option 4: glucose level is rising quickly\\n- Option 5: glucose level is falling quickly\\n- Option 6: glucose level is unknown\\n- Option 7: glucose level is unavailable\\n\\n*Note: I do not know what the difference is between Unknown and Unavailable, Home Assistant gave me both of those options. My theory is Unavailable is when it stops communicating completely, Unknown is when it just can\'t read the value yet*\\n\\n![Blue](blue.png)\\n\\n### Button Press Automation\\n\\nThe next automation to do was to configure the button press. This one was much simpler, as I\'m just wanting the glucose level announced when doubling pressing the button.\\n\\nI love how there are multiple button combinations you can do. My yaml file is just stripped down to the basics of this automation for simplicity.\\n\\n*Future enhancement idea: Let me Morse code to the other Home Assistant Voice through taps and have it translate to speech*\\n\\n<ReactPlayer src=\'https://www.youtube.com/watch?v=uwgj1jshMsY\' />\\n\\n### Voice Announcement\\n\\nOf course, you can also talk to the device to get the current glucose level. I love the different options that are available on this thing!\\n\\n<ReactPlayer src=\'https://www.youtube.com/watch?v=gGs5SkUV9n0\' />\\n\\n\\n## Conclusion\\n\\nA little bit different of a post, but hopefully helpful to others out there! Let me know if you have any questions or comments, I\'ve added a shiny new GitHub commenting system."},{"id":"finding-enrollment-count-windows-hello","metadata":{"permalink":"/blog/finding-enrollment-count-windows-hello","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-08-31-finding-enrollment-count-for-windows-hello/index.md","source":"@site/blog/2025-08-31-finding-enrollment-count-for-windows-hello/index.md","title":"Finding users that are enrolled in Windows Hello For Business","description":"A guide to finding how many users are enrolled in Windows Hello for Business on a device.","date":"2025-08-31T00:00:00.000Z","tags":[{"inline":false,"label":"Windows Hello","permalink":"/blog/tags/windows-hello","description":"Windows Hello related posts."},{"inline":false,"label":"Remediation Scripts","permalink":"/blog/tags/remediation-scripts","description":"Remediation Scripts related posts."},{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."}],"readingTime":3.19,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Finding users that are enrolled in Windows Hello For Business","description":"A guide to finding how many users are enrolled in Windows Hello for Business on a device.","slug":"finding-enrollment-count-windows-hello","date":"2025-08-31T00:00:00.000Z","tags":["windows-hello","remediation-scripts","intune"]},"unlisted":false,"prevItem":{"title":"Making Dexcom better with Home Assistant Voice","permalink":"/blog/making-dexcom-better-wtih-homeassistant"},"nextItem":{"title":"Gathering Data for a Windows Hello for Business Rollout","permalink":"/blog/gathering-data-for-windows-hello"}},"content":"\x3c!-- truncate --\x3e\\n\\nIt\'s been a minute since my last post. Since then, we\'ve still been rolling out Windows Hello for Business at work as a project, along with many other tasks, projects, etc. Employee review season is upon us, so I need to start figuring out what all I did in the last year, and what I want to achieve in the upcoming year. It\'s one of those exercises I\'m not the biggest fan of, mainly because I feel that I have to talk about myself more than I ever want to.\\n\\nOn the home front, we\'ve been gearing up for the new school year and the end of the summer. I\'m hoping to take my daughter camping next weekend, maybe some place up north in Minnesota. Anything is up north for us in Minnesota, as we live in one of the bordering counties of Iowa. What I really mean by up north is past the Twin Cities. I\'ve also started yet another project, trying to finish the drywall mudding in my office/loft above the garage. The previous owners finished the mudding about 40% of the way. I\'m now three years into living at this house, and just attempting to get it done. By the time I do get it done, we\'ll probably/hopefully be moving again.\\n\\nFrom the blog side of things, I did a little thinking and reading and decided to do away with the ChatGPT generated images. I found them interesting, yes, but also felt that it sort of cheapens everything that I am trying to do. If I am willing to put in the work and write, why should I just use AI generated images? Seems silly to me. Unfortunately, I am not a graphic artist. I tried that route when I was about 19 and found out quickly that it wasn\'t for me (aka I sucked at it) at Ivy Tech Community College. So I am playing around with the idea of templated cover images instead. Let me know what you think!\\n\\nOne of the asks in this project, as we\'ve been rolling out Windows Hello to internal pilot testers, was gathering how many users/devices have actually enrolled in Windows Hello for Business on their device.\\n\\n## The Entra Way\\n\\nBefore I dive into the detection script I have, I want to point out that this data is available in Microsoft Entra natively under the Authentication Methods blade. If you work in an enterprise environment, you might not have the proper roles to access that data. From what I have seen also, this data is more \\"user-centric\\" rather than device based. I was looking for the data from the device side of things.\\n\\n## Intune Detection Scripts\\n\\nAt the same time I was trying to piece everything together, Johanne\'s dropped a timely blog post that gave me the starting point of my script. Check it out [here](https://johannesblog.com/2025/08/07/last-authentication-used/). His blog goes into finding the last authentication method used.\\n\\nUsing that script, I now know that D6886603-9D2F-4EB2-B667-1971041FA96B = \'WHFB PIN, NGC Credential Provider\'.\\n\\n```powershell\\n    HKLM:\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Authentication\\\\Credential Providers\\\\{D6886603-9D2F-4EB2-B667-1971041FA96B}\\n```\\n\\nYou can find the script [here](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/Detection-WindowsHelloForBusiness-EnrollmentCount.ps1). Now, create a new Detection Script in Microsoft Intune under Scripts and Remediations.\\n\\n## Detection Script Setup\\n\\n![Detection Create Basics](detection_create_basics.png)\\n\\n![Detection Create Settings](detection_create_settings.png)\\n\\nOnce the data is gathered, under the Column settings, turn on the **Pre-remediation detection output** under Device Status, this will give you the output of how many users are enrolled.\\n\\n![Detection Output](detection_output.png)\\n\\nClicking on review, will then give you the total number of users enrolled. Of course, I would recommend exporting the data instead, and then provide that data to whoever would need it."},{"id":"gathering-data-for-windows-hello","metadata":{"permalink":"/blog/gathering-data-for-windows-hello","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-08-09-gathering-data-for-windows-hello/index.md","source":"@site/blog/2025-08-09-gathering-data-for-windows-hello/index.md","title":"Gathering Data for a Windows Hello for Business Rollout","description":"A guide to gathering data for a successful Windows Hello For Business rollout using Microsoft Intune detection scripts.","date":"2025-08-09T00:00:00.000Z","tags":[{"inline":false,"label":"Windows Hello","permalink":"/blog/tags/windows-hello","description":"Windows Hello related posts."},{"inline":false,"label":"Remediation Scripts","permalink":"/blog/tags/remediation-scripts","description":"Remediation Scripts related posts."},{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."}],"readingTime":3.83,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Gathering Data for a Windows Hello for Business Rollout","description":"A guide to gathering data for a successful Windows Hello For Business rollout using Microsoft Intune detection scripts.","slug":"gathering-data-for-windows-hello","date":"2025-08-09T00:00:00.000Z","tags":["windows-hello","remediation-scripts","intune"]},"unlisted":false,"prevItem":{"title":"Finding users that are enrolled in Windows Hello For Business","permalink":"/blog/finding-enrollment-count-windows-hello"},"nextItem":{"title":"Finding Group Policy settings by category","permalink":"/blog/search-gpocategory"}},"content":"\x3c!-- truncate --\x3e\\n\\nHello there! It\'s been a couple weeks since my last post. I\'ve been slammed at work with various projects (Azure Virtual Desktop, Windows Hello for Business, etc, etc), studying for the AZ-104 certification (trying to meet my employee goal before the end of the year), various things around the house (still working on flooring, painting, gardening), and the usual business of summer. My son got his first stripe in jiujitsu. He\'s been doing this since about February/March, trying to improve his mental health and getting more active. While he certainly has his days where he doesn\'t want to go, he\'s been pretty great about going two times a week. When he leaves class, he\'s always smiling and happy. Seeing his improvement both with his overall attitude and how he\'s improving with jiujitsu has been awesome to see. I\'m pretty proud of him for sticking with it, and getting his first stripe!\\n\\nI am trying to be more consistent with this, but struggling to either find the time, or just having general writer\'s block. I need to get out of the mindset of not writing something because someone else has already written it, and just try to write something from my perspective. One of the projects we are working on at work is Windows Hello for Business. While there are plenty of guides out there on how to implement, we\'ve gotten some random questions regarding shared workstations, different models and their supported biometrics, and how we can have a successful rollout. The goal of this post is to provide some helpful scripts to start the journey for Windows Hello.\\n\\nThe solutions I am posting below are designed for Intune Remediation Scripts (using a Detection method), this can probably be achieved in other ways (Configuration Items/Baselines), but we\'re starting to shift away from that and focus on Intune more and more.\\n\\n##  What types of biometrics are on our devices?\\n\\nWith any large organization, you probably have multiple makes and models spanning multiple years (hopefully four or less years) and are wondering how users will be able to login with Windows Hello for Business?\\n\\nWindows Hello supports three types of biometric sign in (Source: https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/#biometric-sign-in)\\n- Facial Recognition\\n- Fingerprint\\n- Iris recognition\\n  - Note: I\'m yet to see a device that can do this. I didn\'t even know it was a thing until writing this!\\n\\nAs we are starting to write knowledge base articles for our end users, we want to provide them with the correct instructions. If they don\'t have Facial and Fingerprint, we are most likely going to only provide instructions for one or the other.\\n\\n[Intune Detection Script - Biometrics](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/Detection-WindowsHelloForBusiness-BiometricDevices.ps1)\\n\\nI\'ve linked the script to detect the different biometrics above. This should be configured as a Detection Script in Microsoft Intune, with the default configurations. Once configured and the script has ran for enough time, you can add the **Pre-remediation detection output** column, and should see results similiar to below:\\n\\n![Biometric data](biometrics.png)\\n![Biometric Data Review](biometrics2.png)\\n\\nThe output can also be exported to a CSV file for further review.\\n\\n## How many user profiles are on our devices?\\n\\nAnother gotcha to look out for is how many user profiles are on your workstations. Windows Hello for Business supports a maximum of ten enrollments on a single device. This is Face or Fingerprint.\\n\\nSource: https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/faq#how-many-users-can-enroll-for-windows-hello-for-business-on-a-single-windows-device\\n\\nThe initial group we are exploring rolling this out for has a large footprint of shared devices, with multiple people rotating in and out daily and even hourly, so we either need to exclude those devices, or look at other options (Yubikey, etc)\\n\\n[Intune Detection Script - Profile Count](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/Detection-WindowsHelloForBusiness-ProfileCount.ps1)\\n\\nThe detection script for this is also above, with the $excludedProfiles variable allowing you to exclude any profile you want. In my case, I\'m excluding Administrator, Guest, Public, Default, and defaultuser0. I\'m also looking for sign-ins for the last 90 days, hoping to capture accurate stats and not just devices with really stale profiles (that probably need to be remediated at some point)\\n\\nIf the script finds more than 10 profiles, this will return non-compliant. Less than 10 profiles, the script will return compliant.\\n\\nThis should also be ran as a Detection Script only in Microsoft Intune with the default configurations."},{"id":"search-gpocategory","metadata":{"permalink":"/blog/search-gpocategory","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-07-19-finding-group-policy-settings-by-category/index.md","source":"@site/blog/2025-07-19-finding-group-policy-settings-by-category/index.md","title":"Finding Group Policy settings by category","description":"A PowerShell script to search for GPO settings by category.","date":"2025-07-19T00:00:00.000Z","tags":[{"inline":false,"label":"Group Policy","permalink":"/blog/tags/group-policy","description":"Group Policy related posts."},{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."},{"inline":false,"label":"Hybrid","permalink":"/blog/tags/hybrid","description":"Hybrid related posts."},{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."}],"readingTime":5.95,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Finding Group Policy settings by category","description":"A PowerShell script to search for GPO settings by category.","slug":"search-gpocategory","date":"2025-07-19 00:00:00+0000","thumbnail":"/img/blog/cover-yellow.png","tags":["group-policy","powershell","hybrid","intune"]},"unlisted":false,"prevItem":{"title":"Gathering Data for a Windows Hello for Business Rollout","permalink":"/blog/gathering-data-for-windows-hello"},"nextItem":{"title":"Getting Started with Microsoft Graph","permalink":"/blog/getting-started-with-microsoft-graph"}},"content":"A helpful PowerShell script to search for group policy settings by category.\\n\\n\x3c!-- truncate --\x3e\\n\\nGreetings everyone. I wanted to share some of our functions that we\'ve been using on our migration path from Group Policy to Microsoft Intune. This is a new one I just wrote this week, and think it will be very helpful. In our environment, we have multiple forests (27+). We\'ve been migrating our standard workstation policies, but with 27 forests, we\'re discovering we still have a lot of cleanup to do. \\n\\nWhile the push is for pure Entra join, many organizations aren\'t ready to commit to that (not for lack of trying to convince management otherwise), and will be in the hybrid scenario for quite a while. I\'m always quite interested when I go to MMS and see the amount of hands that are either co-managed with Configuration Manager, or using Hybrid Join with Active Directory. Despite the marketing push from Microsoft, and all the new technology going into Azure/Entra/Intune, I don\'t think Active Directory or Configuration Manager are going anywhere anytime soon. \\n\\n## Search-GPOCategory\\n\\nI\'m not going to go into a step by step breakdown of the script like I have done in previous posts. I\'m not sure how much value there is in that, but will give a slight breakdown of it here. If you have any questions on it, please feel free to reach out to me and I can answer any questions on it. The function can be found on my [GitHub](https://github.com/Pacers31Colts18/GroupPolicy/blob/master/Search-GPOCategory.ps1)\\n\\n### Summary\\n\\n```powershell\\n[CmdletBinding()]\\n    Param(\\n        [Parameter(Mandatory = $False)]\\n        [array]$Domains,\\n        [Parameter(Mandatory = $True, HelpMessage = \\"Category to search for\\")]\\n        [array]$Category,\\n        [ValidateSet(\'All\', \'Computer\', \'User\')]\\n        [string]$PolicyScope = \'All\'\\n    )\\n\\n    #region Parameter Logic\\n    if ($Domains.Count -eq 0) { $Domains = (Import-CSV -path $global:DomainsFile | Out-GridView -PassThru).Title }\\n    #endregion\\n```\\n\\n- $Domains\\n  - As with most of our functions, we\'re asking for an array (or single) domain. If you do not list a domain, we\'ll attempt to load a CSV file containing our domains. If using a CSV title, the header should contain Title for the list of domains.\\n- $Category\\n  - This is the category (or multiple categories) that you\'re searching for. In my example, I will use \\"Microsoft Edge\\". This is looking for anything *like* Microsoft Edge. That means it will pull Windows Components\\\\Microsoft Edge, Microsoft Edge\\\\Downloads, Microsoft Edge, etc.\\n- $PolicyScope\\n  - This allows you to narrow it down a little bit more, so you\'re able to search the Computer or User side of the policy, or just search all of the policy.\\n\\n### Data Returned\\n\\nThe following will be returned in the CSV file:\\n- DomainName\\n  - The domain the policy is on.\\n- PolicyName\\n  - The name of the GPO.\\n- PolicyStatus\\n  - ![Policy Status](gpo_status.png)\\n- Category\\n  - The category found. Example: Windows Components/Microsoft Edge\\n- Area\\n  - Computer or User\\n- Setting Name\\n  - The name of the settings found\\n- Setting State\\n  - Enabled/Disabled/whichever else. Will not return Not Configured.\\n- Enabled OU Links\\n  - All the OU links for the GPO, separated by a \\";\\"\\n- Security Filtering\\n  - The security filtering applied to the policy.\\n\\n![Example Data](example_data.png)\\n\\n## Background\\n\\nA little bit of history from the org I work in (and previous orgs up to Step 5). If you work in Education or Government, you\'re probably all too familiar with this process.\\n\\n1. **Centralization**\\n    - Higher ups decide to centralize IT services.\\n    - All local teams to start using central enterprise IT. Education and Government just love doing this.\\n2. **Policies managed by other teams**\\n    - Here is this random structure of GPOs and OUs, have at it, not our problem anymore.\\n3. **OU Migration (Workstations)**\\n    - We then migrate all the workstations to an enterprise managed OU.\\n    - While trying not to break things too much, some legacy policies will move over also.\\n    - Process can take 3 months to 3 years (yay politics!)\\n4. **OU Migration (Users)**\\n    - Haven\'t even touched these yet, legacy policies and structure still hangs out there.\\n    - **Why does User policies always fall on the Endpoint teams? A question I\'ve been pondering**\\n5. **Let\'s use Intune!**\\n    - We\'re well underway migrating our core policies that we have applied in all forests to Microsoft Intune.\\n    - We\'ve reviewed policies, determining if they still make sense to move.\\n    - Inconsistencies from 1-4\\n      - User policies\\n        - Some previous teams did more configuration on the user side rather than workstation side. Can see duplicate settings on the user side vs. Intune policy, or settings doing the opposite of what we want\\n      - Legacy policies\\n        - Duplication\\n        - Frankstein policies\\n      - One off policies\\n        - Some department needed x setting and is filtered down a bit. Not a high priority, but would rather see all of that Category managed from a central spot and not a mixture.\\n\\n## The Next Step\\n\\nNow that we have our core policies moved into Intune, and being managed under the great central pane of glass, we\'re looking into stopping the inconsistencies, and really level setting the policies. My goal is to look at our core policies, and break these out by category. We then have some functions in our module that can help with this process. A previous one we get great use out of is Search-GPOString, this allows us to search GPO objects in all our forests by a query and get the GPO objects back, along with their status, security filtering, and linked OUs. This is great for finding single settings.\\n\\nThis week, I came up with the idea to search by category. By category, I mean I am looking specifically for this:\\n\\n![GPO Category](gpo_category.png)\\n\\nFrom there, we are then returning the settings associated with that category, along with details on the policy.\\n\\n## What do we do with that data?\\n\\nFrom there, we can really breakdown our policy structure even more, and make more determinations.\\n\\n- Do these policies make sense in 2025? \\n- Are these policies better (more secure) than what we currently have in place? \\n- Do we want to simplify and do away with these policies? \\n  - What will be the impact if we do that?\\n\\n## Piloting\\n\\nNo matter what decision that is made, we\'re then going to pilot this out. Daniel Ratliff had a great blog post [Managing Endpoint Policies for the Enterprise](https://potentengineer.com/2025/07/02/managing-endpoint-policies-for-the-enterprise.html), that serves as a great reminder. For us, we like to use the randomized process, but as we develop pilot groups more, might revisit the idea. See [here](https://joeloveless.com/2025/04/entra-grouprandomization/) for details on our randomization process if interested.\\n\\nWhile we all want to move a little quicker, and get done with migrating policies, we will never truly be done. There will always be some other policy to create, tweak, or get rid of. There is no finish line to this, so take your time and try to fly under the radar as much as possible when doing policy migrations.\\n\\n## Conclusion\\n\\nI\'ll be publishing some more Group Policy related scripts to help people on their migration from GPO to Intune. I\'m curious to know what other people are doing in their environments, whether doing a complete overhaul, migrating to new OUs through attrition (new builds), a mixture, or totally scrapping AD and going Entra only."},{"id":"getting-started-with-microsoft-graph","metadata":{"permalink":"/blog/getting-started-with-microsoft-graph","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-07-13-getting-started-with-microsoft-graph/index.md","source":"@site/blog/2025-07-13-getting-started-with-microsoft-graph/index.md","title":"Getting Started with Microsoft Graph","description":"A guide to Microsoft Graph","date":"2025-07-13T00:00:00.000Z","tags":[{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."},{"inline":false,"label":"Graph API","permalink":"/blog/tags/graph-api","description":"Microsoft Graph API related posts."}],"readingTime":14.09,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Getting Started with Microsoft Graph","description":"A guide to Microsoft Graph","slug":"getting-started-with-microsoft-graph","date":"2025-07-13 00:00:00+0000","thumbnail":"/img/blog/cover-red.png","tags":["powershell","graph-api"]},"unlisted":false,"prevItem":{"title":"Finding Group Policy settings by category","permalink":"/blog/search-gpocategory"},"nextItem":{"title":"Tech tools I use at home and at work","permalink":"/blog/tech-tools-I-use"}},"content":"A guide to show the different options for working with Microsoft Graph.\\n\\n\x3c!-- truncate --\x3e\\n\\n\\nGood morning everyone! I\'ve been struggling lately with things to write, and also struggling with making time to write. I feel like this summer we\'ve been slammed at work with different projects, I\'ve been slammed at home with different projects, and have generally just been a little tired. I\'m attempting to launch a consulting company, so I\'ve been working through trying to get that off the ground (design a website first), so that has been eating into my time. While weed eating our wooded trail yesterday, I was thinking of different posts to make. One that I\'ve been wanting to write about is my thoughts on Microsoft Graph and all the pain points I\'ve experienced myself as a general noobie to Graph. I\'ve been using Microsoft Graph the last three years in different capacities. This would be either through the SDK, native API calls, or using Invoke-MgGraphRequest.\\n\\nLast week, we had an incident pop-up where our Apple VPP apps had their assignments removed when we put in the new VPP cert. So, I wrote a Powershell script that called the Graph API to retrieve the application assignments after we went through and re-assigned everything. Unfortunately, I did not have this data beforehand. But, for this post, I\'m going to use the script I developed as an example for configuration. The main script can be found here [Export-IntuneApplicationAssignments](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneApplicationAssignments.ps1)\\n\\n## Common Terms and Painpoints\\n\\nBefore starting, I want to list out some common terms and some common pain points I\'ve ran into. A lot of this will be dependent on what your environment looks like and what you are doing with Microsoft Graph.\\n\\n### Common Terms\\n\\nTo use the Microsoft Graph API, you need access. Typically, Microsoft Graph is not going to be wide open for you to just connect to and run commands against. Thinking to the Active Directory world, you would have permissions delegated to your privileged account (hopefully) and then you would perform actions. Instead, in the Azure world, you will grant permissions to an App Registration. Microsoft has provided all the permissions to configure, allowing you to get very granular and use the principal of least privilege.\\n\\n[Permissions Consent Overview](https://learn.microsoft.com/en-us/entra/identity-platform/permissions-consent-overview)\\n\\n- Types of Access\\n  - Delegated\\n    - Connecting to a resource on behalf of the signed in user.\\n    - Used for running scripts on demand with no automation tied to it.\\n    - I use this most commonly in my day to day work over Application permissions.\\n  - Application\\n    - Connecting to a resource as itself.\\n    - User is not needed to authenticate\\n    - I use this with automation (Azure Runbooks, Github Actions, etc)\\n\\nGoing back to the Active Directory scenario. With Delegated, I\'d equate that to me running a script with my privileged account whenever necessary. Where if I then wanted any sort of automation (Scheduled Task maybe?), I\'d probably have a Service Account with the permissions needed to then run the task.\\n\\n- Pagination\\n  - Because you\'re now working in this huge environment, that has multiple customers, we need to be more efficient. On some of the data requests, Microsoft \\"pages\\" the data. Meaning, you will only get back chunks of results at a time. If wanting to return ALL the data (because who doesn\'t), you then have to use pagination to keep going through the results.\\n\\n[Paging Microsoft Graph data in your app](https://learn.microsoft.com/en-us/graph/paging?tabs=http)\\n[Practical Graph: All About Pagination and Fetching Data](https://practical365.com/pagination-graph-sdk/)\\n[How To Handle Microsoft Graph Paging in PowerShell](https://medium.com/@mozzeph/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a)\\n\\n- Beta vs. v1.0\\n  - While Beta is just that, Beta. I\'ve yet to really see anything go from Beta to 1.0, where much of the functionality needed is in Beta. For that reason, I tend to default to Beta, and only fall back to v1.0 if I absolutely have to.\\n\\n## Getting Started - App Registration\\n\\n\\n1. Open Azure (portal.azure.com), and go to App Registrations\\n2. Click *New Registration*\\n3. Fill in the details, making note of the Redirect URI\\n   - This will prompt the user for authentication using the Microsoft authentication.\\n\\n![Delegated App Registration](appregistration-delegated.png)\\n\\n4. Once created, click on API Permissions.\\n   - By default, the application will have User.Read permissions\\n\\n![Delegated API Permissions](appregistration-delegated-apipermissions.png)\\n\\n5. Click Add a Permission\\n6. Click Microsoft Graph\\n7. Choose Permissions\\n  - Application\\n  - Delegated (I\'m choosing Delegated in this walk through)\\n8. Scroll down to DeviceManagementApps, then choose **DeviceManagementApps.Read.All**\\n   - We\'re trying to use the principle of least privilege here, so we\'re only choosing Read permissions.\\n9.  Now that the permission is added, we still aren\'t done. Somebody has to sign off on the permissions being added, that\'s why the Status is \\"Not granted\\"\\n\\n![Grant Admin Consent](appregistration-permission1.png)\\n1.  We\'ll need someone with the proper permissions to Grant Admin Consent.\\n    - [Grant tenant-wide admin consent to an application](https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/grant-admin-consent?pivots=portal)\\n2.  Thankfully, this is my Lab tenant, and I have Global Admin.\\n\\n![Easy Peasy](easypeasy.gif)\\n\\n![Granted Consent](appregistration-permission2.png)\\n\\n3. One last step, go to Authentication, and add http://localhost into the Mobile and Desktop applications Redirect URIs section\\n\\n![Authentication](authentication.png)\\n\\nWe\'ve now configured our Delegated App Registration that will allow us to connect, we can then restrict who can access the application.\\n\\n1. Back in the Azure portal, go to Enterprise Applications.\\n2. Find your newly created application and go to Users and Groups.\\n3. Add any user who should have permissions here.\\n\\n\\n\\nSo with this configuration we have:\\n\\nUser (with permissions) ---------\x3e Connects to Application ---------\x3e Application has permissions ------------\x3e Application makes requests to Microsoft Graph\\n\\n#### That\'s fantastic, but how do I know what permissions I need?\\n\\nKnowing what permissions you need can be challenging. Fortunately, there are many tools provided to do such a job. I\'m not going to go into great detail about how to use each one of them, those can be other posts. \\n\\n[Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer)\\n[Graph X-Ray](https://graphxray.merill.net/)\\n[PostMan](https://desktop.postman.com/?desktopVersion=10.6.0)\\n[Graph API Documentation](https://learn.microsoft.com/en-us/graph/api/overview?view=graph-rest-beta)\\n\\nAbove are either tools from Microsoft or third party tools to get started. Personally, I like to just look at the network calls being made in Microsoft Edge to find out what the calls are, and then I can typically find the right permissions based off that. The Graph API documentation is also a great starting place, you just have to know how to navigate and know what you are looking for.\\n\\nSo in this example scenario, we\'re wanting to get application assignments.\\n\\n1. Go to [Microsoft Intune](https://intune.microsoft.com)\\n2. Click Apps\\n3. Using Edge, hit F12 and open Developer Tools.\\n4. Make sure the Network tab is selected.\\n5. In this case (probably a bad example to be honest) I\'m going to create a new app with the Network tab open\\n6. Make the application available to All Users\\n\\nYou should then start seeing a bunch of calls being made\\n\\n![Developer Tools](developertools-name.png)\\n\\nMost of this looks like garbage to me, anything with .js is worthless to me. \\n\\n![Developer Tools - Request URL](developertools-requesturl.png)\\n\\nBut, I then see this mobileapps. This is my starting point for configuring the permissions (and when I go to write my PowerShell script)\\n\\nhttps://graph.microsoft.com/beta/**deviceAppManagement**/mobileApps/\\n\\n- DeviceAppManagement (Intune) = DeviceManagementApps (Azure)\\n  - Microsoft is never consistent with naming!\\n\\n## Authentication\\n\\nOkay, now we have the App Registration configured, how do we connect to it?\\n\\nWe have two scenarios for connection, native Rest API connection(Get-MSALToken), or connecting with Microsoft Graph.\\n\\n### Invoke-RestMethod/Get-MSALToken\\n\\nI find this to be the most difficult to connect to, but let\'s give it a shot and see if I can explain it and figure it out myself.\\n\\n1. Install Get-MSALToken\\n\\n```powershell\\nInstall-Module -Name MSAL.PS -Scope CurrentUser\\n```\\n\\nNow that we have the module installed, we need to configure our parameters.\\n\\nOn the Overview page of your App Registration, you\'ll find the details needed. You can use either your domain name or actual tenant ID for the below portion. I\'m using my tenant domain name.\\n\\n![Overview](overview.png)\\n\\n```powershell\\n$token = Get-MsalToken -clientid \\"CLIENTIDHERE\\" -tenantid \\"joeloveless.com\\" -Interactive\\n$header = @{\'Authorization\' = $token.createauthorizationHeader();\'ConsistencyLevel\' = \'eventual\'}\\n```\\n\\nIn this example (Delegated), I am looking to connect interactively. If I wanted this in an automated scenario, I\'d be looking at using Client Secrets, Federation, or Certificates to pass the authentication.\\n\\n### Connect-MgGraph\\n\\nThe next option (and simpler IMO) is to connect using **Connect-MGGraph**\\n\\n[Connect-MgGraph](https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.authentication/connect-mggraph?view=graph-powershell-1.0)\\n\\nWe\'ll need the Microsoft.Graph.Authentication module.\\n\\n```powershell\\nInstall-Module -Name Microsoft.graph.authentication -Scope CurrentUser\\n```\\n\\nFrom here, we just need to run a one liner to then connect:\\n\\n```powershell\\nconnect-MgGraph -ClientId \\"ClientIDHere\\" -TenantId \\"joeloveless.com\\"\\n```\\n\\nNeither are overly difficult to configure, but Connect-MgGraph is just a tad simpler. Personally, I go with Connect-MgGraph, based off this paragraph from the PowerShell Gallery\\n\\n*The MSAL.PS PowerShell module wraps MSAL.NET functionality into PowerShell-friendly cmdlets and is not supported by Microsoft. Microsoft support does not extend beyond the underlying MSAL.NET library. For any inquiries regarding the PowerShell module itself, you may contact the author on GitHub or PowerShell Gallery.*\\n\\nMicrosoft doesn\'t officially support MSAL, where they do officially support the Graph SDK.\\n\\n## Option 1: Scripting natively with Invoke-RestMethod\\n\\n[Full Script Here](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneApplicationAssignments-Invoke-RestMethod.ps1)\\n\\nIn this scenario, we\'ve already connected using the Invoke-RestMethod/Get-MSALToken method from above, connecting to our delegated application and are ready to start writing PowerShell scripts.\\n\\nI\'ve added the full script [here](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneApplicationAssignments%20-%20Invoke-RestMethod), but I want to highlight the key differences in each script. The guts of the script are the same, just a little different for each one.\\n\\n```powershell\\n# Check Graph connection\\n    if ($null -eq ($header)) {\\n        Write-Error \\"Authentication needed. Please call connect to Microsoft Graph.\\"\\n        return\\n    }\\n```\\n\\nHere we are checking for the $header not to be null, as that is the variable we\'re using from above to store the authorization.\\n\\n```powershell\\n#region Get application details\\n    $uri = \\"https://graph.microsoft.com/$graphApiVersion/deviceAppManagement/mobileApps?`$expand=assignments\\"\\n    $resultCheck = @()\\n    do {\\n        $response = Invoke-RestMethod -Uri $Uri -Method Get -Headers $Header\\n        $resultCheck += $response.value\\n        $uri = $response.\'@odata.nextLink\'\\n    } while ($uri)\\n    #endregion\\n```\\nThe key difference here is the $response variable. We need an extra parameter, Headers to achieve the desired results. The above code is what I use for the **pagination** scenario from the Common Terms section. I\'m looking for repeatable code, and this is what I have found to work perfectly, without over complicating things.\\n\\n```powershell\\n\\"#microsoft.graph.groupAssignmentTarget\\" {\\n                        try {\\n                            $uri = \\"https://graph.microsoft.com/$graphApiVersion/groups/$($assignment.target.groupid)\\"\\n                            $group = Invoke-RestMethod -Uri $Uri -Method Get -Headers $Header\\n                        }\\n                        catch {\\n                            Write-Error \\"Unable to get group details: $_\\"\\n```\\nSimilar to above\\n\\n```powershell\\n#region Filter Details\\n                $filterId = $assignment.target.deviceAndAppManagementAssignmentFilterId\\n                $filterType = $assignment.target.deviceAndAppManagementAssignmentFilterType\\n                if ($filterId -and $filterId.Length -eq 36) {\\n                    try {\\n                        $uri = \\"https://graph.microsoft.com/$graphApiVersion/devicemanagement/assignmentFilters/$filterId\\"\\n                        $filterResponse = Invoke-RestMethod -Uri $Uri -Method Get -Headers $Header\\n                        $filterName = $filterResponse.displayName\\n                    }\\n                    catch {\\n                        Write-Warning \\"Failed to get filter details for ID $filterId\\"\\n                    }\\n                }\\n                #endregion\\n```\\nAgain, pointing out the difference with the Headers variable.\\n\\n#Option 2: Using MgGraph\\n\\n[Full Script Here](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneApplicationAssignments%20-%20MgGraph.ps1)\\n\\nIn this scenario, we\'ve connected to Graph using **Connect-MgGraph**, using my preferred way of connecting.\\n\\n```powershell\\n# Check Graph connection\\n    if ($null -eq (Get-MgContext)) {\\n        Write-Error \\"Authentication needed. Please call connect to Microsoft Graph.\\"\\n        return\\n    }\\n```\\nThis is using Get-MgContext to do the connection check, running this will give you more information on how you are connected, what scopes you have, etc.\\n\\n```powershell\\n#region Get application details\\n    $uri = \\"https://graph.microsoft.com/$graphApiVersion/deviceAppManagement/mobileApps?`$expand=assignments\\"\\n    $resultCheck = @()\\n    do {\\n        $response = Invoke-MgGraphRequest -Method GET -Uri $uri\\n        $resultCheck += $response.value\\n        $uri = $response.\'@odata.nextLink\'\\n    } while ($uri)\\n    #endregion\\n```\\n\\nOne less parameter to worry about\\n\\n```powershell\\n\\"#microsoft.graph.groupAssignmentTarget\\" {\\n                        try {\\n                            $uri = \\"https://graph.microsoft.com/$graphApiVersion/groups/$($assignment.target.groupid)\\"\\n                            $group = Invoke-MgGraphRequest -Uri $uri -Method GET\\n                        }\\n                        catch {\\n                            Write-Error \\"Unable to get group details: $_\\"\\n```\\n\\n```powershell\\nif ($filterId -and $filterId.Length -eq 36) {\\n                    try {\\n                        $uri = \\"https://graph.microsoft.com/$graphApiVersion/devicemanagement/assignmentFilters/$filterId\\"\\n                        $filterResponse = Invoke-MgGraphRequest -Uri $uri -Method GET\\n                        $filterName = $filterResponse.displayName\\n                    }\\n                    catch {\\n                        Write-Warning \\"Failed to get filter details for ID $filterId\\"\\n                    }\\n                }\\n```\\n\\n## Option 3: Using Graph PowerShell Cmdlets\\n\\n[Full Script Here](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneApplicationAssignments-GraphSDK.ps1)\\n\\nWe had two options to connect to Graph, but now we have three options to run commands against Graph? What the hell? \\n\\n![Huh?](wedding-crashers.gif)\\n\\nMicrosoft attempted to make this easier for us. In doing so, what they really did was create confusion. Many of the cmdlets are half baked, have really poor documentation, sometimes work, most of the time don\'t work, and are just down right confusing. I\'ve struggled finding the right commands to use, and when I do find the right commands to use, nothing really seems to work just the way I expect it to. With the first two options, the code is very repeatable, where with this option, it takes a minute to find the right commands, then you have to hop on one foot and hope they work correctly.\\n\\n[Get started with the Microsoft Graph PowerShell SDK](https://learn.microsoft.com/en-us/powershell/microsoftgraph/get-started?view=graph-powershell-1.0)\\n\\n### Find-MgGraphCommand\\n\\nWhere with the first two options, I could go to the API documentation and just find the URLs, I have to do a little bit more digging to find the right commands needed.\\n\\n1. Navigate to the Graph API documentation, in this case, we\'re looking for [Corporate Management > App Management](https://learn.microsoft.com/en-us/graph/api/resources/intune-app-conceptual?view=graph-rest-beta), which in turn points us to the URL of\\n\\n```powershell\\n/deviceAppManagement/mobileApps\\n```\\n2. Now that we have the URL, we can run Find-MgGraphCommand\\n\\n```powershell\\nFind-MgGraphCommand -Uri \'/deviceAppManagement/mobileapps\'\\n```\\n\\nThis will then return us the available cmdlets to use.\\n\\n![Find-MgGraphCommand Results](find-mggraph.png)\\n\\n3. Going down even further, we can run the following:\\n\\n```powershell\\nFind-MgGraphCommand -Command Get-MgbetaDeviceAppManagementMobileApp\\n```\\n![Find-MgGraphCommand -Command](find-mggraph2.png)\\n\\n#### Building the script\\n\\nFirst thing I noticed, I have another module to install.\\n\\nSo to build this script, I\'ll need the following:\\n\\n- Microsoft.Graph.Authentication\\n- Microsoft.Graph.Beta.Devices.CorporateManagement\\n\\nThis is just for this example script. If I had a script that was peicing together multiple parts of Intune, I\'d have a whole lot of dependencies and hoping there aren\'t issues at any point. Where with the previous two, I\'m relying on exactly one module to install.\\n\\n```powershell\\n#region Get application details\\n    $resultCheck = @()\\n    do {\\n        $response = Get-MgBetaDeviceAppManagementMobileApp -All -ExpandProperty Assignments \\n        $resultCheck += $response\\n        $uri = $response.\'@odata.nextLink\'\\n    } while ($uri)\\n    #endregion\\n```\\n\\nThis is a little bit less code, but did I really save any time by having to research this and peice it all together?\\n\\nNow I\'m down to the Groups portion of the script.\\n\\n```powershell\\n\\"#microsoft.graph.groupAssignmentTarget\\" {\\n                        try {\\n                            $uri = \\"https://graph.microsoft.com/$graphApiVersion/groups/$($assignment.target.groupid)\\"\\n                            $group = Invoke-MgGraphRequest -Uri $uri -Method GET\\n                        }\\n                        catch {\\n                            Write-Error \\"Unable to get group details: $_\\"\\n                        }\\n```\\n\\nPreviously I had this in Option 2. Now I need to find the commands again.\\n\\n```powershell\\nFind-MgGraphCommand -Uri \'/groups\'\\n```\\n\\n![Find-MgGraph Groups](findmggraph-groups.png)\\n\\n```powershell\\nFind-MgGraphCommand -Command get-mggroup\\n```\\n\\n![Find-MgGraph Groups Command](findmggraph-groups2.png)\\n\\nNow I have another module to install, the Groups module. If you\'re following along, now I need three modules:\\n\\n- Microsoft.Graph.Authentication\\n- Microsoft.Graph.Beta.Devices.CorporateManagement\\n- Microsoft.Graph.Beta.Groups\\n\\n```powershell\\nif ($filterId -and $filterId.Length -eq 36) {\\n                    try {\\n                        $filterresponse = Get-MgBetaDeviceManagementAssignmentFilter -DeviceAndAppManagementAssignmentFilterId $filterId\\n                        $filterName = $filterResponse.displayName\\n                    }\\n                    catch {\\n                        Write-Warning \\"Failed to get filter details for ID $filterId\\"\\n                    }\\n                }\\n```\\n\\nThis one didn\'t take another module to be installed.\\n\\n### Comparing the Data\\n\\nNow that I have the script built, lets compare the results:\\n\\nOption 1 and 2 CSV Results:\\n\\n![CSV Results - Rest Method and Graph](results1.png)\\n\\nCool! Look at all that data it returned. This is my test lab, so I\'m expecting some blank results as I don\'t have a VPP account actually setup.\\n\\n![CSV Results - Cmdlets](results2.png)\\n\\nWhere\'s Platform? This is just an example of the inconsistency that I talked about earlier. For whatever reason, Platform results aren\'t returned in this example. This was a totally random script I built last week for work and one I thought would be a good use case to show. I literally had no idea that the data would be inconsistent until I built this while writing the article. What are the odds?\\n\\n## Conclusion\\n\\n**Hopefully** this was a good explainer on the different options for getting started with Microsoft Graph. Going forward, I hope this explained the differences, and why I prefer using Invoke-MgGraphRequest over the others.\\n\\nIn my next post, I want to look at using some automation and create an Application App Registration vs. Delegated, and see how we can pump this data elsewhere (PowerBI) and take a look at that. Have a great day"},{"id":"tech-tools-I-use","metadata":{"permalink":"/blog/tech-tools-I-use","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-06-28-tech-tools-I-use-at-home-and-work/index.md","source":"@site/blog/2025-06-28-tech-tools-I-use-at-home-and-work/index.md","title":"Tech tools I use at home and at work","description":"An overview of the random tech I use at home and at work.","date":"2025-06-28T00:00:00.000Z","tags":[{"inline":false,"label":"Other","permalink":"/blog/tags/other","description":"Other related posts."}],"readingTime":6.43,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Tech tools I use at home and at work","description":"An overview of the random tech I use at home and at work.","slug":"tech-tools-I-use","date":"2025-06-28 00:00:00+0000","tags":["other"]},"unlisted":false,"prevItem":{"title":"Getting Started with Microsoft Graph","permalink":"/blog/getting-started-with-microsoft-graph"},"nextItem":{"title":"Examining CIS Microsoft Windows 11 Enterprise Benchmark in a Hybrid Environment","permalink":"/blog/cis-benchmarks-enterprise-win11"}},"content":"An overview of the random tech that I use at home and at work.\\n\\n\x3c!-- truncate --\x3e\\n\\nI don\'t have a whole lot to write about this week, summer is in full swing, which means I\'m pretty swamped with the kids and doing different activities. Right now I\'m studying (again) for the AZ-104 test, blogging, and being slammed at work. My motivation hasn\'t fully been there since the RTO announcement, but the tech motivation is always there. Just a lot of anxiousness on what the future holds, which the HR department seems to change minute by minute while the agency has promoted telework as the future for the past five years.\\n\\nBut, I wanted to post something a little bit different. This post is a rundown of the tech I use both at home and at work.\\n\\n## Home Tech\\n\\n### Hardware\\n- Intel Nuc (8th generation?)\\n  - I use this running ProxMox to run my Home Assistant and Plex VMs. Probably a little overkill for the use case. My Plex setup is as basic as you can get, with an 8 TB external HD plugged into it.\\n- Dell Optiplex 7070 SFF\\n  - I bought this used off eBay. I was supposed to get a Mini Tower, but the seller sent me a SFF. My dream of beefing it up with multiple hard drives died there. Instead, PayPal refunded me and I have a free SFF PC. I use this for my home lab stuff, blogging, etc.\\n- Lenovo Thinkpad Yoga 370\\n  - I recently discovered how much I love the tablet mode, never used that before. I\'ve been using this for note taking for AZ-104 using OneNote. Makes me want to buy an actual tablet. Mainly I have this on my desk with Discord open during the day, and maybe random podcasts playing.\\n- Google Pixel 6\\n  - My phone, I recently put GrapheneOS on this instead of stock Android. I don\'t have any complaints about it, I don\'t see random news articles anymore, and I\'ve basically de-googled at this point which is nice. The ability to still download apps from the Play Store is there, with everything being sandboxed.\\n- Eero Mesh\\n  - I use the Eero Mesh for my wifi in my office, basement, and main floors. Would I buy it again? Probably not, I\'m not a fan of how locked down some of it is. Fiber is supposed to come to my house in the fall, so I might look at upgrading then to something else. Maybe I\'ll go the Ubiquiti route.\\n- Starlink\\n  - No options really, either Starlink or some crappy DSL provider. I\'m looking forward to the fiber option and can\'t wait to cancel. It does well for the most part, heavy rain interferes with it (not really snow though). But it\'s $120 bucks a month, and Elmo seems like a douche.\\n- PS5\\n  - I have a PS5 for gaming, mainly for my kids, but I\'m a big kid at heart. Since getting it last year, I\'ve played the God of War games, and now am hooked on Call of Duty. I\'ll probably get a new game here soon. Gamertag: Pacers31Colts18.\\n- Zwift Hub\\n  - I bought this for indoor cycling in the winter. Turns out indoor cycling is super f\'n boring. I don\'t use it all that much.\\n- Google Chromecast TV\\n  - I use Google TVs for streaming purposes. I wish the storage was a little bit bigger, but I also don\'t run a lot of apps so it isn\'t too bad. No complaints.\\n- Google Hubs\\n  - I have two of these, honestly, I barely use them anymore. I find them to get dumber and dumber as the days go on and have basically given up trying.\\n\\n### Software\\n\\n- [Plex](https://plex.tv)\\n  - I use Plex to stream my home media. My kids (14 and 12) have a specific niche of Star Wars, Marvel, Avatar, Monsterverse, Jurassic Park, any anything else that involves giant monsters or cool superheroes. That is mainly what I watch too.\\n- [Sonarr](https://sonarr.tv/)\\n  - Sonarr for grabbing TV shows I already own.\\n- [Radarr](https://radarr.video/)\\n  - Radarr for grabbing movies I already own.\\n- [Bazarr](https://www.bazarr.media/)\\n  - Bazarr for grabbing subtitles for said movies and tv shows I already own.\\n- [NZBGet](https://nzbget.net/)\\n  - Sonarr/Radarr tell NZBGet what to grab.\\n- [Prowlarr](https://prowlarr.com/)\\n  - Prowlarr sync\'s everything together in one spot so I don\'t have to.\\n- [Home Assistant](https://www.home-assistant.io/)\\n  - Home Assistant is the home automation platform. My setup is super basic. I have some smart bulbs, smart switches, the hubs, and a propane tank sensor. I\'ve always dreamed of having more automation, but I don\'t use it all that much. I also use it for watching HD space on my external HD for Plex.\\n- Hyper-V\\n  - I use Hyper-V to run my home lab, off the Dell Optiplex 7070. This is connected to my Azure tenant that I use for testing stuff out.\\n- OneNote\\n  - OneNote for random note taking\\n- [BitWarden](https://bitwarden.com/)\\n  - BitWarden is my password vault. I recommend it, $10 bucks a year. Does have random autofill issues on Android it seems.\\n- [PipePipe](https://github.com/InfinityLoop1308/PipePipe/releases)\\n  - Open source alternative to Youtube. Fork of NewPipe. I use this over YouTube in my attempt to DeGoogle as much as possible.\\n- VSCode\\n  - I use VSCode to either write scripts, or write blog posts in Markdown format.\\n- GitHub\\n  - My site is tied to GitHub pages with branching and source control.\\n- Squarespace\\n  - I purchased my domain name on Google Domains initially, then that got sold off to Squarespace. Seems simple enough.\\n- Hugo\\n  - The platform I use for blogging. I mainly followed the guide from [Mike Robbins](https://mikefrobbins.com/2023/10/26/building-and-deploying-a-blog-with-hugo-and-github-pages/) to get started.\\n\\n## Work Tech\\n\\n### Hardware\\n\\n- Dell Latitude 5440\\n  - Run of the mill Dell Latitude laptop running a 13th gen i5 with 32 GB ram.\\n- Some Herman Miller chair\\n  - I have back problems, decent enough chair, I\'m also not going to go out and buy one, so work let me use this at home.\\n- Custom made standing desk\\n  - I had some leftover butcher block, and ordered a standing desk kit off Amazon and put the butcher block onto it. My goal was to automate it into Home Assistant, but I never got there. One day.\\n- 3 monitors\\n  - 1 32 inch monitor\\n  - 2 27 inch monitors\\n    - 1 vertical\\n    - 1 horizontal\\n- Blue Yeti Microphone\\n  - Given to me by Fabian Rodriguez at TCSMUG. \\n- MMS Playing Cards\\n  - When in meetings I need something to keep me occupied while talking. So I shuffle a deck of playing cards I got at MMS 2024. Other random toys I have are a koosh ball and a fidget spinner.\\n\\n### Software\\n- Microsoft Office\\n  - Typical Microsoft shop, running Office and Teams.\\n- Azure Virtual Desktop\\n  - AVD multi-session host for nearly all my administrative work.\\n- ADUC/GPMC (Active Directory and Group Policy)\\n  - ADUC and GPMC inside the AVD host to be able to manage all the domains we manage.\\n- Configuration Manager\\n  - Where and how I really got going in tech, still love it to this day and will die on the ConfigMgr hill.\\n- VSCode\\n  - I use VSCode extensively for writing PowerShell scripts.\\n- GitHub Enterprise\\n  - Where our team stores all our repos.\\n- VSCode Extensions\\n  - I run a pretty vanilla setup, we migrated from Horizon Virtual Desktops to AVD, and I\'m trying not to run as many extensions this time around.\\n    - PowerShell\\n      - All my coding is done in PowerShell.\\n    - Prettier - Code Formatter\\n      - I like how this will format the file for me.\\n    - GitHub Actions\\n      - For managing everything we have tied to GitHub Actions.\\n    - GitHub Pull Requests\\n      - So much easier than knowing the proper Git syntax and workflow. 10/10.\\n    - Azure Automation\\n      - Used for managing the runbooks in Azure, with proper source control to GitHub tied to it."},{"id":"cis-benchmarks-enterprise-win11","metadata":{"permalink":"/blog/cis-benchmarks-enterprise-win11","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-06-12-cis-benchmarks-enterprise-win11/index.md","source":"@site/blog/2025-06-12-cis-benchmarks-enterprise-win11/index.md","title":"Examining CIS Microsoft Windows 11 Enterprise Benchmark in a Hybrid Environment","description":"Review of CIS Microsoft Windows 11 Enterprise Benchmark in a hybrid environment","date":"2025-06-12T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"CIS","permalink":"/blog/tags/cis","description":"Center for Internet Security related posts."},{"inline":false,"label":"Windows 11","permalink":"/blog/tags/windows-11","description":"Windows 11 related posts."},{"inline":false,"label":"Hybrid","permalink":"/blog/tags/hybrid","description":"Hybrid related posts."}],"readingTime":19.93,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Examining CIS Microsoft Windows 11 Enterprise Benchmark in a Hybrid Environment","description":"Review of CIS Microsoft Windows 11 Enterprise Benchmark in a hybrid environment","slug":"cis-benchmarks-enterprise-win11","date":"2025-06-12T00:00:00.000Z","tags":["intune","cis","windows-11","hybrid"]},"unlisted":false,"prevItem":{"title":"Tech tools I use at home and at work","permalink":"/blog/tech-tools-I-use"},"nextItem":{"title":"Converting Registry Based SCCM Configuration Items to Intune Remediation Scripts","permalink":"/blog/configurationitems-to-remediationscripts"}},"content":"A review of CIS Microsoft Windows 11 Enterprise Benchmarks in a hybrid environment.\\n\\n\x3c!-- truncate --\x3e\\n\\nIt\'s been a few weeks now since I\'ve made a post. The nice weather has kept me busy with yard work, taking my son camping, working on my garden, and trying to keep the weeds at bay. \\n\\nLast weekend I took my son camping at Beaver Creek Valley State Park in Minnesota and had a blast with him. Beaver Creek is a fairly small campground, with an odd one road layout. For me, that\'s awesome. I don\'t want to be around too many people, and the park itself was amazing. The Hiking Club Trail was 6.2 miles long, and split up into two legs. The first leg, was really hilly, and I ended up slipping twice and landing on my butt on the trek down. The second leg, was fairly flat, but in this awesome valley with really great scenery. We did the first leg on Friday afternoon after arriving to our site, and then did the second leg in the morning. From there we did some fishing in Brownsville along the Mississippi River. I\'m now 40 years old, and am yet to catch a fish that doesn\'t involve deep sea fishing, or trout fishing. Granted, I\'m not a fisherman, and I don\'t do it all that often, but you would think I\'d be able to catch one once? Nope, not me. Jay has though, which really doesn\'t make me feel any better, but good for him. Saturday afternoon we did some more hiking at Great River Bluffs State Park, which was around 2 miles on the hike. We\'re now over 40 miles on the hiking club trails, well on our way to getting our 50 mile badge.\\n\\n![Beaver Creek](beavercreek.jpg)\\n\\n![Great River Bluffs](greatriverbluffs.jpg)\\n\\nMy garden is also coming along. Last year, I didn\'t plant anything. My first year here, it was trying to get it all ready, but weeds took over the area and won the battle. Weeds took over the area even more last year. My plan this year was to go back to raised beds. A trip to Menards put that all in shock when I found the price of lumber for a 1x8x8 was around 15 dollars for the crappiest piece of pine you could buy. I thought about giving up again, but then realized the barn we have had a bunch of old lumber still in it. I\'ve now built five raised beds using that lumber. To date, I\'ve planted:\\n\\n- Bed 1:\\n    - Green Beans\\n- Bed 2:\\n    - Tomatoes\\n    - Marigolds\\n- Bed 3\\n    - Peppers\\n    - Lettuce\\n- Bed 4\\n    - Corn\\n- Bed 5\\n    - Need more compost, might plant pumpkins.\\n\\nFinally, my Pacers are in the NBA Finals. It\'s been 25 years since the last trip, which put me in I think my freshman year of high school. My brother was going into his senior year. We have good memories of sitting in the parking lot across the street from the Fieldhouse in Indianapolis and watching the Finals then. His kids are now going into their senior year of high school, which makes us feel really f\'n old.\\n\\nSince I\'ve been out of the groove a little bit, I\'ve had a little bit of a writers block about what to write about. My last post was about using the CIS Benchmarks with AVD Multi-Session hosts. I wanted to expand on the topic some more, and touch on configuring the CIS Microsoft Windows 11 Enterprise Benchmark using Microsoft Intune, what settings aren\'t supported, what settings are supported, how to configure, and any gotcha\'s that we have experienced.\\n\\n## What is CIS?\\n\\nSimply put, CIS Benchmarks are a baseline of settings that will give you a secure environment. They are a **guidance, and do not need to be configured 100% (despite what your security team says)**. Striving for 100% should be the goal, but honestly, isn\'t achievable in any organization I\'ve been in. For more information on CIS, you can go to https://cissecurity.org\\n\\n## What\'s the difference between the Enterprise and the Intune benchmark?\\n\\nFrom CIS:\\n\\n- Intune Benchmark:\\n    - The Microsoft Intune Windows Benchmarks are written for MDM-joined systems using Microsoft Intune device configuration profiles only. This benchmark is not intended for use on standalone or workgroup systems, systems joined to and receive policies from Active Directory, or systems created, maintained, or used in other Cloud offerings. This benchmark covers supported endpoint states for Entra Hybrid Joined and Entra Joined systems that receive policies from Microsoft Intune using Configuration Profiles only.\\n- Enterprise Benchmark:\\n    - The Microsoft Windows Benchmarks are written for Active Directory domain-joined systems using Active Directory\u2019s Group Policy Manager only. This benchmark is not intended for use on standalone or workgroup systems, systems joined to a cloud offering, such as Entra ID, or systems created, maintained, or used in the Cloud. This benchmark covers supported endpoint states for Active Directory and Entra Hybrid joined systems that receive policies from Active Directory Group Policy Manager only.\\n\\n### But what if our org is hybrid and has regulations to adhere to?\\n\\nToo bad? Microsoft is pushing us to be modern managed, using Intune, and starting that journey by hybrid-joining your existing devices. Cool. Great. But what if I want to move away from Group Policy and use Intune configuration? You can do that. As you see, both benchmarks cover hybrid-join scenarios. The difference being is the amount of settings that are in each benchmark.\\n\\n- If you have regulations to adhere to, you\'re probably going to be stuck with the Enterprise benchmark.\\n    - The decision should be made, use GPO even if you\'re hybrid joined?\\n        - That seems like a bad idea to me, as you want to avoid the conflicting configurations. Pick one or the other. You\'ve already enrolled these in Intune, I would keep using Intune.\\n- If you don\'t have regulations to adhere to? Lucky you!\\n    - Use the Intune benchmark.\\n        - CIS does the hard work for you, the .json files are already there.\\n        - WARNINGS:\\n            - Don\'t just import the settings and apply to All Devices. \\n            - REVIEW THE SETTINGS, GET AN UNDERSTANDING OF THE POLICIES, AND GRADUALLY ROLL OUT THE POLICIES.\\n            - Push back on your security team if they say you need to implement all of these 100%. They\'re checking boxes, you have to deal with the support.\\n\\n## Downloading the Benchmark\\n\\nTo download the kit to implement the benchmark, you need to have an account with CIS. That can be achieved by going to https://workbench.cisecurity.org/. I don\'t know the full ins and outs of the cost, as my organizations have always had the means one way or another.\\n\\nTo start, we\'re actually going to download the CIS Microsoft Intune for Windows 11 Benchmark v4.0.0. Why this over the enterprise flavor? We\'re going to use this as the starting point for our configuration, to see what works, and what doesn\'t work right out of the gate. The Enterprise baseline is group policy based, so that only has group policy templates. The Intune baseline has the proper .json files for importing into Intune.\\n\\n- Once registered and signed-in, click on Benchmarks\\n- Search for **CIS Microsoft Intune for Windows 11 Benchmark**\\n- Click **Files** in the top right corner\\n- Click **CIS Microsoft Intune for Windows 11 Benchmark v4.0.0 - Build Kit**\\n- We\'re then going to download the .zip file\\n- Unzip the file\\n\\n## Importing the Benchmark\\n\\nNow that we have the benchmark downloaded and unzipped, we can then import into Intune.\\n\\n![Importing in Intune](intune_import.png)\\n\\nThe following is the .json files that are available to import, which makes this so much easier.\\n\\n![CIS Json Files](cis_json.png)\\n\\n## Importing and Configuring the Baseline\\n\\nCool, now that we have them imported, we just select All Devices and away we go right? No. Don\'t do this. I can\'t stress that enough.\\n\\n- Build a test VM or test device if you have one handy.\\n\\nI won\'t walk you through that, as that\'s different for each org. Too many options to choose from. As Microsoft would say, do what fits your org.\\n\\nI learned upon first import, the Windows LAPS configuration is missing. Looking at the folder structure under the L1 folder, I see these Settings Catalog profiles, and then a script to disable Services.\\n\\n![Imported Profiles](imported_profiles.png)\\n![Platform Scripts](intune_platformscripts.png)\\n\\nAfter reviewing the readme file, I noticed that the LAPS profile has to be configured manually. Importing profiles with the endpoint security blade is a tricky item in Intune, and really a pain.\\n\\nFrom the ReadMe file:\\n\\nFor 100% benchmark compliance, perform the following steps: \\n1. Import desired profile from \\".\\\\Settings Catalog\\" folder into Intune ex: \u201cCIS (L1) \\nDefender - Windows 11 Intune 3.0.0.json\u201d. \\n2. Run scripts in \\".\\\\System Service Scripts\\" folders either locally, via Intune script \\nmanager or your preferred method. \\n3. Configure LAPS settings in the \\"Endpoint security > Account protection\\" section \\nin Intune admin center as outlined in the benchmark.\\n\\nWhat I haven\'t done at this point is assign the baseline to my group and test VM. What I want to do first is scan the system with a fresh build, and see what the configuration looks like out of the gate. Now, this will be different in every organization, as you might have some GPOs applying, settings applying during the build process, etc that will change the score slightly. Ideally, you\'ll have a pretty crappy score. If not, that means you have configurations in place already. As much as possible, you\'ll want to transition those policies out of wherever they are, and into Intune so you can manage the policies from a central location.\\n\\n## CIS-CAT Assessor\\n\\nTo review what is being applied, CIS also has a tool called CIS-CAT Assessor. This can be downloaded at this site, https://workbench.cisecurity.org/download/cis-cat/assessor. You will also need a license file, which will go in the license folder of the extracted zip file. Download all of this on your freshly built VM, as we\'re only going to run this locally and not over a network.\\n\\n## Fresh Build\\n\\nWhen I run the CIS-CAT Assessor, I am going to choose both the CIS Microsoft Intune for Windows 11 Benchmark and the CIS Microsoft Windows 11 Enterprise Benchmark for assessment. Typically, I choose output to an HTML file also. This is just easier for my eyes to read, to each their own.\\n\\n![CIS-CAT Assessor](cis_assessor.png)\\n\\nOut of the gate, with no policies applied, I achieved the following results:\\n\\n- CIS Microsoft Intune for Windows 11 Benchmark\\n    - 337 settings\\n    - Pass: 57 settings\\n    - Fail: 273 settings\\n    - Score: 17%\\n- CIS Microsoft Windows 11 Enterprise Benchmark\\n    - 406 settings\\n    - Pass: 86 settings\\n    - Fail: 318 settings\\n    - Score: 21%\\n\\nWhat this tells me is that some of the settings defined in the benchmarks are default settings that Microsoft sets. I\'ve added CSV files of the scan results, so you\'ll be able to see what settings are already configured with a freshly imaged device. A debate could be had on whether you need to configure these or not, as it would take someone with administrative rights to change the policies anyways. Files can be found here: https://github.com/Pacers31Colts18/Intune/tree/main/CIS%20v4.0\\n\\n## Applying Imported CIS Microsoft Intune for Windows 11 Benchmark\\n\\nNow that we have the initial baseline established, we are ready to assign the policies we imported earlier into Intune. Typically when I am piloting, I will create a group, exclude from the previous policies, and apply to the new policies. Because this is in my lab, I don\'t really have any policies. If you do have policies, you\'ll want to have this configured before you run the scores on the fresh build, or you will have mixed results of policies already applying.\\n\\nAfter some time, the policies should be applying, you can tell if the policy has applied, simply by rebooting the device. You should see this on the logon screen.\\n\\n![Initial Policy](cis_initialpolicy.png)\\n\\nRemember how I said don\'t just apply this without any thought? This is what happens.\\n\\nAttempting to run the CIS-CAT assessor again, I now get this error message.\\n\\n![CIS-CAT](cis_assessor2.png)\\n\\nAnd another error! The policies are doing their job\\n\\n![CIS-CAT](cis_assessor3.png)\\n\\nInstead of using a standard user account, I am going to login as my Administrator account now to run the CIS-CAT Assessor.\\n\\nI\'m now ready to run the CIS-CAT Assessor again, and have achieved the following results:\\n\\n- CIS Microsoft Intune for Windows 11 Benchmark\\n    - 337 settings\\n    - Pass: 320 settings\\n    - Fail: 12 settings\\n    - Error: 5 settings\\n    - Score: 95%\\n- CIS Microsoft Windows 11 Enterprise Benchmark\\n    - 406 settings\\n    - Pass: 257 settings\\n    - Fail: 147 settings\\n    - Error: 0 settings\\n    - Score: 64%\\n\\n### What didn\'t apply correctly?\\n\\n#### CIS Microsoft Intune for Windows 11 Benchmark\\n\\n- Errors:\\n    - (L1) Ensure \'Turn off toast notifications on the lock screen (User)\' is set to \'Enabled\'\\n    - (L1) Ensure \'Do not preserve zone information in file attachments (User)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Notify antivirus programs when opening attachments (User)\' is set to \'Enabled\'\\n    - (L1) Ensure \'Prevent users from sharing files within their profile. (User)\' is set to \'Enabled\'\\n    - (L1) Ensure \'MSI Always install with elevated privileges (User)\' is set to \'Disabled\'\\n- Fails:\\n    - (L1) Ensure \'Allow Spotlight Collection (User)\' is set to \'0\'\\n    - (L1) Ensure \'Remote Procedure Call (RPC) Locator (RpcLocator)\' is set to \'Disabled\'\\n    - (L1) Ensure \'SSDP Discovery (SSDPSRV)\' is set to \'Disabled\'\\n    - (L1) Ensure \'UPnP Device Host (upnphost)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Windows Media Player Network Sharing Service (WMPNetworkSvc)\' is set to \'Disabled\' or \'Not Installed\'\\n    - (L1) Ensure \'Windows Mobile Hotspot Service (icssvc)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Xbox Accessory Management Service (XboxGipSvc)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Xbox Live Auth Manager (XblAuthManager)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Xbox Live Game Save (XblGameSave)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Xbox Live Networking Service (XboxNetApiSvc)\' is set to \'Disabled\'\\n    - (L1) Ensure \'Generate Security Audits\' is set to \'LOCAL SERVICE, NETWORK SERVICE\'\\n    - (L1) Ensure \'Impersonate Client\' is set to \'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE\'\\n\\nI see themes here:\\n\\n1. User settings not applying properly. I\'ve ran into this in the past. The CIS-CAT Assessor scans all user profiles, even if they are not sync\'d to Entra. For example, if I had logged in with my local administrator account (which I had), CIS-CAT will then scan that path in the registry and report back a failure. For that, I\'m not going to worry about these settings.\\n2. System Services. CIS has this configured as a Platform Script, rather than a remediation script with Write-Host being used. Logging is not being written locally on the device. Reading the comments on the script, I can see that it most likely will need to be modified:\\n\\n    ```powershell\\n    The purpose of this script is to configure a system using the recommendations \\n    provided in the Benchmark, section(s), and profile level listed above to a \\n    hardened state consistent with a CIS Benchmark.\\n    \\n    The script can be tailored to the organization\'s needs such as by creating \\n    exceptions or adding additional event logging.\\n\\n    This script can be deployed through various means, including Intune script \\n    manager, running it locally, or through any automation tool.\\n    ```\\n3. User Rights Assignment. This doesn\'t seem to be getting set correctly. Opening GPEdit and looking at the User Rights Assignments, I see this:\\n\\n![Generate Security Audits](cis_generate.png)\\n\\n![Impersonate Client](cis_impersonate.png)\\n\\nLooking in the registry at PolicyManager (HKLM:\\\\Software\\\\Microsoft\\\\PolicyManager\\\\providers\\\\guid\\\\default\\\\Device\\\\UserRights), I see that Intune says it\'s setting the policy correctly, but it\'s not actually setting. Fun times:\\n\\n![Registry - Policy Manger](cis_policymanager.png)\\n\\nFrom here, I would be looking at re-writing the Services script, most likely to separate them out and run as Remediations instead with proper logging. This will allow me to be more granular, as we do have a lot of exceptions for developers and such in our environment. The user policies is an area we have just kind of accepted failure on, and just look for the users we are actually targeting for success/failure, not all the accounts as our administrative accounts are not being sync\'d into Entra. The User Rights Assignment, that\'s a tricky one and most likely something Microsoft needs to look into.\\n\\n#### CIS Microsoft Windows 11 Enterprise Benchmark\\n\\nFor the Enterprise benchmark, this is where it becomes more fun. Like I said earlier, the Enterprise benchmark is based off Group Policy, where the Intune benchmark is based off CSP. So we\'ll be running into some mapping issues, as Microsoft in all their wisdom, is not consistent in how settings are being applied. Some Intune settings map back to GP registry settings, some do not. No errors this time, so that\'s a win! I\'ve gone through the list, pulled out all the Fails, and then have done a comparison between the Intune benchmark and the Enterprise benchmark. From there, I\'ve documented what is supported in Intune, vs what is not supported. I\'ve also found all the corresponding registry paths. It\'s a little bit confusing, but the way I describe it to people is like this (hopefully someone can correct me, or point me in a better direction):\\n\\n- Look at the [Policy CSP documentation](https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-configuration-service-provider)\\n  - Anything that begins with ADMX_ is considered ADMX backed\\n    - For the most part ADMX backed settings then write to the GPO based registry path\\n  - Anything that doesn\'t begin with ADMX_ is not ADMX backed\\n    - Some might write to the GPO registry location.\\n    - Some might not.\\n    - Some in even the same CSP area will have different results.\\n\\n\\nAll the data from the failures can be found on my [Github](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/CIS_Enterprise_Failures.xlsx). I initially tried to put everything in here, but gave myself more of a headache doing it that way. I\'ve gone through about five iterations of this before just landing on an Excel spreadsheet.\\n\\n## Supplementing/Remediating Failures\\n\\nConfused yet? So am I. Okay, from here, the focus will be on the Enterprise benchmark from here on out.\\n\\nLooking at the spreadsheet (Main tab), I see a few different themes:\\n\\n- Intune supported, not in Intune benchmark\\n  - 22 settings\\n- Not Intune supported, not in Intune benchmark\\n  - 40 settings\\n- Intune supported, settings that write to different registry paths\\n  - 100 settings\\n\\nBreaking it down by CIS Category:\\n\\n- **Section 1: Account Policies**\\n  - 5 failures\\n    - 1 Intune supported, not in Intune benchmark \\n    - 4 Not Intune supported, not in Intune benchmark\\n- **Section 2: Local Policies**\\n  - 8 failures\\n    - 2 Intune supported, not in Intune benchmark \\n    - 6 Not Intune supported, not in Intune benchmark\\n- **Section 5: System Services**\\n  - 9 failures\\n    - 4 Intune supported, failing from the Platform Script (Xbox)\\n      - Created a supplemental Services policy (see below)\\n    - 5 not Intune supported, still failing from the Platform Script\\n  - **Section 9: Windows Defender Firewall with Advanced Security**\\n    - 23 failures\\n      - 23 Intune supported, settings that write to different registry paths\\n        - CSP writes to HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\SharedAccess\\\\Parameters\\\\FirewallPolicy\\\\MDM\\\\*ProfileName* rather than HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\SharedAccess\\\\Parameters\\\\FirewallPolicy\\\\*ProfilesName*\\n  - **Section 18: Administrative Templates (Computer)**\\n    - 98 failures\\n      - 33 Not Intune supported, not in Intune benchmark\\n      - 17 Intune supported, not in Intune benchmark\\n      - 46 Intune supported, settings that write to different registry paths\\n  - **Section 19: Administrative Templates (User)**\\n    - 4 failures\\n      - 3 Intune supported, not in Intune benchmark\\n      - 1 Intune supported, settings that write to different registry paths\\n \\n\\n### Intune Supported, not in Intune benchmark\\n\\nI\'ve now created four new profiles:\\n\\n- [CIS (L1) - Win11 Enterprise - Administrative Templates (Computer)](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/CIS%20(L1)%20-%20Win11%20Enterprise%20-%20Administrative%20Templates%20(Computer).json)\\n- [CIS (L1) - Win11 Enterprise - Administrative Templates (User)](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/CIS%20(L1)%20-%20Win11%20Enterprise%20-%20Administrative%20Templates%20(User).json)\\n- [CIS (L1) - Win11 Enterprise - Local Policies](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/CIS%20(L1)%20-%20Win11%20Enterprise%20-%20Local%20Policies.json)\\n  - Note: Baseline calls for \\"Audit All or Higher\\", Audit All is not a setting in Intune despite the CSP documentation saying otherwise. Great job!\\n  - I didn\'t set this in the below results as it was either Allow All, or Deny.\\n  - See docs: https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-LocalPoliciesSecurityOptions?WT.mc_id=Portal-fx#networksecurity_restrictntlm_outgoingntlmtraffictoremoteservers\\n- [CIS (L1) - Win11 Enterprise - System Services](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/CIS%20(L1)%20-%20Win11%20Enterprise%20-%20System%20Services.json)\\n\\nThese should cover the settings that are Intune supported, but not in the Intune benchmark.\\n\\n### Not Intune Supported, not in Intune benchmark\\n\\nFor settings that are not configurable in Intune, there are multiple different ways the settings can still be configured\\n\\n- **Custom OMA-URI**\\n  - What I consider \\"Supported\\" is in the Settings Catalog, I didn\'t look at what is configurable through Custom OMA-URI.\\n- **Remediation Scripts**\\n  - You could do a detection/remediation script through Intune\\n  - [Microsoft Learn](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/remediations)\\n- **SCCM Configuration Items/Baselines**\\n  - If you have SCCM or another tool, you could use Configuration Items to configure this.\\n  - [Microsoft Learn](https://learn.microsoft.com/en-us/intune/configmgr/compliance/deploy-use/create-configuration-items)\\n- **Group Policy**\\n  - If you\'re hybrid joined, which is what this post is covering, you could also revert back to using Group Policy.\\n\\nMy preference (just mine), I prefer to use Remediation Scripts or Configuration Items. We started with Configuration Items, and are now starting to push those towards Remediation Scripts to have everything in one tool.\\n\\n### Settings that write to different registry paths\\n\\nThis is where you need to explain to your security team that Microsoft in all it\'s wisdom is writing values to different registry locations. There are options, if you\'re a member of the CIS Workbench, you can fork the benchmark and create you\'re own. Depending on your org structure though, I would say that should be something dependent on the security team to accomplish and not anyone on the endpoint team.\\n\\n## Re-running the scans\\n\\nAfter setting up the above policies, I re-ran the scans, and achieve the following for the Enterprise benchmark:\\n\\n[Results file](https://github.com/Pacers31Colts18/Intune/blob/main/CIS%20v4.0/Post-SettingsCatalog_CIS_Microsoft_Windows_11_Enterprise_Benchmark.csv)\\n\\n- CIS Microsoft Windows 11 Enterprise Benchmark\\n    - 406 settings\\n    - Pass: 273 settings (up from 257)\\n    - Fail: 131 settings\\n    - Error: 0 settings\\n    - Score: 68%\\n\\nThe rest of the results are mainly going to be from a registry path mis-match. One area I do want to call out is the Account Policies section, setting this through Intune can have undesirable affects. For that reason, we\'ve typically left this out of Intune all together.\\n\\n\\n## Conclusion\\n\\nAs you can see, there is still work to be done, but most of the work from here on out is going to be talking with the security team. \\n\\n- The banner will need to be updated, have someone (legal?) come up with a banner that suits your org.\\n- If using Windows Hello, there are a handful of settings that can be tweaked to make a better experience (new blog post coming later)\\n- If using Configuration Manager, don\'t set the Windows Update settings, let the client take care of that.\\n    - Research Dual Scan issues.\\n- Find what does and doesn\'t work in your org, pilot everything for a while before rolling out.\\n  - Don\'t just take my word for it, I\'m just a random guy on the internet.\\n- Explain the settings to your security team\\n  - Point them to this excel spreadsheet showing the registry differences.\\n\\n If you\'re not subject to regulatory requirements that rely on the Enterprise Benchmark, use the Intune benchmark. If you do rely on the Enterprise benchmark, you have decisions to make. We were already well on the way to Intune, and as more and more settings become configurable, we\'re only going to see our numbers (hopefully) increase. Still, there is a strong chance Microsoft will write to different registry locations. I would continue to push on the regulatory bodies (and possibly CIS) to include additional checks in the audit files.\\n\\nPlease reach out if you have any questions about this article, always happy to help out when I can."},{"id":"configurationitems-to-remediationscripts","metadata":{"permalink":"/blog/configurationitems-to-remediationscripts","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-05-24-converting-configurationitems-to-remediationscripts/index.md","source":"@site/blog/2025-05-24-converting-configurationitems-to-remediationscripts/index.md","title":"Converting Registry Based SCCM Configuration Items to Intune Remediation Scripts","description":"Script walkthrough on converting SCCM Configuration Items to Intune Remediation Scripts.","date":"2025-05-24T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"SCCM","permalink":"/blog/tags/sccm","description":"System Center Configuration Manager related posts."},{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."}],"readingTime":9.91,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Converting Registry Based SCCM Configuration Items to Intune Remediation Scripts","description":"Script walkthrough on converting SCCM Configuration Items to Intune Remediation Scripts.","slug":"configurationitems-to-remediationscripts","date":"2025-05-24T00:00:00.000Z","tags":["intune","sccm","powershell"]},"unlisted":false,"prevItem":{"title":"Examining CIS Microsoft Windows 11 Enterprise Benchmark in a Hybrid Environment","permalink":"/blog/cis-benchmarks-enterprise-win11"},"nextItem":{"title":"CIS L1 Benchmarks in Intune with AVD Multi-Session Hosts","permalink":"/blog/cis-benchmarks-avd-multisession"}},"content":"A PowerShell script walkthrough on converting SCCM Configuration Items to Intune Remediation Scripts.\\n\\n\x3c!-- truncate --\x3e\\n\\nIt\'s Memorial Day Weekend here in the States, which means it\'s Indy 500 Weekend. It also means my Indiana Pacers are up 2-0 on the New York Knicks. If you know me, I\'m a huge Pacers fan. With that comes a hatred for the Knicks, so right now I am giddy. Game 3 is tomorrow in Indianapolis, and the same day as the Indy 500. Back in Indy, we call that Racers and Pacers Weekend. I don\'t miss Indiana much for anything at all, but events like this, I do miss. Indianapolis knows how to do sporting weekends right. Without being back in Indy, my family and I will most likely be cooking some hot dogs, eating some s\'mores, and burning all the downed sticks and brush from the recent storms. My daughter is also looking into getting into mountain biking, so I have been going down the internet rabbit hole looking for a decently priced mountain bike.\\n\\nI\'ve had this idea on my mind, and asked Steve Jesok the question at MMS during his session on Intune Remediation Scripts and SCCM Configuration Items. \\"Does anyone have a way to convert registry based configuration items to Intune Remedation Scripts? Steve was unaware of anything out there. I\'m also not entirely sure how useful this would be for admins out there. If already using PowerShell based detection and remediation in SCCM, this isn\'t really applicable. If you\'re using the \\"GUI method\\" of looking for a registry key, and then remediating off of that, then this post might be for you.\\n\\n## What is a Remediation Script?\\n\\n[Intune Remediations - Microsoft Learn](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/remediations). Simply put, a Remediation Script is a \\"detection\\" and a \\"remediation\\". If the detection script detects the state is not correct (Non-Compliant), it will then go onto the Remediation portion.\\n\\nWith Intune, we do have a limit of 200 remediation scripts, which compared to SCCM, is quite small. I like to think of a Remediation Script as being equal to a Configuration Baseline. I don\'t think we should be doing single actions necessarily, but combining like actions together. In this post, I\'ll be combining Services together, where I\'ll want to set multiple Windows Services to a Disabled status.\\n\\n## What do you mean by \\"GUI Method\\"?\\n\\n![](sccm_gui_method.png \\"GUI Method\\")\\n\\nAnything that\'s not script based using Powershell/VBScript/etc, but configurable through the GUI.\\n\\n## Pre-Requisites\\n\\nI\'ve added all the files needed for this on my GitHub page.\\n\\n- [Intune Detection Template](https://github.com/Pacers31Colts18/Intune/blob/main/Intune-Registry-Detect.ps1)\\n- [Intune Remediation Template](https://github.com/Pacers31Colts18/Intune/blob/main/Intune-Registry-Detect.ps1)\\n- [Convert Configuration Items to Remediation Script](https://github.com/Pacers31Colts18/Intune/blob/main/Convert-CMConfigurationItemtoIntuneRemediationScript.ps1)\\n\\n# Walkthrough\\n\\nBefore getting too far into this, my method only works with the templates above for an Intune Detection and Remediation Script. What we\'re doing is taking these template files, and then doing some manipulation with PowerShell. Working on a team of 6 other engineers, we\'re trying our best to have repeatable practices, and make the code readable for everyone else. By having a template, this makes things much easier for us to know what is going on. The long-term goal is to also combine this with GitHub Actions and have a repository of code that requires code review and a more DevOps mindset. We\'re not 100% there yet, but we\'re working our way to that goal.\\n\\n## Intune Detection and Remediation Template\\n\\nI feel like these are pretty self explanatory. As I said earlier, we\'re thinking of this as more of a Configuration Baseline mindset, where you combine multiple Configuration Items into a Baseline. We\'re trying our best to not have a single script doing one single purpose (although there are use cases for that). With a large environment, we\'re trying to avoid the unknown of the future with a 200 script limit.\\n\\nBy having a PowerShell array for the registry key detection, we\'re able to achieve this with this method.\\n\\n## Converting Configuration items to Remediation Scripts\\n\\nI like to try to walk through what I am doing, mainly to kinda serve as a way to document my thoughts and what the heck I was doing. But hopefully people are finding this useful also. I don\'t consider myself to be the best at this by any means, so hopefully my stumbling explanations will serve somebody out there!\\n\\nA couple thoughts before I go into the code:\\n\\n- I\'ve started using CoPilot to provide the comment-based help in my code. Freaking amazing. Such a time saver, highly recommended.\\n- I hate the name of this function. Any suggestions?\\n\\n### Parameter Block\\n\\nAt the beginning of the function is the parameters. You can input multiple configuration items through an array, or you can provide no configuration item and get a Out-GridView that will allow you to multi-select Configuration Items. We also have a ValidateSet that will allow you to choose if you only want a Detection Method, or a Remediation, or both. I don\'t really know why you would just want a Remediation Script, but maybe you already have a Detection Method in place? By default, it\'s going to default to both a Detection and Remediation Script.\\n\\n```powershell\\n    [CmdletBinding()]\\n    Param(\\n        [Parameter(Mandatory = $False)]\\n        [array]$configurationItem,\\n        [Parameter(Mandatory = $False)]\\n        [ValidateSet(\\"Detection\\", \\"Remediation\\", \\"Detection/Remediation\\")]\\n        $scriptType = \\"Detection/Remediation\\"\\n    )\\n```\\n\\n### Authentication, Declarations\\n\\nI\'m capturing the present working directory ($pwd) to put the location back to once the function is finished. We\'re also providing authentication to CM, as you will need access to CM to pull the Configuration Items. After that, my declarations are very repeatable, but the last 4 lines are customizable to fit your needs.\\n\\n$templateDetectionScript and $templateRemediationScript should be the files on my GitHub, just change to the location that fits for you. $OutputDetectionScript and $OutputRemediationScript are where the files will be saved to, with the name of the function and the date ran.\\n\\n```powershell\\n$StartingLocation = $pwd\\n\\n    #region ConfigMgr Authentication\\n    $SiteCode = \\"JL1\\"\\n    Import-Module \\"$($ENV:SMS_ADMIN_UI_PATH)\\\\..\\\\ConfigurationManager.psd1\\"\\n    Set-Location \\"$SiteCode`:\\"\\n    #endregion\\n\\n    #region Declarations\\n    $FunctionName = $MyInvocation.MyCommand.Name.ToString()\\n    $date = Get-Date -Format yyyyMMdd-HHmm\\n    if ($outputdir.Length -eq 0) { $outputdir = $pwd }\\n    $OutputFilePath = \\"$OutputDir\\\\$FunctionName-$date.csv\\"\\n    $LogFilePath = \\"$OutputDir\\\\$FunctionName-$date.log\\"\\n    $templateDetectionScript = \\"C:\\\\Users\\\\jlove\\\\test\\\\Intune-Registry-Detect.ps1\\"\\n    $templateRemediationScript = \\"C:\\\\Users\\\\jlove\\\\test\\\\Intune-Registry-Remediate.ps1\\"\\n    $OutputDetectionScript = \\"$OutputDir\\\\detect_$FunctionName-$date.ps1\\"\\n    $OutputRemediationScript = \\"$OutputDir\\\\remediate_$FunctionName-$date.ps1\\"\\n    $ResultsArray = @()\\n    #endregion\\n```\\n\\n### Gathering the Configuration Items\\n\\nIn the first part, if you do not input a configuration item in the parameter block, you\'ll get a popup from Out-GridView allowing you to multi-select configuration items. I forget who I found this little trick through, but I\'ve been trying to put the Out-GridView selection into everything I do since then. I find it to be so helpful. If you did input configuration items in the parameter block, then we are doing a search for those configuration items, and then adding them to an array.\\n\\n```powershell\\n #region Configuration Items\\n    if ($null -eq $configurationItem) {\\n        $resolvedConfigurationItems = (Get-CMConfigurationItem -Name * -Fast | \\n            Select-Object DateLastModified, InUse, LocalizedDescription, LocalizedDisplayName, ObjectPath |\\n            Out-GridView -PassThru).LocalizedDisplayName\\n    }\\n    else {\\n        $resolvedConfigurationItems = @()\\n        foreach ($item in $configurationItem) {\\n            $resolvedItem = (Get-CMConfigurationItem -Name $item -Fast).LocalizedDisplayName\\n            if ($resolvedItem) {\\n                $resolvedConfigurationItems += $resolvedItem\\n            }\\n            else {\\n                Write-Warning \\"Could not resolve configuration item: $item\\"\\n            }\\n        }\\n    }\\n    #endregion\\n```\\n\\n### Building the Configuration Items for Conversion\\n\\nWith how the data is stored in CM, I found I had to do some manipulation to then get it to work with PowerShell.\\n\\n- For the $complianceRules section, in our environment we are looking for a \\"Value\\" and checking to make sure the item \\"Exists\\". Because of that, I only wanted to grab what is a value, so I put a Where-Object on this.\\n- Similar with $complianceSettings, I don\'t want to grab anything that\'s already a script, just anything where the sourceType = Registry. If it\'s not Registry-based, I\'m simply skipping over all of that. There are other ways to export those scripts.\\n- Switch is somewhat new to me, and I\'ve been trying to use that more also. CM stores the items as Int64, String, and StringArray (amongst some others), but using PowerShell, they need to be DWORD, STRING, MULTISTRING, so I am converting to that format.\\n- I also need to change HKEY_LOCAL_MACHINE to HKLM: and HKEY_CURRENT_USER to HKCU:.\\n- Once all the data is manipulated how I want, I\'m adding everything to a PSCustomObject, and then storing in a $ResultsArray.\\n\\n```powershell\\n#region Compliance Rules/Compliance Settings\\n    foreach ($item in $resolvedConfigurationItems) {\\n        Write-Output \\"Processing configuration item: $item\\"\\n\\n        $complianceRules = Get-CMComplianceRule -Name $item -WarningAction Ignore | \\n        Where-Object { $_.expression.operands.methodtype -eq \\"Value\\" }\\n\\n        $complianceSettings = Get-CMComplianceSetting -Name $item -WarningAction Ignore | \\n        Where-Object { $_.sourceType -eq \\"Registry\\" } | Select-Object -Unique\\n\\n        if (!$complianceSettings) {\\n            Write-Warning \\"Configuration Item \'$item\' is not Registry-based. Skipping...\\"\\n            continue\\n        }\\n\\n        foreach ($rule in $complianceRules) {\\n            foreach ($setting in $complianceSettings) {\\n\\n                $settingdatatypeName = switch ($setting.settingdataType.Name) {\\n                    \\"Int64\\" { \\"DWORD\\" }\\n                    \\"String\\" { \\"STRING\\" }\\n                    \\"StringArray\\" { \\"MULTISTRING\\" }\\n                    default { $setting.settingdataType.Name }\\n                }\\n\\n                $settingLocation = $setting.location -replace \'^HKEY_LOCAL_MACHINE\', \'HKLM:\' -replace \'^HKEY_CURRENT_USER\', \'HKCU:\'\\n                $result = New-Object -TypeName PSObject -Property @{\\n                    RuleValue       = $($rule.expression.operands.Value)\\n                    SettingDataType = $settingdatatypeName\\n                    SettingPath     = $settingLocation\\n                    SettingName     = $($setting.ValueName)\\n                }\\n\\n                $ResultsArray += $result\\n            }\\n        }\\n    }\\n\\n    if ($ResultsArray.Count -eq 0) {\\n        Write-Warning \\"No registry-based configuration settings found in any selected Configuration Items.\\"\\n        return\\n    }\\n    #endregion\\n```\\n\\n### Building the Registry Keys\\n\\nIn this region, we\'re simply taking the results from the $ResultsArray and converting to the format needed in the Detection and Remediation Scripts.\\n\\n```powershell\\n#region Build RegistryKeys content\\n    $registryKeysContent = @()\\n    $registryKeysContent += \\"`$RegistryKeys = @(\\"\\n    foreach ($result in $ResultsArray) {\\n        $registryKeysContent += \\"    @{ Path = `\\"$($result.SettingPath)`\\"; Name = `\\"$($result.SettingName)`\\"; Type = `\\"$($result.SettingDataType)`\\"; Value = `\\"$($result.RuleValue)`\\" }\\"\\n    }\\n    $registryKeysContent += \\")\\"\\n    #endregion\\n```\\n\\n### Modifying the templates, saving the new files.\\n\\n- The IndexOf, we\'re looking for the correct lines in the detection and remediation script, and if not, we\'re leaving those sections as is. In simple terms, we\'re only looking to modify a certain block of text in the two template files, and add on to it with whatever is in the ResultsArray.\\n- Once all that is finished, we\'re then saving as a new PowerShell file, with the right encoding.\\n- We have checks from the parameter block looking for either Detection, Remediation, or both.\\n\\n```powershell\\n #region Detection Script\\n    if ($scriptType -eq \\"Detection\\" -or $scriptType -eq \\"Detection/Remediation\\") {\\n        $detectiontemplateLines = Get-Content $templateDetectionScript\\n        $detectionstartIndex = $detectiontemplateLines.IndexOf(\'$RegistryKeys = @(\')\\n        $detectionendIndex = $detectiontemplateLines.IndexOf(\')\')\\n\\n        if ($detectionstartIndex -eq -1 -or $detectionendIndex -eq -1) {\\n            Write-Warning \\"Could not find `$RegistryKeys block in the detection template. Check formatting.\\"\\n        }\\n        else {\\n            $detectionnewContent = @()\\n            $detectionnewContent += $detectiontemplateLines[0..($detectionstartIndex - 1)]\\n            $detectionnewContent += $registryKeysContent\\n            $detectionnewContent += $detectiontemplateLines[($detectionendIndex + 1)..($detectiontemplateLines.Length - 1)]\\n\\n            $detectionnewContent | Out-File $OutputDetectionScript -Encoding utf8\\n            Write-Output \\"Detection script saved as: $OutputDetectionScript\\"\\n        }\\n    }\\n    #endregion\\n\\n    #region Remediation Script\\n    if ($scriptType -eq \\"Remediation\\" -or $scriptType -eq \\"Detection/Remediation\\") {\\n        $remediationtemplateLines = Get-Content $templateRemediationScript\\n        $remediationstartIndex = $remediationtemplateLines.IndexOf(\'$RegistryKeys = @(\')\\n        $remediationendIndex = $remediationtemplateLines.IndexOf(\')\')\\n\\n        if ($remediationstartIndex -eq -1 -or $remediationendIndex -eq -1) {\\n            Write-Warning \\"Could not find `$RegistryKeys block in the remediation template. Check formatting.\\"\\n        }\\n        else {\\n            $remediationnewContent = @()\\n            $remediationnewContent += $remediationtemplateLines[0..($remediationstartIndex - 1)]\\n            $remediationnewContent += $registryKeysContent\\n            $remediationnewContent += $remediationtemplateLines[($remediationendIndex + 1)..($remediationtemplateLines.Length - 1)]\\n\\n            $remediationnewContent | Out-File $OutputRemediationScript -Encoding utf8\\n            Write-Output \\"Remediation script saved as: $OutputRemediationScript\\"\\n        }\\n    }\\n    #endregion\\n    Set-Location $StartingLocation\\n}\\n```\\n\\n## Script Example\\n\\nIn my example, I have a set of Configuration Items that are setting Windows Services to Disabled in the registry. I\'m wanting to take those, and convert them to an Intune Remediation Script.\\n\\nI ran the function without inputting any configuration items, or choosing what method I want. Who is to remember the names of these anyways?\\n\\n![](example.png \\"Example\\")\\n\\nI am now prompted to select what Configuration Items I want to include. I want all of them that are Services\\n\\n![](out-gridview.png \\"Out-Gridview\\")\\n\\nI want some pretty output telling me what is happening\\n\\n![](example2.png \\"Output\\")\\n\\nI now have both a Detection and Remediation Script!\\n\\n![](example_detection.png \\"Detection Script\\")\\n\\n![](example_remediation.png \\"Remediation Script\\")\\n\\n# Conclusion\\n\\nNext step would be to tie this all to a GitHub Action, and have this upload to Intune, following proper code review using branch protection. Again, maybe you already had PowerShell scripts in CM. You were more thoughtful than me (we are about 50/50). If not, you now have a way to convert those more easily.\\n\\nHave a great weekend everyone! GO PACERS\\n\\n![](tyrese.jpeg \\"Tyrese Haliburton\\")"},{"id":"cis-benchmarks-avd-multisession","metadata":{"permalink":"/blog/cis-benchmarks-avd-multisession","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-05-13-cis-benchmarks-avd-multisession/index.md","source":"@site/blog/2025-05-13-cis-benchmarks-avd-multisession/index.md","title":"CIS L1 Benchmarks in Intune with AVD Multi-Session Hosts","description":"Details on what settings aren\'t in scope with AVD Multi-Session hosts.","date":"2025-05-13T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"CIS","permalink":"/blog/tags/cis","description":"Center for Internet Security related posts."},{"inline":false,"label":"AVD","permalink":"/blog/tags/avd","description":"Azure Virtual Desktop related posts."}],"readingTime":9,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"CIS L1 Benchmarks in Intune with AVD Multi-Session Hosts","description":"Details on what settings aren\'t in scope with AVD Multi-Session hosts.","slug":"cis-benchmarks-avd-multisession","date":"2025-05-13T00:00:00.000Z","tags":["intune","cis","avd"]},"unlisted":false,"prevItem":{"title":"Converting Registry Based SCCM Configuration Items to Intune Remediation Scripts","permalink":"/blog/configurationitems-to-remediationscripts"},"nextItem":{"title":"Creating Intune Randomized Rollouts with Entra Group Membership","permalink":"/blog/entra-grouprandomization"}},"content":"Details on what settings aren\'t in scope for the Windows 11 Benchmark with AVD Multi-Session hosts.\\n\\n\x3c!-- truncate --\x3e\\n\\nWhat a week! Last week was MMS MOA 2025, and I still have this odd hangover from the week that I\'m trying to recover from. The past couple nights I\'ve been in bed by 8-9 p.m., which for my 40 year old self, isn\'t that far off. The haze in general is starting to wear off, and I\'m starting to get back into the swings of every day life and every day work. I always come out of MMS with such excitement, but then typically there are the work challenges that get in the way. Never the fault of the actual team I\'m on mind you, just work in general. I thought about making a post about all the sessions, all the fun, and everything else that makes MMS great, but my brain is foggy, and I don\'t know that I could do the week proper justice.\\n\\nOne of the questions I asked in a session about the Open Intune Baseline was surrounding AVD, and how to manage multi-session hosts. For those unfamiliar, AVD Multi-Session is running a \\"ServerRDSH\\" SKU, which, accurate or not, I think of these as Terminal Servers running a Windows 11 like operating system. With that, there are challenges with managing these in Intune. Microsoft, has IMO a pretty poorly written [Microsoft Learn[(https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/azure-virtual-desktop-multi-session)] article, that vaguely lays out the limitations. As we\'ve started on the AVD path, and with the amount of clicks it takes in Intune to see what settings are actually applying and what are Not Applicable, we noticed quite the drift in our settings, especially when configuring the CIS L1 Baselines. In our case, due to auditing purposes, we use CIS Windows 11 Enterprise L1, rather than the Intune baseline that has been developed.\\n\\nOnce we figured out there was a limitation in the settings, I got thinking, how can we gather this data and actually know what is applying?\\n\\n## Graph API for the win\\n\\nWhen the Graph API first came out, I was confused on how this worked. Granted, I\'m still confused, but just not as confused. In ITIL terms, that is considered progressing iteratively. We looked at the Graph SDK, and I quickly got frustrated by the length of some of the cmdlets, and the inconsistencies. So rather than fumbling with the cmdlets, I\'ve really dove into the Graph API, and found it so much more repeatable and enjoyable. There are still gotchas, and I\'m still trying to really figure out the syntax on searching, but I\'m getting better.\\n\\nI wrote a quick function, called [Export-IntuneConfigurationSettings](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneConfigurationSettings.ps1). What this allows me to do is search the Graph URI \\"https://graph.microsoft.com/beta/deviceManagement/configurationSettings\\", for settings and return the data from that. (Settings Catalog backed only)\\n\\n## Walking through the script\\n\\nI don\'t like to just link a script and leave it at that, so let\'s walk through it.\\n\\n### Parameters, Connection, Declarations\\n\\nIf you\'ve seen past posts from me, a lot of what I write I like to make very repeatable. To be honest, I do a lot of copying and pasting. But, it makes things easier for me, and I like to think easier for the people I work with when they look at our modules and functions and see repeatable code, rather than something crazy.\\n\\n\\n```powershell\\n            $uri = \\"https://graph.microsoft.com/beta/deviceManagement/configurationSettings\\"\\n            $Settings = (Invoke-MGGraphRequest -Method Get -Uri $uri).value\\n```\\n\\nBased off the connection above, I was able to find all the different operating system skus that are available on the Windows side in Intune. For this purposes (and most), I don\'t really care too much about iOS, Android, or Mac, so I\'m just including Windows based operating systems.\\n\\n```powershell\\n$settings.applicability.windowsskus\\n```\\n\\nThis will give you the direct path to the full list of the WindowsSkus.\\n\\n\\n```powershell\\n[CmdletBinding()]\\n    Param(\\n        [Parameter(Mandatory = $True,\\n            HelpMessage = \\"Choose from the following: All, windowsCloudN, windows11SE, iotEnterpriseSEval, windowsCPC, windowsEnterprise, windowsProfessional, windowsEducation, holographicForBusiness, windowsMultiSession, iotEnterprise\\")]\\n        [ValidateSet(\'All\', \'windowsCloudN\', \'windows11SE\', \'windows11SE\', \'iotEnterpriseSEval\', \'windowsCPC\', \'windowsEnterprise\', \'windowsProfessional\', \'windowsEducation\', \'holographicForBusiness\', \'windowsMultiSession\', \'iotEnterprise\')]\\n        [string]$Scope\\n    )\\n```\\n\\nAs you can see above, I\'m doing a ValidateSet and giving options on the different SKUs to choose from, or you can select All.\\n\\n```powershell\\n    # Microsoft Graph Connection check\\n    if ($null -eq (Get-MgContext)) {\\n        Write-Error \\"Authentication needed. Please connect to Microsoft Graph.\\"\\n        Break\\n    }\\n\\n    #region Declarations\\n    $FunctionName = $MyInvocation.MyCommand.Name.ToString()\\n    $date = Get-Date -Format yyyyMMdd-HHmm\\n    if ($outputdir.Length -eq 0) { $outputdir = $pwd }\\n    $OutputFilePath = \\"$OutputDir\\\\$FunctionName-$date.csv\\"\\n    $LogFilePath = \\"$OutputDir\\\\$FunctionName-$date.log\\"\\n    $ResultsArray = @()\\n    #endregion\\n```\\n\\nThis section is basically in all the code I have. In my profile, I have an $outputDir that I am setting, just a default path to dump all my files. If that is not present, than it will dump to present working directory.\\n\\n### Gathering the settings\\n\\nNow, we\'re ready to gather the settings. Based on the $Scope above, I have a Switch statement, one that is looking for **ALL** the settings, and one looking for settings based on a specific SKU.\\n\\n```powershell\\n #region Gather the settings\\n    Switch ($Scope) {\\n        \\"All\\" {\\n            $uri = \\"https://graph.microsoft.com/beta/deviceManagement/configurationSettings\\"\\n            $Settings = (Invoke-MGGraphRequest -Method Get -Uri $uri).value\\n        }\\n        Default {\\n            Try {\\n                $uri = \\"https://graph.microsoft.com/beta/deviceManagement/configurationSettings?`$search=%22|||WindowsSkus=$Scope|||%22\\"\\n                $Settings = (Invoke-MGGraphRequest -Method Get -Uri $uri).value\\n            }\\n            Catch {\\n                Write-Error \\"Error gathering Settings: $_\\"\\n            }\\n        }\\n    }\\n    #endregion\\n```\\n\\n### Building the object, outputting the results\\n\\nNow that we have the data, we can then build it into a PSCustomObject, and output the results. Nothing too crazy here, this is the data I found most intriguing, but there is a ton of information in the Graph API for this. Once that is done, we\'re outputting the results to a CSV file to look at later.\\n\\n```powershell\\n#region Build Object\\n    foreach ($item in $Settings) {\\n        $result = New-Object -TypeName PSObject -Property @{\\n            Name                    = $item.Name\\n            Keywords                = $item.Keywords -join \\"; \\"\\n            RootDefinitionId        = $item.RootDefinitionId\\n            DisplayName             = $item.DisplayName\\n            HelpText                = $item.HelpText\\n            OffsetURI               = $item.OffsetURI\\n            InfoUrls                = $item.InfoUrls -join \\"; \\"\\n            MinimumSupportedVersion = $item.applicability.MinimumSupportedVersion\\n            WindowsSkus             = $item.applicability.WindowsSkus -join \\"; \\"\\n        }\\n        $ResultsArray += $result\\n    }\\n    #endregion\\n\\n    #region Results\\n    if ($ResultsArray.Count -ge 1) {\\n        $ResultsArray | Sort-Object -Property DisplayName | Export-Csv -Path $OutputFilePath -NoTypeInformation\\n    }\\n\\n    # Test if output file was created\\n    if (Test-Path $OutputFilePath) {\\n        Write-Output \\"Output file = $OutputFilePath.\\"\\n    }\\n    else {\\n        Write-Warning \\"No output file created.\\"\\n    }\\n    #endregion\\n```\\n\\n## The Data\\n\\nI\'ve uploaded the raw CSV file on my Github, along with some other files.\\n\\n[CSV output for All](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneConfigurationSettings-20250513-1630_All.csv)\\n[CSV output for Multi-Session](https://github.com/Pacers31Colts18/Intune/blob/main/Export-IntuneConfigurationSettings-20250513-1628_multi-session.csv)\\n\\n\\nInitial count:\\n\\n- 16232 lines/settings for All\\n- 13288 lines/settings for Multi-Session\\n- 13739 lines/settings for Windows Enterprise\\n\\nQuite the difference, even between Multi-Session and Enterprise\\n\\n### CIS Benchmarks\\n\\nThe last bit of this post, is how this relates to CIS Benchmarks. When I first started looking at this, we were (and still) are on Enterprise v3.0.0. Since then, v4.0.0 has been released, along with v4.0.0 of the Intune benchmark. Rather than go back and re-work all the data, which was becoming to annoying for me. I\'ve included three tabs, one for CIS Windows 11 Enterprise v3.0.0, one for CIS Windows 11 Enterprise v4.0.0 (only the new settings), and one for CIS Windows 11 Intune v4.0.0\\n\\nThe data for that can also be found on my [GitHub](https://github.com/Pacers31Colts18/Intune/blob/main/Intune_CISBenchmarks_MultiSession.xlsx)\\n\\nBreakdown of each tab:\\n\\n- v3.0.0 Windows 11 Enterprise L1\\n    - 61/384 settings are Intune configurable but not AVD Multi-Session scoped.\\n        - Intune configurable = Settings Catalog configurable, no custom ADMX, CSP, Remediation, etc.\\n    - 82/384 settings are not Intune configurable, meaning they are not an option in the Settings Catalog\\n        - Or they could be names I couldn\'t find, looking at you One Drive instead of OneDrive!\\n    - 143/384 settings are not supported in Intune for AVD Multi-Session hosts\\n- v4.0.0 Windows 11 Enterprise L1\\n    - Like I said, a new benchmark released, so this tab is a little bit of a work in progress here.\\n    - 3/31 settings are Intune configurable but not AVD Multi-Session scoped.\\n    - 10/31 settings are not Intune configurable, meaning they are not an option in the Settings Catalog\\n    - 13/31 settings  are not supported in Intune for AVD Multi-Session hosts (adding in the v3.0.0 settings to get the full picture)\\n\\nBefore I go too much further, I do want to recognize that CIS says the Intended Audience for these benchmarks are:\\n\\n![CIS Guidance](win11_guidance.png)\\n\\nWe\'re in this situation where we have multiple forests, hybrid joined, and no longer wish to manage our settings with Group Policy. Due to regulations, we also need to adhere to IRS config standards, which use the Enterprise benchmarks. I don\'t believe we\'re the only ones out there doing this, as Microsoft\'s stance has been to push users towards Intune management rather than Group Policy management, so this is the pickle we are in.\\n\\n*Mini disclaimer over*\\n\\nFor work purposes, the Enterprise benchmarks is all I really care about, but for everyone else, I wanted to provide the Intune benchmark data also.\\n\\n- v4.0.0 Microsoft Intune for Windows 11\\n    - 86/337 settings/lines are Intune configurable but not AVD Multi-session scoped.\\n    - 16/337 settings are not Intune configurable, meaning they are not an option in the Settings Catalog.\\n        - Note: These are named properly from CIS, where the Enterprise uses Group Policy naming convention.\\n            - Next rant: You think they could standardize the naming scheme for us between GPO and Intune? That\'d be super neat.\\n    - 102/337 settings are not supported in Intune for AVD Multi-Session Hosts\\n\\n### Big Takeways\\n\\n- For some reason, User Rights Assignments aren\'t supported. Why? Beats me. It seems like you would want these to be configurable, but maybe I am missing something.\\n- ASR Rules aren\'t supported. I\'m assuming you just wouldn\'t want processes to start getting blocked on these and locking users out?\\n- Services, not Intune supported at all, but maybe one day?\\n- The rest seem like random settings to me. I don\'t really see a rhyme or reason really to why some would be supported, but some aren\'t. Example: Allow Cortana = Supported. Allow Cortana Above Lock = Not Supported\\n\\n## Conclusion\\n\\nReally, this was more of an awareness post more than anything. I think a lot of us are new to the AVD/VDI/Virtual world, coming mainly from a physical workstation side of the house. I\'ve touched Citrix, but it\'s been many years ago. With Intune and now Microsoft having AVD, it seems orgs are sort of combining the teams and hoping to set the policies the same as a workstation. To me it makes total sense to go this route, but there are some catches and things to consider, especially with Intune. Hopefully this will help someone else out, and be able to catch settings not applying more easily."},{"id":"entra-grouprandomization","metadata":{"permalink":"/blog/entra-grouprandomization","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-26-entra-pilotgrouprandomization/index.md","source":"@site/blog/2025-04-26-entra-pilotgrouprandomization/index.md","title":"Creating Intune Randomized Rollouts with Entra Group Membership","description":"Creating Intune Randomized Rollouts with Entra Group Membership","date":"2025-04-26T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"Entra","permalink":"/blog/tags/entra","description":"Entra related posts."},{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."},{"inline":false,"label":"Graph API","permalink":"/blog/tags/graph-api","description":"Microsoft Graph API related posts."}],"readingTime":7.51,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Creating Intune Randomized Rollouts with Entra Group Membership","description":"Creating Intune Randomized Rollouts with Entra Group Membership","slug":"entra-grouprandomization","date":"2025-04-26T00:00:00.000Z","tags":["intune","entra","powershell","graph-api"]},"unlisted":false,"prevItem":{"title":"CIS L1 Benchmarks in Intune with AVD Multi-Session Hosts","permalink":"/blog/cis-benchmarks-avd-multisession"},"nextItem":{"title":"An even better way to automate Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","permalink":"/blog/entra-deviceextensionattributes-automation-better"}},"content":"A walk through on how to create randomized rollouts for Intune deployments with Entra Groups using the Graph API.\\n\\n\x3c!-- truncate --\x3e\\n\\n\\nIt\'s been a couple weeks now since I made my last post, with the weather starting to get nicer, it means more yard work and more random projects around the house. Next week is MMSMOA 2025, and I will be attending that with many team members. I think this is my 5th MMS, with my first one being in 2018 (I think). I\'m really looking forward to it again and to see what new concepts everyone comes up with. I leave every year very excited, but also very worn out from all the days in the conference rooms, and the events that take place afterwards.\\n\\nWith that said, I didn\'t want to go three weeks without posting anything, but was also struggling to come up with things to write about. Part of my struggle is seeing the already great content out there, and thinking that I can\'t truly add the value that other people provide. I know it\'s a bad head space to be in, and something to work through.\\n\\nIn our org, we have around 40k devices. Rolling out policies in the Group Policy days was a little bit easier for us, as we weren\'t hitting every device at once (way too many forests). The great thing about Intune, is that we can hit all the devices at once. The bad thing about Intune, is we can hit all devices at once!\\n\\nSo the question became, how do we effectively roll out policy to devices and not run into issues? We have a pilot group, but pilot groups are hard to maintain, and not always the best representation of the org. Someone has to maintain that membership, and get buy in from users to be apart of the pilot group, and have enough members. Once we get past the initial internal piloting, and then the pilot group itself, we wanted a way to slowly rollout policies over a course of 2-3 weeks, to catch any issues should they come up.\\n\\nIn our environment when rolling out large scale policies, we aim for a 1%/10%/25%/All Workstations. Typically this will run over the course of three weeks, in a schedule looking like this:\\n\\n- Week 1\\n    - Monday: 1%\\n    - Thursday: 10%\\n- Week 2\\n    - Monday: 25%\\n- Week 3\\n    - Monday: All Workstations\\n\\nThe thought being, after pilot groups, we are sitting at around 40% of devices covered in a random selection. If something were to happen after this rollout that causes an issue, it\'s probably more just bad luck.\\n\\nWe have two variations of this function. One being for ConfigMgr. This is used for ConfigMgr rollouts (Configuration Baselines/Configuration Items) and Active Directory groups (Group Policy). The one I am going to show in this post, is for building Entra groups for Intune rollouts.\\n\\nIn our org, something like this would go through the Change Control process, so we like to dump the output of this to a CSV file, then build the group membership after the fact. This could be easily tweaked to build the pilot groups themselves.\\n\\n# Walking through the function\\n\\nFirst, the function can be found on my [Github](https://github.com/Pacers31Colts18/Entra/blob/main/Export-EntraGroupPilotMembers.ps1).\\n\\nA lot of our code is very repeatable, and makes it easier for the next person to look at and pick up on.\\n\\n##  Parameters, Declarations, Graph Check\\n\\n```powershell\\n[CmdletBinding()]\\n    Param(\\n        [Parameter(Mandatory = $True)]\\n        [string]$SourceEntraGroupName,\\n        [Parameter(Mandatory = $True)]\\n        [ValidateRange(1, 100)][int]$Percentage\\n    )\\n\\n    #region Declarations\\n    $FunctionName = $MyInvocation.MyCommand.Name.ToString()\\n    $date = Get-Date -Format yyyyMMdd-HHmm\\n    if ($outputdir.Length -eq 0) { $outputdir = $pwd }\\n    $OutputFilePath = \\"$OutputDir\\\\$FunctionName-$date.csv\\"\\n    $LogFilePath = \\"$OutputDir\\\\$FunctionName-$date.log\\"\\n    $graphApiVersion = \\"beta\\"\\n    $resultsArray = @()\\n    #endregion\\n    \\n    # Microsoft Graph Connection check\\n    if ($null -eq (Get-MgContext)) {\\n        Write-Error \\"Connect to Graph\\"\\n        Break\\n    }\\n```\\n\\n### Parameters\\n\\nFirst up is the parameter block. For $SourceEntraGroupName, we are building this off an Entra group that is already established. Example being, say you have an **SG - All Windows 11** group and you are looking to rollout a new policy to Windows 11 devices. You would input this group, then for $Percentage, provide the percentage of devices you want in your pilot group. We do have a ValidateRange check of 1-100. How is it a pilot if you have 100% of devices? It\'s not, sometimes we just like to use this as a cheat to quickly return all the group members.\\n\\n### Declarations\\n\\nThis is in almost all of our code, and makes the format of our logging, output files, and directories very repeatable. We set the $outputdir in our Powershell profiles to our preference location. Then use the $FunctionName parameter to name the log file in a proper manner.\\n\\n### Graph Check\\n\\nFinally for this section, just a quick little check to see if you\'re connected to Graph, and if not, return an error.\\n\\n## Groups\\n\\n```powershell\\n#region Obtain Group\\n    try {\\n        $uri = \\"https://graph.microsoft.com/$graphApiVersion/groups?`$filter=DisplayName eq \'$SourceEntraGroupName\'\\"\\n        $group = (Invoke-MgGraphRequest -uri $uri -Method GET).value\\n        Write-Output \\"Obtaining Group: $sourceEntraGroupName\\"\\n    }\\n    catch {\\n        Write-Error \\"An error occurred : $_\\"\\n    }\\n    #end region\\n\\n    #region Obtain Group Members  \\n    $resultCheck = @()   \\n    try {\\n        $uri = \\"https://graph.microsoft.com/$graphApiVersion/groups/$($group.Id)/members\\"\\n        #pagination\\n        do {\\n            $groupmembers = (Invoke-MgGraphRequest -Uri $uri -Method GET)\\n            $resultCheck += $groupmembers\\n        \\n            $uri = $groupmembers.\'@odata.nextLink\'\\n        } while ($uri)\\n        $groupmembers = $resultCheck.value\\n\\n        Write-Output \\"Obtaining \'$($group.DisplayName)\' with $($groupmembers.count) members.\\" -ForegroundColor Cyan\\n    }\\n    catch {\\n        Write-Error \\"An error occurred : $_\\"\\n    }\\n    #endregion\\n```\\n\\n### Obtaining the Group\\n\\nFrom here, we\'re going to use the Graph API to get the group and all the details associated with it. In the beginning, we tried to stick with the Graph SDK cmdlets. Honestly, I\'ve grown to hate them, and have reverted to using the API, or just relying on the Invoke-MgGraphRequest for nearly everything. I found the SDK to be a pain, with a lack of documentation, examples, and just super long cmdlet names. Finding them, and then finding that they don\'t work properly became a headache. Once the syntax of the API is figured out (which just takes some repetition), I find this way to be sooooo much easier. From what I\'ve gathered, the SDK is just a wrapper for the API anyways, so I don\'t really see the point of it to be honest.\\n\\n### Obtaining Group Members\\n\\nSame concept here, once we have the Group details (from the $group variable), we can then obtain the membership using the **$group.id**. Based on the size of your Source Group, you might run into pagination issues. In simple terms, pagination is a limit on how much data you can get back at a time with Graph, so you\'re not slamming the system. More information can be found [here](https://practical365.com/pagination-graph-sdk/) and from [Microsoft](https://learn.microsoft.com/en-us/graph/paging?tabs=http)\\n\\n## Randomization\\n\\n```powershell\\n#region Randomization\\n    $Decimal = $Percentage / 100\\n    $NumberofMembers = [int]($($groupMembers).Count * $Decimal)\\n    $NumberofMembers = [Math]::Ceiling($NumberofMembers)\\n\\n    Write-Output \\"Randomizing group and gathering $NumberofMembers workstations.\\"\\n    $GroupMembers = $GroupMembers | Sort-Object { Get-Random }\\n    $GroupMembers = $GroupMembers | Select-Object -First $NumberofMembers\\n\\n    #endRegion\\n```\\n\\nOnce the group members are returned, we then move onto the randomization of the script. What we\'re doing here is just simple math, and converting the percentage to a decimal and multiplying to get the count. From there, we are using a Sort-Object with Get-Random, which literally just does what it says and gets a random output of the devices. We\'re then selecting those members.\\n\\n## Building the PSCustomObject\\n\\n```powershell\\n#region Build Object\\n    foreach ($member in $groupMembers) {\\n        $result = New-Object -TypeName PSObject -Property @{\\n            EntraDeviceID = $member.deviceId\\n            DeviceName    = $member.displayName\\n        }\\n        $ResultsArray += $result\\n    }\\n    #endregion\\n```\\nNow we\'re building the data and will be outputting the data. Any property can be added here from what is stored on the device in Entra, but in my case, all I am looking for is the EntraDeviceID and DeviceName. DeviceName, mainly for change control purposes. EntraDeviceID, for when I create the group and add the members.\\n\\n## Outputting the Results\\n\\n```powershell\\n #region Results\\n    if ($ResultsArray.Count -ge 1) {\\n        $ResultsArray | Export-Csv -Path $outputfilepath -NoTypeInformation\\n    }\\n\\n    # Test if output file was created\\n    if (Test-Path $outputfilepath) {\\n        Write-Output  \\"Output file = $outputfilepath.\\"\\n    }\\n    else {\\n        Write-Warning \\"No output file created.\\"\\n    }\\n    #endregion\\n}\\n```\\n\\nThis is another repeatable section we have in our code. Like I said, we typically output a lot of our data to CSV files for change control purposes. This is a repeatable piece of code that we typically have in every output. What we are doing here is checking if the $ResultsArray (from the PSCustomObject) has any data, and if so, exporting the data to a CSV file, where the Path is in our declarations section. We are then testing to make sure the file was created successfully.\\n\\n## Conclusion\\n\\nSo now, we have a list of devices that are randomized, and based off a percentage from a source group. You can then repeat this process to build out other wave groups. Rather than have static groups to do the rollout, you can randomize it and get different results each time.\\n\\nNext week I\'ll be at MMS. If you happen to see me, be sure to say hi!"},{"id":"entra-deviceextensionattributes-automation-better","metadata":{"permalink":"/blog/entra-deviceextensionattributes-automation-better","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-12-entra-deviceextensionattributes-betterway/index.md","source":"@site/blog/2025-04-12-entra-deviceextensionattributes-betterway/index.md","title":"An even better way to automate Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","description":"A better process for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation Runbooks.","date":"2025-04-12T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"Entra","permalink":"/blog/tags/entra","description":"Entra related posts."},{"inline":false,"label":"Azure","permalink":"/blog/tags/azure","description":"Azure related posts."}],"readingTime":8.13,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"An even better way to automate Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","description":"A better process for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation Runbooks.","slug":"entra-deviceextensionattributes-automation-better","date":"2025-04-12T00:00:00.000Z","tags":["intune","entra","azure"]},"unlisted":false,"prevItem":{"title":"Creating Intune Randomized Rollouts with Entra Group Membership","permalink":"/blog/entra-grouprandomization"},"nextItem":{"title":"Automating Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","permalink":"/blog/entra-deviceextensionattributes-automation"}},"content":"A better process for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure\\n\\n\x3c!-- truncate --\x3e\\n\\n\\nIn my last post, I wrote about how we can use Intune Remediation Scripts, Azure Automation, and Enterprise App Registrations to automate the tagging of device extension attributes on an Entra ID device. From here we can create Entra groups that are dynamic, and constantly updated based on data that we are looking for on the device. I gave the example of adding the domain name to extensionAttribute1, and creating groups based off that for targeting. While what I showed worked, [Nathan McNulty](https://nathanmcnulty.com/), provided some feedback:\\n\\n![](linkedin.png  \\"Nathan McNulty LinkedIn\\")\\n\\nAfter reading through his post on automating [Entra device cleanup](https://nathanmcnulty.com/blog/2023/04/azure-automation-device-cleanup-v2/#grant-devicereadwriteall-permissions), I wanted to share an update along with another example on how to accomplish this. In this post, I\'ll walk through the new configuration, and also give a new example based on the OU the workstation resides in. Beware, some of this might be repetitive. \\n\\n## Intune Remediation Script\\n\\nFirst we will setup the Intune Remediation Script. For this, we are only going to be using a Detection method, as we\'re just looking to read data on the device. In the detection script, I am looking to gather the CN of the device from the registry. From there, I am going to do some RegEx manipulation, to just pull the OU the device resides in. I\'m not looking for the parent OUs, or the CN, just the direct OU.\\n\\n[Intune Remediations - Microsoft Learn](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/remediations)\\n\\n- In the Intune portal, click on Devices > Scripts and Remediations\\n- Go through the basics of creating the remediation script.\\n\\n![](remediation.png \\"Remediation setup\\")\\n\\n- Using the script below as an example, upload the script file as a Detection, and leave everything else as default. [Detection Script](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/ExtensionAttributes/ExtensionAttribute2_Detection_OU.ps1)\\n\\n![](remediation2.png \\"Remediation setup\\")\\n\\n- Add the groups you want to target, along with the schedule you want. In this use case, I am choosing to run this daily, as the device could be moved to a different OU.. If there is a need for other schedules, adjust as you see fit. I would recommend for software detection, or other data that could change a different schedule.\\n\\n![](remediation3.png \\"Remediation assignment\\")\\n\\nAfter the script runs (which thankfully you can also run manually now for testing purposes), let\'s do the following.\\n\\n- From the Scripts and Remedations node, choose your script.\\n- Go to Monitor > Device Status\\n- Under the Column selection, add **Pre-Remediation detection output**\\n- Windows_11 is the OU that my device is joined to.\\n\\n![](remediation4.png \\"Pre-remediation detection output\\")\\n\\n## ~~App Registration~~\\n\\n~~We will also need to configure an App Registration for this process to work. ~~\\n\\n~~- Go to your Azure Portal, and search for App Registration.~~\\n~~- Create a new App Registration with the following configuration:~~\\n\\n\\n~~- Create a new client secret under the **Secrets** node. Take note of the secret, as you will need it later.~~\\n\\n\\n~~- Go to Overview, and make note of the Directory (tenant) ID, and Application (client) ID. You will need this for the Azure Automation portion.~~\\n\\n## Azure Automation\\n\\n- From the Azure Portal, search for Automation Accounts\\n- Click Create\\n- If a Resource Group is not available, you will need to create one\\n- Once created, on the left hand pane, go to **Identity** under Account Settings\\n\\n![](automation_objectid.png)\\n\\n- Make note of the Object Id, we\'ll need it later.\\n\\n~~- Here we are going to store the previous items that we made note of. Each item will have a Type of **String**~~\\n    ~~- ClientID~~\\n    ~~- ClientSecret~~\\n    ~~- TenantID~~\\n~~- Make sure they are named in the same format, or you will need to adjust the runbook.~~\\n\\n\\n### Modules\\n\\nLearning more from Nathan, I too went with installing modules from the Powershell Gallery to help ease the management of this.\\n\\n- Go to Modules under Shared Resources\\n\\n![](automation_modules.png \\"Modules\\")\\n\\n- Click Add a Module\\n- Choose Browse from Gallery\\n- We are going to install two modules:\\n    - Microsoft.Graph.Authentication\\n\\nIs this module 100% necessary? No not really, but it does make the connection simpler in my opinion. The modules are also updated by Microsoft, so less management. If you wanted, a combination of the runbook from the initial post, and the runbook from this could be combined and eliminate the need for the module.\\n\\n## Assigning Permissions\\n\\nAccording to Nathan\'s post, the permissions are not configurable through the GUI. I found this to be accurate, both in my lab environment and at work. When running this in my production environment, I needed someone with GA permissions to configure this portion. Whether GA is actually the right permission needed or not, I\'m not 100% sure. In my lab of course, I\'m running GA, while at work, I have limited permissions. I probably shouldn\'t be running GA in my lab either, but I\'m still setting it up and learning....one day. Using Nathan\'s script on his [blog post](https://nathanmcnulty.com/blog/2023/04/azure-automation-device-cleanup-v2/#grant-devicereadwriteall-permissions), we are going to add three permissions, and the objectId that we took note of above.\\n\\nTo Modify:\\n- $SP_ID\\n    - Add the object ID from your Azure Automation account.\\n- Permissions\\n    - DeviceManagementManagedDevices.Read.All\\n    - DeviceManagementConfiguration.Read.All\\n    - Device.ReadWrite.All\\n- We\'re then going to run this script each time for the permissions needed (3 total).\\n\\n```powershell\\n#Variables to Modify\\n$SP_ID = \'Object (prinicpal) ID from above\'\\n$AppId = (Get-MgServicePrincipal -ServicePrincipalId $SP_ID).AppId\\n\\n# Connect with scopes requried to grant permissions\\n# May require admin consent for Graph PowerShell\\nConnect-MgGraph -Scopes appRoleAssignment.ReadWrite.All,Application.Read.All,Group.ReadWrite.All\\n\\n# Grant Device.ReadWrite.All Graph Permissions\\n\\"Device.ReadWrite.All\\" | ForEach-Object {\\n   $PermissionName = $_\\n   $GraphSP = Get-MgServicePrincipal -Filter \\"startswith(DisplayName,\'Microsoft Graph\')\\" | Select-Object -first 1 #Graph App ID: 00000003-0000-0000-c000-000000000000\\n   $AppRole = $GraphSP.AppRoles | Where-Object {$_.Value -eq $PermissionName -and $_.AllowedMemberTypes -contains \\"Application\\"}\\n   New-MgServicePrincipalAppRoleAssignment -AppRoleId $AppRole.Id -ServicePrincipalId $SP_ID -ResourceId $GraphSP.Id -PrincipalId $SP_ID\\n}\\n\\n```\\n\\n## Enterprise Applications\\n\\nIn the previous post, we created the Enterprise Application and configured the permissions. Now with Nathan\'s script, this will configure the Enterprise Application, and tie the managed identity to the application. The Azure Automation account and the Enterprise Application will have the same name. We can go into the portal and verify everything is correct.\\n\\n- From the Azure Portal, go to Enterprise Applications\\n- By default, the view will be Enterprise Applications, it took me a minute of stumbling around myself to find the application. We will want to change the view to Managed Identity.\\n\\n![](enterpriseapplications_default.png \\"Default view\\")\\n\\n- Change this to **Managed Identites**\\n\\n![](enetpriseapplications_managed.png \\"Managed Identities\\")\\n\\nDo you see the Certificate Expiry Status being Managed by Microsoft. This will make the whole process so much easier. Nobody wants to deal with secrets/certificates expiring and things not working anymore. With the Managed Identity configuration, Microsoft manages this for us! We got better ~~shit~~ stuff to do!\\n\\n\\n### Runbook\\n\\nOk now we have the Azure Automation tied to the Enterprise Application, now we\'re ready to go back and create the Runbook.\\n\\n- Go back to Azure Automation\\n    - Under Process Automation, choose Runbooks\\n    - Create a new Runbook\\n    - Make sure to choose Powershell 5.1\\n\\n![](runbook.png \\"Runbook creation\\")\\n\\n- Click Review and Create\\n- This should then take you to a terminal window\\n- Copy and paste the code here: [Runbook](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/ExtensionAttributes/ExtensionAttribute2_Runbook_OU.ps1)\\n- The top three lines are all that should need to be modified to your liking\\n```powershell\\n#Variables to Modify\\n$scriptName = \\"JoeLoveless - ExtensionAttributes - OrganizationalUnit\\"\\n$appregistrationName = \\"JoeLoveless-Intune-ExtensionAttributes\\"\\n$extensionAttribute = \\"extensionAttribute2\\"\\n```\\n- The $scriptName variable should match the Intune Remediation Script.\\n- The $appregistrationName should match the name of the App Registration.\\n- The $extensionAttribute should be \\"extenstionAttribute\\" and the number you want to tag.\\n    - 1-15 are the allowed extension attributes [Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/device?view=graph-rest-1.0)\\n- Once configured, let\'s make sure it works properly before going any further. Click on Test Pane. If all succeeds, you should see a Succeeded message.\\n- Although it says succedeed, did it really? Go to a device in the Entra portal, and take a look at one.\\n\\n![](extensionattribute.png \\"Extension Attribute on the device\\")\\n\\nSuccess, we now have tagged a device with an Extension Attribute!!!\\n\\n![](yes.gif \\"Yes\\")\\n\\n- First, let\'s go back to our Runbook, and we need to Publish the runbook.\\n![](runbook.png)\\n\\n- Now that we have published the runbook, we can now configure a schedule.\\n- Under Resources, select Schedules and then Add Schedule.\\n- Click Link a Schedule to your Runbook and then Add Schedule.\\n- In my case, I want this to run slightly after the Intune Remediation runs. I don\'t want it to run at the same time, or too close, as there could be a delay on the Microsoft side. 15 minutes seems like a good enough time for me.\\n\\n![](automation_schedule.png)\\n\\n## Groups\\n\\nNow that everything is configured, we can then create Entra ID groups that can be used for targeting purposes within Intune. My initial thought on this method was going to be just adding directly to the groups. While that can be good for certain, more static scenarios, the method I have outlined makes this all dynamic. With the remediation scripts running daily, along with the Azure Automation, the devices can be added/removed from the groups. If adding directly to the groups, you would need a second runbook to remove from the groups. There could be unintended consequences.\\n\\n![](groups.png)\\n\\n## Conclusion\\n\\nAgain, I have to thank Nathan for the feedback and advice on this. I really appreciate it and wanted to share this process. I feel like most of the automation I have seen has been with the ClientId, AppId, and ClientSecret method. While that works, I do feel like this is a better process without having to manage the secret expiration.\\n\\n[Azure Automation - Device Cleanup v2](https://nathanmcnulty.com/blog/2023/04/azure-automation-device-cleanup-v2/#grant-devicereadwriteall-permissions)"},{"id":"entra-deviceextensionattributes-automation","metadata":{"permalink":"/blog/entra-deviceextensionattributes-automation","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-05-entra-deviceextensionattributes/index.md","source":"@site/blog/2025-04-05-entra-deviceextensionattributes/index.md","title":"Automating Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","description":"Process for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation Runbooks.","date":"2025-04-05T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"Entra","permalink":"/blog/tags/entra","description":"Entra related posts."},{"inline":false,"label":"Azure","permalink":"/blog/tags/azure","description":"Azure related posts."}],"readingTime":4.84,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Automating Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","description":"Process for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation Runbooks.","slug":"entra-deviceextensionattributes-automation","date":"2025-04-05T00:00:00.000Z","tags":["intune","entra","azure"]},"unlisted":false,"prevItem":{"title":"An even better way to automate Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","permalink":"/blog/entra-deviceextensionattributes-automation-better"},"nextItem":{"title":"Setting up an Active Directory, ConfigMgr, Intune Lab in 2025","permalink":"/blog/intunelab-2025"}},"content":"A walkthrough for automating the tagging of Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation Runbooks.\\n\\n\x3c!-- truncate --\x3e\\n\\n\\nI have viewed a few posts in the community about how to add extension attributes for Entra ID devices, but everything that I have ran across has been for manually adding extension attributes.\\n\\n- [Ugur Koc](https://ugurkoc.de/from-intune-to-entraid-add-custom-data-to-the-extension-attributes/#:~:text=The%20general%20workflow%20for%20writing%20data%20to%20Extension,update%20the%20Extension%20Attributes%20for%20the%20target%20devices.)\\n\\n- [IntuneStuff](https://intunestuff.com/2023/11/28/how-to-add-extension-attributes-for-aad-devices/)\\n\\nThe question I kept asking myself, is how do you automate this? I wanted to share with everyone the process of using an Intune Remediation Script (Detection only), along with an App Registration, and Azure Automation Runbook. This guide will walk you through setting up everything, which is available on my [GitHub](https://github.com/Pacers31Colts18/Intune/tree/main/RemediationScripts/ExtensionAttributes).\\n\\n## Intune Remediation Script\\n\\nFirst we will setup the Intune Remediation Script. For this, we are only going to be using a Detection method, as we\'re just looking to read data on the device.\\n\\n[Intune Remediations - Microsoft Learn](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/remediations)\\n\\n- In the Intune portal, click on Devices > Scripts and Remediations\\n- Go through the basics of creating the remediation script.\\n\\n![](remediation.png \\"Remediation setup\\")\\n\\n- Using the script below as an example, upload the script file as a Detection, and leave everything else as default. [Detection Script](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/ExtensionAttributes/ExtensionAttribute_Detection.ps1)\\n\\n![](remediation2.png \\"Remediation setup\\")\\n\\n- Add the groups you want to target, along with the schedule you want. In this use case, I am choosing to run this detection once. If there is a need for other schedules, adjust as you see fit. I would recommend for software detection, or other data that could change a different schedule. In this case, I am only looking for the domain the workstation is joined to, which should not change at all.\\n\\n![](remediation3.png \\"Remediation assignment\\")\\n\\nAfter the script runs (which thankfully you can also run manually now for testing purposes), let\'s do the following.\\n\\n- From the Scripts and Remedations node, choose your script.\\n- Go to Monitor > Device Status\\n- Under the Column selection, add **Pre-Remediation detection output**\\n- We should now see an output of the domain name the workstation is joined to.\\n\\n![](remediation4.png \\"Pre-remediation detection output\\")\\n\\n## App Registration\\n\\nWe will also need to configure an App Registration for this process to work. \\n\\n- Go to your Azure Portal, and search for App Registration.\\n- Create a new App Registration with the following configuration:\\n\\n![](AppRegistration_APIPermissions.png \\"API Permissions\\")\\n\\n- Create a new client secret under the **Secrets** node. Take note of the secret, as you will need it later.\\n\\n![](ClientSecret.png \\"Client Secret\\")\\n\\n- Go to Overview, and make note of the Directory (tenant) ID, and Application (client) ID. You will need this for the Azure Automation portion.\\n\\n## Azure Automation\\n\\n### Variables\\n\\nThis is where we automate the process, and tie it all together.\\n\\n- From the Azure Portal, search for Automation Accounts\\n- Click Create\\n- If a Resource Group is not available, you will need to create one.\\n- Once created, on the left hand pane, go to Variables under Shared Resources\\n\\n![](Automation_VariablesMenu.png \\"Automation Variables\\")\\n\\n- Here we are going to store the previous items that we made note of. Each item will have a Type of **String**\\n    - ClientID\\n    - ClientSecret\\n    - TenantID\\n- Make sure they are named in the same format, or you will need to adjust the runbook.\\n\\n![](Automation_Variables.png \\"Automation Variables\\")\\n\\n### Runbook\\n\\n- Under Process Automation, choose Runbooks\\n- Create a new Runbook\\n- Make sure to choose Powershell 5.1\\n\\n![](Runbook.png \\"Runbook creation\\")\\n\\n- Click Review and Create\\n- This should then take you to a terminal window\\n- Copy and paste the code here: [Runbook](https://github.com/Pacers31Colts18/Intune/blob/main/RemediationScripts/ExtensionAttributes/ExtenstionAttribute_Runbook.ps1)\\n- The top three lines are all that should need to be modified to your liking\\n```powershell\\n#Variables to Modify\\n$scriptName = \\"JoeLoveless - ExtensionAttributes - DomainName\\"\\n$appregistrationName = \\"JoeLoveless - Azure Automation - Intune Extension Attributes\\"\\n$extensionAttribute = \\"extensionAttribute1\\"\\n```\\n- The $scriptName variable should match the Intune Remediation Script.\\n- The $appregistrationName should match the name of the App Registration.\\n- The $extensionAttribute should be \\"extensionAttribute\\" and the number you want to tag.\\n    - 1-15 are the allowed extension attributes [Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/device?view=graph-rest-1.0)\\n- Once configured, let\'s make sure it works properly before going any further. Click on Test Pane. If all succeeds, you should see a Succeeded message.\\n- Although it says succedeed, did it really? Go to a device in the Entra portal, and take a look at one.\\n\\n![](device.png \\"Extension Attribute on the device\\")\\n\\nSuccess, we now have tagged a device with an Extension Attribute!!!\\n\\n![](machoman.gif \\"Ooh Yeah\\")\\n\\n- First, let\'s go back to our Runbook, and we need to Publish the runbook.\\n![](runbook_publish.png \\"Runbook Publish\\")\\n\\n- Now that we have published the runbook, we can now configure a schedule.\\n- Under Resources, select Schedules and then Add Schedule.\\n- Click Link a Schedule to your Runbook and then Add Schedule.\\n- In my case, I want this to run slightly after the Intune Remediation runs. I don\'t want it to run at the same time, or too close, as there could be a delay on the Microsoft side. 15 minutes seems like a good enough time for me.\\n\\n![](Automation_Schedule.png)\\n\\n## Conclusion\\n\\nSo that\'s it, we have now linked together an Intune Remediation Script, along with an App Registration and an Azure Automation. This will tag devices with an extensionAttribute, that can be modified to your liking. From there, we tied together the App Registration and Azure Automation, making sure we store the secrets, tenant id, and application id in a secure manner and not in the script itself.\\n\\nFrom here, you can create Entra groups based off the extensionAttributes, or use this for reporting purposes."},{"id":"intunelab-2025","metadata":{"permalink":"/blog/intunelab-2025","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-03-30-intune-lab-2025/index.md","source":"@site/blog/2025-03-30-intune-lab-2025/index.md","title":"Setting up an Active Directory, ConfigMgr, Intune Lab in 2025","description":"Details on my home lab configuration for Active Directory, ConfigMgr, and Intune.","date":"2025-03-30T00:00:00.000Z","tags":[{"inline":false,"label":"Intune","permalink":"/blog/tags/intune","description":"Intune related posts."},{"inline":false,"label":"SCCM","permalink":"/blog/tags/sccm","description":"System Center Configuration Manager related posts."},{"inline":false,"label":"Active Directory","permalink":"/blog/tags/active-directory","description":"Active Directory related posts."}],"readingTime":18.18,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Setting up an Active Directory, ConfigMgr, Intune Lab in 2025","description":"Details on my home lab configuration for Active Directory, ConfigMgr, and Intune.","slug":"intunelab-2025","date":"2025-03-30T00:00:00.000Z","tags":["intune","sccm","active-directory"]},"unlisted":false,"prevItem":{"title":"Automating Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation","permalink":"/blog/entra-deviceextensionattributes-automation"},"nextItem":{"title":"Testing network connections with a PowerShell function.","permalink":"/blog/test-portnetconnections-post"}},"content":"Details on my home lab configuration for Active Directory, ConfigMgr, and Intune.\\n\x3c!-- truncate --\x3e\\n\\n\\nFor the first time in what seems like forever, I\'ve gone through the process of setting up a lab environment to test and write about features in Intune. Along with my Intune lab environment, I also configured Active Directory and a ConfigMgr lab server. I thought it would be a good idea to write this down, as I want to be able to rebuild this lab when needed. I\'ll go into more details below, but I plan on utilizing Enterprise Evaluation licenses, which expire every 180 days. My goal is to rebuild the lab every 6 months for a few reasons:\\n\\n- Cost: I don\'t want to purchase licenses if I do not need to. Once the license expires, certain features will be shut off at the OS level. To avoid that, I\'ll just rebuild.\\n- Process: I want the process to be repeatable. I don\'t want to question what I did every 6 months. If I do that, either I just won\'t rebuild, or I\'ll sit there scratching my head trying to figure out what I previously did.\\n- Tech Debt: We all have tech debt at our work environment. I don\'t want tech debt in my lab, so 6 months of testing features will give me a chance to start fresh.\\n\\n[Deployment Research Hydration Kit](https://www.deploymentresearch.com/hydration-kit-for-windows-server-2022-sql-server-2019-and-configmgr-current-branch/)\\n[Recast Software - Building a ConfigMgr Lab from Scratch](https://www.recastsoftware.com/resources/building-a-cm-lab-configuration-settings-ad-gpo/)\\n\\n## Initial Details\\n\\n### Hardware\\n\\nI have a Dell Optiplex 7070 SFF that I will be using, almost soley to run this lab environment. I believe these came out in 2020, and can be found fairly cheap on eBay as of this writing. These are business grade desktops, that were probably all quickly replaced due to Covid-19. My desktop is running 32gb ram (can go up to 64gb) and a 2Tb M.2 drive. This will give me plenty of horsepower to run multiple VM\'s simultaneously. The host operating system is running Windows 11 Pro.\\n\\n### Software\\n\\n- [Hyper-V](https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/get-started/install-hyper-v?pivots=windows)\\n    - I\'m using Hyper-V for this lab. My main reasoning being it\'s free, I don\'t want to rely on Broadcom/VMWare or any other 3rd party vendor for this and possibly have to buy a license. It\'s an easy feature to turn on, making it simpler for me and less to worry about.\\n\\n- [Hydration Kit](https://www.deploymentresearch.com/hydration-kit-for-windows-server-2022-sql-server-2019-and-configmgr-current-branch/)\\n    - There are really three options to configure the lab. \\n        1. I chose the Hydration Kit from [Deployment Research](https://www.deploymentresearch.com) because it\'s well known in the ConfigMgr/Intune community, and it allows me to have some customization to configure the lab.\\n    - Other Options\\n        2. [Windows 11 and Office 365 Lab Kit](https://learn.microsoft.com/en-us/microsoft-365/enterprise/modern-desktop-deployment-and-management-lab?view=o365-worldwide). I did not choose this one, mainly because it did not give me the customization I was looking for, as I view this as a long term lab that I will want setup a certain way. If I was quickly spinning up a lab for a month or two, this would be a great option to use, as it\'s very simple to setup.\\n        3. Manual Setup. While this is a great option, and will teach you a lot about your lab, it\'s also time consuming.\\n\\n    - Other Details\\n        - As I\'ve explained, this lab is a combination of Active Directory, ConfigMgr, and Intune (Co-Management). I\'ll provide my notes and thoughts for all, but if looking to only run an Intune lab, this is doable also and parts can be skipped.\\n\\n### Networking\\n\\nI\'m not running anything crazy in my home lab that anyone else can\'t run. When I look on Reddit (r/homelab), it can be very overwhelming to see the networking configurations people are running. I live in rural Minnesota with Starlink as my internet provider (until this summer when fiber comes!), with an Eero router and a couple of mesh access points. If I can run a lab with this simple setup, anyone can. I\'ll go into more details with the networking configuration below.\\n\\n## Hydration Kit (Active Directory/ConfigMgr Setup)\\n\\nFor the most part, I stuck with the basics from [Deployment Research](https://www.deploymentresearch.com/hydration-kit-for-windows-server-2022-sql-server-2019-and-configmgr-current-branch/). For time and resources, my lab looks like this for the setup.\\n\\n- Active Directory Domain Controller (DC01)\\n- Configuration Manager Site Server (CM01)\\n- File Server (FS01)\\n    - This to me is optional, and I\'m debating how much I will actually use this.\\n\\nWhat I am not configuring from the Hydration Kit:\\n- DP01\\n    - I am planning on labbing the most with Intune, so I am skipping this server. I\'ll just use CM01 as the primary distribution point if need be.\\n- MDT01\\n    - MDT is now end of life, so I am skipping this also. I will be building the VMs either with a CM Task Sequence or through AutoPilot.\\n        - PC0001-PC0004\\n            - I initially built PC0004, but then found that this does not install the ConfigMgr agent. Rather than fiddle around with installing the agent, I decided to shift this to build a VM through OSD (ConfigMgr).\\n\\n### Customization\\n\\nAs I explained earlier, I want to be able to tear down this lab and rebuild to my liking every six months. I also want this to be using my domain name, so I have done tweaks to the cusomtization files to do that. I have published all this on my [GitHub repository](https://github.com/Pacers31Colts18/HydrationKitCustomization2025)\\n\\n- [HyperV_CreateNetwork.ps1](https://github.com/Pacers31Colts18/HydrationKitCustomization2025/blob/master/HyperV_CreateNetwork.ps1)\\n    - I followed this [post](https://www.deploymentresearch.com/setting-up-new-networking-features-in-server-2016/) for setting up the networking, and have just tweaked this to be the network name that I saw fit.\\n- [Configure - Create AD Structure](https://github.com/Pacers31Colts18/HydrationKitCustomization2025/tree/master/DS/Applications/Configure%20-%20Create%20AD%20Structure)\\n    - Minor tweaks to this include:\\n        - Adding ADGroupList.csv and adding a section to Create-ADStructure to create the Active Directory Groups that I want initially configured.\\n        - Modifying the users and OUs to be created. This will configure the lab how I want, along with all the admin accounts, regular user accounts, and groups.\\n-[Custom Settings](https://github.com/Pacers31Colts18/HydrationKitCustomization2025/tree/master/ISO/Content/Deploy/Control)\\n    - I tweaked the .ini files for the custom settings to target my lab environment, targeting specific OUs for the servers to join to, and what domain to join to are the main differences.\\n    - If adding other servers or workstation VMs, make sure you modify those for your environment.\\n- [Install - ConfigMgr](https://github.com/Pacers31Colts18/HydrationKitCustomization2025/tree/master/DS/Applications/Install%20-%20ConfigMgr)\\n    - This is just changing the following lines to be what I want in my lab environment, the rest of the .ini file is left as is:\\n```powershell\\nSiteCode=JL1\\nSiteName=JoeLoveless\\nSDKServer=CM01.joeloveless.com\\nManagementPoint=CM01.joeloveless.com\\nDistributionPoint=CM01.joeloveless.com\\nSQLServerName=CM01.joeloveless.com\\nDatabaseName=CM_JL1\\nCloudConnectorServer=CM01.joeloveless.com\\n```\\nOnce your customization files are setup properly, go through the guide for the Hydration Kit. Make sure you copy your customization files into the proper structure. In my case I have a C:\\\\CMLab_2025 folder structure. If cloning my GitHub customizations, make sure they are moved into the proper folders where you are housing the files. Do all of this before **Step 4 \u2013 Create the bootable Hydration Kit ISO (MDT offline media item)**.\\n\\n## Building the Virtual Machines\\n\\nOnce all is configured, we\'re now to the process of building the virtual machines. The most time consuming part of all this for myself was downloading the software (Starlink download speeds) and then customizing everything. If you don\'t have crappy internet, it should be a faster process for you. If you\'re not customizing anything, even smoother. But what fun is that?\\n\\n### DC01 Build\\n\\nThe domain controller is the first VM to build. Make sure you boot from the .iso file, and then go through the MDT build process for DC01. The build process will look like this, and shouldn\'t take all that long to build.\\n\\n![](DC01_Setup.png \\"DC01 Setup Screen 1\\")\\n\\n![](DC01_Setup2.png \\"DC01 Setup Screen 2\\")\\n\\n![](DC01_Setup3.png \\"DC01 Setup Screen 3\\")\\n\\n### DC01 Configuration\\n\\nI used the [Recast Software documentation](https://www.recastsoftware.com/resources/building-a-cm-lab-configuration-settings-ad-gpo/) to help configure this portion, with some items taken out.\\n\\nAfter setup, open dsa.msc from Search and look to ensure your groups, users, and organizational units were created properly. If they were not, you can create them manually to match what your Custom Settings call for with the OU structure.\\n\\n#### User Accounts\\n\\n- CM_Admin (Both Admin in ConfigMgr & on ConfigMgr Servers)\\n    - Admin account\\n- CM_JD (Domain Join Account, I followed these instructions to create it.\\n    - It drove me crazy that this was named CM_JD rather than CM_DJ (Domain Join), so I modified this :)\\n- ~~CM_NA (Network Access Account, depending on your setup, you might not need this. I\u2019m hoping to leverage Enhanced HTTP)~~\\n- ~~CM_CP_Workstations & CM_CP_Servers (Client Push Accounts, added to the groups below to be local admins on respective devices)~~\\n    - I don\'t think I\'ll need this, but can configure later.\\n- ~~CM_SSRS (add to SQL_Admins, used for the Reporting Services Role)~~\\n    - I\'m not planning on doing much with Reporting Services.\\n\\n#### AD Groups\\n\\nThese should already be created for you based on the customization file. If not, here are the groups I created. In a real world scenario the Workstation Admins and Server Admins would be different groups (maybe? hopefully?)\\n\\n- JoeLoveless - ServerAdministrators\\n- JoeLoveless - WorkstationAdministrators\\n\\n#### Group Policies\\n\\nFrom the article, I found many of these to be optional. I created the following:\\n\\n- Default Domain Policy\\n    - Left this blank for now.\\n- JoeLoveless - WIN - Workstation - Restricted Groups\\n- JoeLoveless - WIN - Server - Restricted Groups\\n\\nFor the Restricted Groups, I setup my group policy to look like this (adding the Server group to the Server GPO)\\n\\n![](GPO.png \\"Restricted Groups\\")\\n\\nThe rest of the policies outlined, I found to be optional. Because I am running this all from a Hyper-V host, I\'m not necessarily remoting into the VMs so I did not need RDP firewall rules opened up. I did need to add to the Remote Desktop Users group though to be able to login properly.\\n\\n### CM01 Build\\n\\nAfter everything is setup properly, go through the same MDT build process for CM01, only difference being to choose CM01 for the build.\\n\\n![](CM01_Setup.png \\"CM01 Setup Screen 1\\")\\n\\n![](CM01_Setup2.png \\"CM01 Setup Screen 2\\")\\n\\n### CM01 Configuration\\n\\n#### Source Folder\\n\\nUsing [Recast Software documentation](https://www.recastsoftware.com/resources/building-a-cm-lab-configmgr-source-share/) as a guide, I then configured a Source shared folder. This will be used to house any files needed for deployments, boot media, etc. Because of the work Deployment Research already did for us, it\'s a fairly simple process.\\n\\n1. From CM01, go to the E drive and create a folder named \\"Source\\"\\n2. Right click Properties > Sharing > Share\\n3. Give **Domain Users** read permissions.\\n    - Normally you would probably give this a different group rather than all of Domain Users, but since this is a lab, it doesn\'t matter all that much as I\'ll be using all the accounts myself.\\n\\n4. From there, create the folder structure you want. Mine looks like this:\\n\\n![](CM01_SourceFolder_SubFolders.png \\"CM01 Source Structure\\")\\n\\n#### Basic Setup\\n\\nContinuing on with [Recasts setup](https://www.recastsoftware.com/resources/building-a-cm-lab-configmgr-settings-setup/), I followed this almost exactly, the only difference being on the Boundary setup, I plugged in my network configuration rather than what they have:\\n\\n- Network: 192.168.25.0\\n- Subnet: 255.255.255.0\\n\\n#### Client Settings\\n\\nThis part is optional, but I want to have a good experience on this when possible. I modified the PowerShell Script Execution Policy to be **Bypass** and then modified the customization in Software Center. Now when opening Software Center, you\'re presented with this beautiful branding:\\n\\n![](SoftwareCenter.png \\"Software Center\\")\\n\\n#### Collections\\n\\nI didn\'t bother too much with configuring a bunch of collections. I only created a few collections to start for my OSD deployment in the next section:\\n\\nThe two All Workstations/All Servers have a Limiting Collection of **All Systems** and are query based collections:\\n\\n- Collection Name: All Workstations\\n```powershell\\nselect SMS_R_SYSTEM.ResourceID,SMS_R_SYSTEM.ResourceType,SMS_R_SYSTEM.Name,SMS_R_SYSTEM.SMSUniqueIdentifier,SMS_R_SYSTEM.ResourceDomainORWorkgroup,SMS_R_SYSTEM.Client from SMS_R_System where SMS_R_System.OperatingSystemNameandVersion like \\"Microsoft Windows NT Workstation%\\"\\n```\\n- Collection Name: All Servers\\n```powershell\\nselect SMS_R_SYSTEM.ResourceID,SMS_R_SYSTEM.ResourceType,SMS_R_SYSTEM.Name,SMS_R_SYSTEM.SMSUniqueIdentifier,SMS_R_SYSTEM.ResourceDomainORWorkgroup,SMS_R_SYSTEM.Client from SMS_R_System where SMS_R_System.OperatingSystemNameandVersion like \\"Microsoft Windows NT Server%\\"  OR SMS_R_System.OperatingSystemNameandVersion like \\"Microsoft Windows NT Advanced Server%\\"\\n```\\n\\nThis collection is an Include collection of All Unknown Computers with a limiting collection of **All Workstations**:\\n\\n- Collection Name: OSD Bare Metal\\n![](osdbaremetal.png \\"OSD Bare Metal Collection\\")\\n\\n#### Operating System Deployment\\n\\nThe last and final step I\'ve done in my ConfigMgr portion of the lab is configuring and OSD Task Sequence, in my case, Windows 11 22H2 Enterprise Evaluation Edition. I followed [Recast\'s Guide](https://www.recastsoftware.com/resources/building-a-cm-lab-operating-system-deployment/) step by step, and then built a Windows 11 virtual machine, making sure I booted from the .iso file I created in this process. To boot from the .iso, you will need to copy the file down to your host and then boot from that.\\n\\nThe deployment process will look like this:\\n\\n![](PC004_CM_TaskSequence.png \\"CM Task Sequence\\")\\n\\n![](PC004_CM_TaskSequence2.png \\"CM Task Sequence Step 2\\")\\n\\n![](PC004_CM_TaskSequence3.png \\"CM Task Sequence Step 3\\")\\n\\n## Azure/Intune/Co-Management/Entra ID Configuration\\n\\nAlright, now we have an Active Directory domain controller, a ConfigMgr site, and a Windows 11 virtual machine. Now how the hell do we tie that all together with Azure, Intune, and Entra ID? Follow along!\\n\\n### Azure\\n\\nFirst thing we need to do is create an Azure tenant if we do not already have one. Thankfully (and sometimes) Microsoft has good up to date documentation (not always).\\n\\n- [Create New Tenant](https://learn.microsoft.com/en-us/entra/fundamentals/create-new-tenant)\\n\\nOnce your tenant is up and running, depending on what all you want to configure, we have some options.\\n\\n- Custom Domain Names:\\n\\n1. From the Azure Portal, search for Domain Names, here you can add a custom domain name. You will then need to setup the proper TXT or MX record with your hosting provider. Details are probably available from them.\\n\\n![](Azure_DomainName.png \\"Azure Domain Name\\")\\n\\n- Domain names can take up to 48 hours to process once the records are added.\\n\\n- Tenant ID/Tenant Name:\\n\\n    - Now that we have the domain name configured, it\'s probably best to make note of our Tenant ID and Tenant Name.\\n        1. From the Azure Portal, click **Microsoft Entra ID**\\n        2. Under Basic Information, copy the **Tenant Name** and **Tenant ID**.\\n\\n- Licensing:\\n\\n    This is the bad part. I don\'t like bad parts. Microsoft used to have a license that allowed for home lab use. Unfortunately, that was abused and taken away. So now we have very little options.\\n\\n    - Option 1: [Microsoft 365 Developer Program](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)\\n        - Note: I don\'t qualify for this, or haven\'t asked my work about a Visual Studio license yet. I don\'t really have a need in my day to day for a Visual Studio license, so I haven\'t brought up the topic.\\n    - Option 2: [License](https://www.microsoft.com/en-us/microsoft-365/microsoft-365-trials?msockid=11ab0ae17f91669f2c121f517e176760#tabs-pill-bar-oc0336_tab1)\\n        - Note: I\'m not a licensing expert.\\n        - The best option I found is to sign up for a trial run of Microsoft 365 Business Premium, and extend it out as much as possible. The trial gives you 25 licenses.\\n        - Once that runs out, go down to as little licenses as you want to pay for. In my case, I\'m using a single license for a single user. This costs $22.00 a month. This is the worst part of the lab. I\'m sorry.\\n\\n        - Option 2 Setup:\\n            1. Go through the link above for Option 2, select Business and then Microsoft 365 Business Premium.\\n            2. Follow the steps to run the trial (I don\'t think you need a credit card, but I can\'t remember)\\n            3. Congrats, you now have trial licenses for 25 users, or however many licenses you actually purchased.\\n\\n- Permissions:\\n\\n    The account you are logged in with that you have configured everything with so far is a Global Administrator. It\'s not the greatest practice in the world to use that account for all the configuration. My recommendation would be to create a second user account, and then assign that user the Intune Administrator Role. Since this is a lab environment, and it\'s only myself, I am just going to assign the permissions directly. In a real world scenario, you would probably have a Security Group to assign permissions to.\\n\\n    1. Go to Microsoft Entra ID > Users > Select the user you want to assign the role to\\n    2. Click Assigned Roles\\n    3. Click Add Assignments\\n    4. Add Intune Administrator\\n\\n    ![](intuneAdministrator.png \\"Intune Administrator\\")\\n\\n### Intune\\n\\nNow that we have our licensing squared away, we can go to the [Intune Portal](https://intune.microsoft.com). From the initial configuration, I did not change a ton, more I am sure will be changed later. A few things I did change:\\n\\n- Administrator Licensing\\n    1. Go to Tenant Administration > Roles > Administrator Licensing\\n        - Turn on the option to allow All unlicensed admins to have access to Microsoft Intune.\\n        - This ensures you don\'t need two licenses necessarily, but can run with a single user license.\\n\\n### Microsoft Entra ID\\n\\nSo, we have Azure configured, we have Intune configured. Now we need to tie together Active Directory, Configuration Manager, Intune, and Azure all together.\\n\\n#### Microsoft Entra ID Connect\\n\\nWe are going to go back to the DC01 domain controller, and we will want to download and install [Microsoft Entra ID Connect](https://www.microsoft.com/en-ie/download/detail). Microsoft Entra ID Connect will allow us to synchronize what from Active Directory to Microsoft Entra ID. This is [Hybrid Join](https://learn.microsoft.com/en-us/entra/identity/devices/how-to-hybrid-join). Note: *These are my notes after the fact, so I hope everything lines up properly.*\\n\\n- Once installed, let\'s open **Azure AD Connect** from the Start Menu. Yes, Microsoft refers to this as Azure AD Connect in the start menu, EntraID Connect in the application itself, and Entra ID Connect on the download page, not confusing one bit.\\n\\n1. Click through the options, when trying to connect to Entra ID, I was presented with the following error:\\n![](EntraConnect_Setup3_Error.png \\"Powershell Error\\")\\n\\n- To fix this, run the following in an elevated Powershell session:\\n\\n```powershell\\nSet-ExecutionPolicy -ExecutionPolicy Bypass\\n```\\n\\n2. Make sure we choose the following when presented:\\n    - Password hash synchronization\\n    - Enable single sign on\\n2. When presented with the option of whether to sync the entire directory, or to sync certain OUs I decided to sync certain OUs rather than everything. In my case, I only want to sync Users and Workstations\\n\\n![](EntraConnect_Setup2.png \\"Entra Connect OU Filtering\\")\\n\\n3. Continue on through the setup, and finishing.\\n4. Once finished, re-open Azure AD Connect and click Configure.\\n5. Go to Configure Device Options\\n    - We are going to select Hybrid Join\\n\\n    ![](EntraConnect_HybridJoin.png \\"Hybrid Join\\")\\n\\n    - Select Windows 10 or later\\n\\n    ![](EntraConnect_Windows10.png \\"Windows10\\")\\n\\n    - Finally, you will need to login with an **Enterprise Administrator** account to finish this.\\n\\n    ![](EntraConnect_EA.png \\"Enterprise Administrator\\")\\n\\n**Verifying Hybrid Join (from the device)**\\n\\nHybrid Join is now configured. Let\'s open up our new Windows 11 virtual machine and see what happens?\\n\\n1. Wait 5-10 minutes, and then login to the VM with a user account that we think is syncd.\\n2. Open a command prompt.\\n3. Type **dsregcmd /status**\\n4. We should see something that looks similar to this in the output:\\n\\n![](dsregcmd.png \\"DSREGCMD\\")\\n\\n- AzureADJoined: YES\\n\\n**Verifying Hybrid Join (from the portal)**\\n\\n1. Go to the Azure portal (portal.azure.com) and search for Microsoft Entra ID\\n2. Click on Devices\\n3. You should see your device listed.\\n\\n![](EntraPortal_HybridJoin.png \\"Hybrid Join from Entra portal\\")\\n\\n### ConfigMgr Co-Management\\n\\nOk, now we have devices syncing to Entra ID through Hybrid Join. But how do we manage them in Intune? That is where [Co-Management](https://learn.microsoft.com/en-us/intune/configmgr/comanage/overview) comes into play. Co-Management will allow us to upload our devices from ConfigMgr into Intune, and then once the sliders are configured properly, allow us to manage the configuration through Intune.\\n\\nNote: *You cannot do Co-Management without Hybrid Join. You can do Hybrid Join without Co-Management, you\'re just limited on what you can manage without Intune.*\\n\\nWe are now going to open the console on CM01 and configure Co-Management.\\n\\nFrom Windows:\\n\\n1. Click Start > Configuration Manager Console\\n2. Go to Administration > Cloud Attach\\n3. Right click CoMgmtSettingsProd and go to Properties\\n4. Ensure Automatic Enrollment in Intune is set to All (this is a lab environment, who needs piloting?)\\n5. Under the Workloads tab, move everything to Intune.\\n\\n![](CoManagement.png \\"CoManagement\\")\\n\\nFrom our Windows 11 VM, we should see this configuration come down through Configuration Manager in the Control Panel:\\n\\n![](CM01_CoManagement.png \\"CoManagement Configuration\\")\\n\\n#### Verifying Co-Management in Intune\\n\\nNow we have everything configured, let\'s go into Intune and take a look at the configuration on the device.\\n\\n1. From a browser, go to [Intune](https://intune.microsoft.com)\\n2. Go to Devices > All Devices, and look for the name of your VM.\\n3. Click on the VM, and we should see an output similar to this:\\n\\n![](Intune_CoManaged.png \\"Intune Co-Management\\")\\n\\n## Wrapping Up\\n\\nSo now we have a nice, new shiny lab thanks to Deployment Research, Recast, and others that allows us to manage Active Directory, Azure, Entra ID, Configuration Manager, and Intune. I am hopeful that this is a helpful blog post, as I\'ve seen questions out there on the best way to setup a lab in 2025. If you have any questions, please feel free to reach out to me.\\n\\n- Joe Loveless"},{"id":"test-portnetconnections-post","metadata":{"permalink":"/blog/test-portnetconnections-post","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-02-25-test-portnetconnection/index.md","source":"@site/blog/2025-02-25-test-portnetconnection/index.md","title":"Testing network connections with a PowerShell function.","description":"A quick function for testing network connections with PowerShell.","date":"2025-02-25T00:00:00.000Z","tags":[{"inline":false,"label":"PowerShell","permalink":"/blog/tags/powershell","description":"PowerShell related posts."},{"inline":false,"label":"Active Directory","permalink":"/blog/tags/active-directory","description":"Active Directory related posts."}],"readingTime":4.6,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Testing network connections with a PowerShell function.","description":"A quick function for testing network connections with PowerShell.","slug":"test-portnetconnections-post","date":"2025-02-25T00:00:00.000Z","tags":["powershell","active-directory"]},"unlisted":false,"prevItem":{"title":"Setting up an Active Directory, ConfigMgr, Intune Lab in 2025","permalink":"/blog/intunelab-2025"},"nextItem":{"title":"Introduction","permalink":"/blog/introduction-post"}},"content":"A PowerShell function for testing network connections with PowerShell.\\n\\n\x3c!-- truncate --\x3e\\n\\nI made an introductory post back in November, but work and life, and not knowing what to do or write about has gotten in the way. This is my attempt at actually starting this blog, and seeing where it takes me. I\'m trying to put myself out there more, but can honestly say it\'s scary and nerve wracking to put my thoughts and code out in the world. But here goes...\\n\\nI\'ve always had dirty code sitting around to test network connectivity to Active Directory domain controllers, but I finally got around to cleaning it up and putting this in a format that I think will be helpful for others.\\n\\nThe gist of this function is to parse through Ports, which are defined in an ParamBlock (which also allows for customization on said ports), and looping through a single domain, or multiple domains and testing against those domain controllers for connectivity. The ports are probably not the most comprehensive list, and I\'m sure I\'ll add more ports over time.\\n\\nThe beauty of this is being able to run against one domain, or multiple domains, or all the domains in your environment. I like to utilize CSV files as the source files, and pipe that to Out-GridView for further customization. Rather than having an \\"All\\" switch, or a parameter for a single domain, this allows me to pick and choose which domains I want to scan against.\\n\\nI\'m going to break down the code here, so you can get an idea of what this function does. The full function can be found on my GitHub page (on the left) or directly [here](https://github.com/Pacers31Colts18/ActiveDirectory/blob/main/Test-PortNetConnection.ps1).\\n\\n```powershell\\n[CmdletBinding()]\\n    Param(\\n        [Parameter(Mandatory = $False)]\\n        [array]$Domains,\\n        [Parameter(Mandatory = $False)]\\n        [array]$Ports = @(53,88,135,137,139,389,445,464,636,3268,3269),\\n        [Parameter(Mandatory = False)]\\n        $DomainCSVPath\\n    )\\n```\\n\\nThis is the main parameter block. $Domains is an array, so you can add a comma-separated list of your domains. \\n- Examples: \\n    - joeloveless.com\\n    - joeloveless.com, contoso.com\\n\\n$Ports is another array, by default, it\'s going to scan against the ports listed above. Putting the ports in the Parameter block allows you to customize what you want to scan against. If you do not necessarily want to scan against the ports listed above, no problem? Enter your own.\\n\\n$DomainCSVPath. I use this extensively at my line of work. Header should be a Title, with the FQDN of the domains listed below. I then typically store this in my GitHub repos for easy access. In my code at work, I\'ll have the path pre-determined so I do not need to input the CSV file every time, but for this code example, I am leaving it out.\\n\\n```powershell\\n#region Parameter Logic\\n    if ($Domains.Count -eq 0) { $Domains = (Import-CSV -path $DomainCSVPath | Out-GridView -PassThru).Title }   \\n    #endregion\\n\\n    #region Declarations\\n    $FunctionName = $MyInvocation.MyCommand.Name.ToString()\\n    $date = Get-Date -Format yyyyMMdd-HHmm\\n    if ($outputdir.Length -eq 0) { $outputdir = $pwd }\\n    $OutputFilePath = \\"$OutputDir\\\\$FunctionName-$date.csv\\"\\n    $LogFilePath = \\"$OutputDir\\\\$FunctionName-$date.log\\"\\n    $ResultsArray = @()\\n    #endregion\\n```\\n\\nThis section of the function, I put in nearly all the functions I write.\\n\\nParameter logic. If the domain is not specified (-eq 0), then the CSV will be imported and passed to Out-GridView. From there, you\'ll be able to select your domain(s)\\n\\nDeclarations. This is really solely for the output and logging. I like to have consistency in my code, and define the same spot for output, and not necessarily have C:\\\\Temp as a dumping ground. The $FunctionName parameter also allows me to structure the name of the .csv and .log files, so I know what ran it, and when (Date).\\n\\n```powershell\\nForeach ($domain in $domains) {\\n        [array]$IPAddresses = (Resolve-DnsName -Name $domain).ipaddress\\n\\n        Foreach ($IP in $ipAddresses) {\\n            Foreach ($Port in $Ports) {\\n                $TestPort = (Test-NetConnection -Computername $IP -Port $Port).TcpTestSucceeded\\n                If ($TestPort -eq $False) {\\n                    $TestPort = \\"Fail\\"\\n                }\\n                If ($TestPort -eq $True) {\\n                    $TestPort = \\"Pass\\"\\n                }\\n                $result = New-Object -TypeName PSObject -Property @{\\n                    DomainName = $Domain\\n                    IPAddress  = $IP\\n                    Port       = $Port\\n                    Result     = $TestPort \\n                }\\n                $ResultsArray += $result\\n            }\\n        }\\n    }\\n```\\n\\nThis region is the guts of the function really.\\n\\n - We\'re going to run Resolve-DNSNames and pull back the IP addresses and store in an array. https://learn.microsoft.com/en-us/powershell/module/dnsclient/resolve-dnsname?view=windowsserver2025-ps\\n\\n - From each IP address in the domain, we\'re then going to do a Test-NetConnection and only pull back if the TCPTestSucceeded. Then for cleanliness, if $True, we\'re going to name it \\"Pass\\". If the results are $False, we\'re going to name it \\"Fail\\".\\n\\n - I then like to store everything in a pscustomobject, and then output that to an array. Here I am grabbing the DomainName, IPAddress, Port, and the Result.\\n\\n ```powershell\\n #region Results\\n        if ($resultsArray.count -ge 1) {\\n            $ResultsArray | Select-Object DomainName, IPAddress, Port, Result | Sort-Object -Property DomainName, IPAddress | Export-Csv -Path $outputfilepath -NoTypeInformation\\n        }\\n    \\n        #Test if results file was created\\n        If (Test-Path $outputfilepath) {\\n            Write-Output \\"Results found. Results file=$outputfilepath.\\"\\n        }\\n        else {\\n            Write-Warning -message \\"No results found.\\" -level Warning\\n        }\\n        #endregion\\n```\\n\\nThis is another area that is in almost all my code, at least the code where I am gathering data. From here, I am taking the $ResultsArray, and exporting to a CSV file. Once that runs, I make sure the file is created, and the function is then finished.\\n\\nI hope this is helpful for someone out there, whether new to coding, or someone has been doing it quite a while. I\'m not sure this is the best way or not, but this is what seems to work for me. I\'ll try to post more here in the future.\\n\\n-Joe Loveless 2/25/25"},{"id":"introduction-post","metadata":{"permalink":"/blog/introduction-post","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2024-11-16-Introduction/index.md","source":"@site/blog/2024-11-16-Introduction/index.md","title":"Introduction","description":"Introductory blog post","date":"2024-11-16T00:00:00.000Z","tags":[{"inline":false,"label":"Other","permalink":"/blog/tags/other","description":"Other related posts."}],"readingTime":0.55,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Introduction","description":"Introductory blog post","slug":"introduction-post","date":"2024-11-16T00:00:00.000Z","tags":["other"]},"unlisted":false,"prevItem":{"title":"Testing network connections with a PowerShell function.","permalink":"/blog/test-portnetconnections-post"}},"content":"Welcome to my new blog!\\n\\n\x3c!-- truncate --\x3e\\n\\n\\nWelcome to my new blog! My name is Joe Loveless, and I\'ve been working in the Endpoint space for over 12 years now. I currently live in Minnesota, attend TCSMUG user group sessions when time allows, try to go to MMSMOA yearly and love working and playing with technology. I\'m a dad of two kids, own some chickens, and 3 dogs. My goal of this blog is to just provide content like others have done for me and to give back!\\n\\nI plan on writing about the following:\\n\\n- Microsoft Intune\\n- Microsoft ConfigMgr\\n- Active Directory\\n- Group Policy\\n- PowerShell\\n- Technology in general\\n- Other ramblings\\n\\n-Joe Loveless"}]}}')}}]);