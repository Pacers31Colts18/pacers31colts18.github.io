<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Creating Intune Randomized Rollouts with Entra Group Membership | Joe Loveless</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://joeloveless.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://joeloveless.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://joeloveless.com/blog/entra-grouprandomization"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Creating Intune Randomized Rollouts with Entra Group Membership | Joe Loveless"><meta data-rh="true" name="description" content="Creating Intune Randomized Rollouts with Entra Group Membership"><meta data-rh="true" property="og:description" content="Creating Intune Randomized Rollouts with Entra Group Membership"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-04-26T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Intune,Entra,PowerShell,Graph API"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://joeloveless.com/blog/entra-grouprandomization"><link data-rh="true" rel="alternate" href="https://joeloveless.com/blog/entra-grouprandomization" hreflang="en"><link data-rh="true" rel="alternate" href="https://joeloveless.com/blog/entra-grouprandomization" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://joeloveless.com/blog/entra-grouprandomization","mainEntityOfPage":"https://joeloveless.com/blog/entra-grouprandomization","url":"https://joeloveless.com/blog/entra-grouprandomization","headline":"Creating Intune Randomized Rollouts with Entra Group Membership","name":"Creating Intune Randomized Rollouts with Entra Group Membership","description":"Creating Intune Randomized Rollouts with Entra Group Membership","datePublished":"2025-04-26T00:00:00.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://joeloveless.com/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Joe Loveless RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Joe Loveless Atom Feed">




<link rel="preconnect" href="https://joeloveless.com/">
<script defer="defer" src="https://joeloveless.com/script.js" data-website-id="50771638-05b4-4125-a8fd-c8e7e72e57e5"></script><link rel="stylesheet" href="/assets/css/styles.77ea03e4.css">
<script src="/assets/js/runtime~main.4288b5d8.js" defer="defer"></script>
<script src="/assets/js/main.07c0fc75.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/blog/tags">Tags</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/expanding-my-homelab-with-cloudflare-tailscale-and-more">Expanding my Home Lab with Cloudflare, Tailscale, and more</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tracking-chores-with-home-assistant">Tracking Chores with Home Assistant</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/what-settings-are-in-intune">What Group Policy Settings aren&#x27;t in Microsoft Intune?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/exploring-microsoft-intune-filters">Exploring Microsoft Intune Filters</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/making-dexcom-better-wtih-homeassistant">Making Dexcom better with Home Assistant Voice</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Creating Intune Randomized Rollouts with Entra Group Membership</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-04-26T00:00:00.000Z">April 26, 2025</time> · <!-- -->8 min read</div></header><div id="__blog-post-container" class="markdown"><p>A walk through on how to create randomized rollouts for Intune deployments with Entra Groups using the Graph API.</p>
<p>It&#x27;s been a couple weeks now since I made my last post, with the weather starting to get nicer, it means more yard work and more random projects around the house. Next week is MMSMOA 2025, and I will be attending that with many team members. I think this is my 5th MMS, with my first one being in 2018 (I think). I&#x27;m really looking forward to it again and to see what new concepts everyone comes up with. I leave every year very excited, but also very worn out from all the days in the conference rooms, and the events that take place afterwards.</p>
<p>With that said, I didn&#x27;t want to go three weeks without posting anything, but was also struggling to come up with things to write about. Part of my struggle is seeing the already great content out there, and thinking that I can&#x27;t truly add the value that other people provide. I know it&#x27;s a bad head space to be in, and something to work through.</p>
<p>In our org, we have around 40k devices. Rolling out policies in the Group Policy days was a little bit easier for us, as we weren&#x27;t hitting every device at once (way too many forests). The great thing about Intune, is that we can hit all the devices at once. The bad thing about Intune, is we can hit all devices at once!</p>
<p>So the question became, how do we effectively roll out policy to devices and not run into issues? We have a pilot group, but pilot groups are hard to maintain, and not always the best representation of the org. Someone has to maintain that membership, and get buy in from users to be apart of the pilot group, and have enough members. Once we get past the initial internal piloting, and then the pilot group itself, we wanted a way to slowly rollout policies over a course of 2-3 weeks, to catch any issues should they come up.</p>
<p>In our environment when rolling out large scale policies, we aim for a 1%/10%/25%/All Workstations. Typically this will run over the course of three weeks, in a schedule looking like this:</p>
<ul>
<li class="">Week 1<!-- -->
<ul>
<li class="">Monday: 1%</li>
<li class="">Thursday: 10%</li>
</ul>
</li>
<li class="">Week 2<!-- -->
<ul>
<li class="">Monday: 25%</li>
</ul>
</li>
<li class="">Week 3<!-- -->
<ul>
<li class="">Monday: All Workstations</li>
</ul>
</li>
</ul>
<p>The thought being, after pilot groups, we are sitting at around 40% of devices covered in a random selection. If something were to happen after this rollout that causes an issue, it&#x27;s probably more just bad luck.</p>
<p>We have two variations of this function. One being for ConfigMgr. This is used for ConfigMgr rollouts (Configuration Baselines/Configuration Items) and Active Directory groups (Group Policy). The one I am going to show in this post, is for building Entra groups for Intune rollouts.</p>
<p>In our org, something like this would go through the Change Control process, so we like to dump the output of this to a CSV file, then build the group membership after the fact. This could be easily tweaked to build the pilot groups themselves.</p>
<h1>Walking through the function</h1>
<p>First, the function can be found on my <a href="https://github.com/Pacers31Colts18/Entra/blob/main/Export-EntraGroupPilotMembers.ps1" target="_blank" rel="noopener noreferrer" class="">Github</a>.</p>
<p>A lot of our code is very repeatable, and makes it easier for the next person to look at and pick up on.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="parameters-declarations-graph-check">Parameters, Declarations, Graph Check<a href="#parameters-declarations-graph-check" class="hash-link" aria-label="Direct link to Parameters, Declarations, Graph Check" title="Direct link to Parameters, Declarations, Graph Check" translate="no">​</a></h2>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[CmdletBinding()]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Param(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [Parameter(Mandatory = $True)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [string]$SourceEntraGroupName,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [Parameter(Mandatory = $True)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [ValidateRange(1, 100)][int]$Percentage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #region Declarations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $FunctionName = $MyInvocation.MyCommand.Name.ToString()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $date = Get-Date -Format yyyyMMdd-HHmm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($outputdir.Length -eq 0) { $outputdir = $pwd }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $OutputFilePath = &quot;$OutputDir\$FunctionName-$date.csv&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $LogFilePath = &quot;$OutputDir\$FunctionName-$date.log&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $graphApiVersion = &quot;beta&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $resultsArray = @()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Microsoft Graph Connection check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($null -eq (Get-MgContext)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Error &quot;Connect to Graph&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Break</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parameters">Parameters<a href="#parameters" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters" translate="no">​</a></h3>
<p>First up is the parameter block. For $SourceEntraGroupName, we are building this off an Entra group that is already established. Example being, say you have an <strong>SG - All Windows 11</strong> group and you are looking to rollout a new policy to Windows 11 devices. You would input this group, then for $Percentage, provide the percentage of devices you want in your pilot group. We do have a ValidateRange check of 1-100. How is it a pilot if you have 100% of devices? It&#x27;s not, sometimes we just like to use this as a cheat to quickly return all the group members.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="declarations">Declarations<a href="#declarations" class="hash-link" aria-label="Direct link to Declarations" title="Direct link to Declarations" translate="no">​</a></h3>
<p>This is in almost all of our code, and makes the format of our logging, output files, and directories very repeatable. We set the $outputdir in our Powershell profiles to our preference location. Then use the $FunctionName parameter to name the log file in a proper manner.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="graph-check">Graph Check<a href="#graph-check" class="hash-link" aria-label="Direct link to Graph Check" title="Direct link to Graph Check" translate="no">​</a></h3>
<p>Finally for this section, just a quick little check to see if you&#x27;re connected to Graph, and if not, return an error.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="groups">Groups<a href="#groups" class="hash-link" aria-label="Direct link to Groups" title="Direct link to Groups" translate="no">​</a></h2>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#region Obtain Group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $uri = &quot;https://graph.microsoft.com/$graphApiVersion/groups?`$filter=DisplayName eq &#x27;$SourceEntraGroupName&#x27;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $group = (Invoke-MgGraphRequest -uri $uri -Method GET).value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Output &quot;Obtaining Group: $sourceEntraGroupName&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    catch {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Error &quot;An error occurred : $_&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #end region</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #region Obtain Group Members  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $resultCheck = @()   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $uri = &quot;https://graph.microsoft.com/$graphApiVersion/groups/$($group.Id)/members&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #pagination</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        do {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            $groupmembers = (Invoke-MgGraphRequest -Uri $uri -Method GET)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            $resultCheck += $groupmembers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            $uri = $groupmembers.&#x27;@odata.nextLink&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } while ($uri)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $groupmembers = $resultCheck.value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Output &quot;Obtaining &#x27;$($group.DisplayName)&#x27; with $($groupmembers.count) members.&quot; -ForegroundColor Cyan</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    catch {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Error &quot;An error occurred : $_&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #endregion</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="obtaining-the-group">Obtaining the Group<a href="#obtaining-the-group" class="hash-link" aria-label="Direct link to Obtaining the Group" title="Direct link to Obtaining the Group" translate="no">​</a></h3>
<p>From here, we&#x27;re going to use the Graph API to get the group and all the details associated with it. In the beginning, we tried to stick with the Graph SDK cmdlets. Honestly, I&#x27;ve grown to hate them, and have reverted to using the API, or just relying on the Invoke-MgGraphRequest for nearly everything. I found the SDK to be a pain, with a lack of documentation, examples, and just super long cmdlet names. Finding them, and then finding that they don&#x27;t work properly became a headache. Once the syntax of the API is figured out (which just takes some repetition), I find this way to be sooooo much easier. From what I&#x27;ve gathered, the SDK is just a wrapper for the API anyways, so I don&#x27;t really see the point of it to be honest.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="obtaining-group-members">Obtaining Group Members<a href="#obtaining-group-members" class="hash-link" aria-label="Direct link to Obtaining Group Members" title="Direct link to Obtaining Group Members" translate="no">​</a></h3>
<p>Same concept here, once we have the Group details (from the $group variable), we can then obtain the membership using the <strong>$group.id</strong>. Based on the size of your Source Group, you might run into pagination issues. In simple terms, pagination is a limit on how much data you can get back at a time with Graph, so you&#x27;re not slamming the system. More information can be found <a href="https://practical365.com/pagination-graph-sdk/" target="_blank" rel="noopener noreferrer" class="">here</a> and from <a href="https://learn.microsoft.com/en-us/graph/paging?tabs=http" target="_blank" rel="noopener noreferrer" class="">Microsoft</a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="randomization">Randomization<a href="#randomization" class="hash-link" aria-label="Direct link to Randomization" title="Direct link to Randomization" translate="no">​</a></h2>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#region Randomization</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $Decimal = $Percentage / 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $NumberofMembers = [int]($($groupMembers).Count * $Decimal)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $NumberofMembers = [Math]::Ceiling($NumberofMembers)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Write-Output &quot;Randomizing group and gathering $NumberofMembers workstations.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $GroupMembers = $GroupMembers | Sort-Object { Get-Random }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    $GroupMembers = $GroupMembers | Select-Object -First $NumberofMembers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #endRegion</span><br></span></code></pre></div></div>
<p>Once the group members are returned, we then move onto the randomization of the script. What we&#x27;re doing here is just simple math, and converting the percentage to a decimal and multiplying to get the count. From there, we are using a Sort-Object with Get-Random, which literally just does what it says and gets a random output of the devices. We&#x27;re then selecting those members.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-the-pscustomobject">Building the PSCustomObject<a href="#building-the-pscustomobject" class="hash-link" aria-label="Direct link to Building the PSCustomObject" title="Direct link to Building the PSCustomObject" translate="no">​</a></h2>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#region Build Object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foreach ($member in $groupMembers) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $result = New-Object -TypeName PSObject -Property @{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            EntraDeviceID = $member.deviceId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            DeviceName    = $member.displayName</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $ResultsArray += $result</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #endregion</span><br></span></code></pre></div></div>
<p>Now we&#x27;re building the data and will be outputting the data. Any property can be added here from what is stored on the device in Entra, but in my case, all I am looking for is the EntraDeviceID and DeviceName. DeviceName, mainly for change control purposes. EntraDeviceID, for when I create the group and add the members.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="outputting-the-results">Outputting the Results<a href="#outputting-the-results" class="hash-link" aria-label="Direct link to Outputting the Results" title="Direct link to Outputting the Results" translate="no">​</a></h2>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> #region Results</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ($ResultsArray.Count -ge 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        $ResultsArray | Export-Csv -Path $outputfilepath -NoTypeInformation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Test if output file was created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (Test-Path $outputfilepath) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Output  &quot;Output file = $outputfilepath.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Write-Warning &quot;No output file created.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #endregion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This is another repeatable section we have in our code. Like I said, we typically output a lot of our data to CSV files for change control purposes. This is a repeatable piece of code that we typically have in every output. What we are doing here is checking if the $ResultsArray (from the PSCustomObject) has any data, and if so, exporting the data to a CSV file, where the Path is in our declarations section. We are then testing to make sure the file was created successfully.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>So now, we have a list of devices that are randomized, and based off a percentage from a source group. You can then repeat this process to build out other wave groups. Rather than have static groups to do the rollout, you can randomize it and get different results each time.</p>
<p>Next week I&#x27;ll be at MMS. If you happen to see me, be sure to say hi!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Intune related posts." class="tag_zVej tagRegular_sFm0" href="/blog/tags/intune">Intune</a></li><li class="tag_QGVx"><a rel="tag" title="Entra related posts." class="tag_zVej tagRegular_sFm0" href="/blog/tags/entra">Entra</a></li><li class="tag_QGVx"><a rel="tag" title="PowerShell related posts." class="tag_zVej tagRegular_sFm0" href="/blog/tags/powershell">PowerShell</a></li><li class="tag_QGVx"><a rel="tag" title="Microsoft Graph API related posts." class="tag_zVej tagRegular_sFm0" href="/blog/tags/graph-api">Graph API</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-26-entra-pilotgrouprandomization/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/cis-benchmarks-avd-multisession"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">CIS L1 Benchmarks in Intune with AVD Multi-Session Hosts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/entra-deviceextensionattributes-automation-better"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">An even better way to automate Entra Device Extension Attributes with Intune Remediation Scripts and Azure Automation</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#parameters-declarations-graph-check" class="table-of-contents__link toc-highlight">Parameters, Declarations, Graph Check</a><ul><li><a href="#parameters" class="table-of-contents__link toc-highlight">Parameters</a></li><li><a href="#declarations" class="table-of-contents__link toc-highlight">Declarations</a></li><li><a href="#graph-check" class="table-of-contents__link toc-highlight">Graph Check</a></li></ul></li><li><a href="#groups" class="table-of-contents__link toc-highlight">Groups</a><ul><li><a href="#obtaining-the-group" class="table-of-contents__link toc-highlight">Obtaining the Group</a></li><li><a href="#obtaining-group-members" class="table-of-contents__link toc-highlight">Obtaining Group Members</a></li></ul></li><li><a href="#randomization" class="table-of-contents__link toc-highlight">Randomization</a></li><li><a href="#building-the-pscustomobject" class="table-of-contents__link toc-highlight">Building the PSCustomObject</a></li><li><a href="#outputting-the-results" class="table-of-contents__link toc-highlight">Outputting the Results</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="footer-icons">
                  <a href="https://github.com/pacers31colts18" class="footer-icon footer-icon-github" target="_blank" rel="noopener noreferrer"></a>
                  <a href="https://linkedin.com/in/joe-loveless" class="footer-icon footer-icon-linkedin" target="_blank" rel="noopener noreferrer"></a>
                  <a href="https://bsky.app/profile/joeloveless.com" class="footer-icon footer-icon-bluesky" target="_blank" rel="noopener noreferrer"></a>
                  <a href="https://infosec.exchange/@Pacers31Colts18" class="footer-icon footer-icon-mastodon" target="_blank" rel="noopener noreferrer"></a>
                  <a href="mailto:joe@joeloveless.com" class="footer-icon footer-icon-email"></a>
                  <a href="https://joeloveless.com/index.xml" class="footer-icon footer-icon-rss" target="_blank" rel="noopener noreferrer"></a>
                </div>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Joe Loveless</div></div></div></footer></div>
</body>
</html>